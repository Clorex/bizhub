# Snapshot generated: 2026-02-08T14:48:11
# Repo root: C:\Users\USER\Desktop\bizhub



==========================================================================================
FILE: src/components/ui/Button.tsx
==========================================================================================

// FILE: src/components/ui/Button.tsx
import { cn } from "@/lib/cn";

type ButtonVariant = "primary" | "secondary" | "soft" | "ghost" | "danger";
type ButtonSize = "sm" | "md" | "lg";

export function Button({
  variant = "primary",
  size = "md",
  loading,
  leftIcon,
  className,
  children,
  disabled,
  type,
  ...props
}: React.ButtonHTMLAttributes<HTMLButtonElement> & {
  variant?: ButtonVariant;
  size?: ButtonSize;
  loading?: boolean;
  leftIcon?: React.ReactNode;
}) {
  const base =
    "inline-flex w-full items-center justify-center gap-2 font-bold transition active:scale-[0.99] disabled:opacity-50 disabled:active:scale-100";

  const sizes =
    size === "sm"
      ? "rounded-2xl px-4 py-2 text-xs"
      : size === "lg"
        ? "rounded-2xl px-5 py-3.5 text-sm"
        : "rounded-2xl px-5 py-3 text-sm";

  const styles =
    variant === "primary"
      ? "text-white bg-gradient-to-br from-biz-accent2 to-biz-accent shadow-float"
      : variant === "secondary"
        ? "bg-white border border-biz-line text-biz-ink shadow-soft"
        : variant === "soft"
          ? "bg-biz-cream text-biz-ink border border-transparent shadow-soft"
          : variant === "danger"
            ? "bg-red-600 text-white shadow-float"
            : "bg-transparent text-biz-ink border border-transparent";

  return (
    <button
      type={type || "button"}
      className={cn(base, sizes, styles, className)}
      disabled={disabled || loading}
      {...props}
    >
      {loading ? (
        <span
          className="h-4 w-4 rounded-full border-2 border-current/40 border-t-current animate-spin"
          aria-label="loading"
        />
      ) : leftIcon ? (
        <span className="shrink-0">{leftIcon}</span>
      ) : null}

      <span>{children}</span>
    </button>
  );
}


==========================================================================================
FILE: src/components/ui/Chip.tsx
==========================================================================================

import { cn } from "@/lib/cn";

export function Chip({
  active,
  className,
  ...props
}: React.ButtonHTMLAttributes<HTMLButtonElement> & { active?: boolean }) {
  return (
    <button
      className={cn(
        "whitespace-nowrap rounded-full px-4 py-2 text-xs font-bold border transition shadow-sm",
        active
          ? "bg-gradient-to-br from-biz-accent2 to-biz-accent text-white border-transparent"
          : "bg-white border-biz-line text-gray-700",
        className
      )}
      {...props}
    />
  );
}


==========================================================================================
FILE: src/components/ui/Input.tsx
==========================================================================================

import { cn } from "@/lib/cn";

export function Input({
  className,
  ...props
}: React.InputHTMLAttributes<HTMLInputElement>) {
  return (
    <input
      className={cn(
        "w-full rounded-2xl border border-biz-line bg-white px-4 py-3 text-sm outline-none",
        "focus:ring-2 focus:ring-biz-accent/30 focus:border-biz-accent/40",
        "placeholder:text-gray-400",
        className
      )}
      {...props}
    />
  );
}


==========================================================================================
FILE: src/components/ui/SectionCard.tsx
==========================================================================================

import { Card } from "@/components/Card";
import { cn } from "@/lib/cn";

export function SectionCard({
  title,
  subtitle,
  right,
  children,
  className,
}: {
  title: string;
  subtitle?: string;
  right?: React.ReactNode;
  children: React.ReactNode;
  className?: string;
}) {
  return (
    <Card className={cn("p-4", className)}>
      <div className="flex items-start justify-between gap-3">
        <div className="min-w-0">
          <p className="font-bold text-biz-ink">{title}</p>
          {subtitle ? (
            <p className="text-xs text-biz-muted mt-1">{subtitle}</p>
          ) : null}
        </div>

        {right ? <div className="shrink-0">{right}</div> : null}
      </div>

      <div className="mt-3">{children}</div>
    </Card>
  );
}


==========================================================================================
FILE: src/components/ui/SegmentedControl.tsx
==========================================================================================

import { cn } from "@/lib/cn";

export function SegmentedControl<T extends string>({
  value,
  options,
  onChange,
  className,
}: {
  value: T;
  options: { value: T; label: string; disabled?: boolean }[];
  onChange: (v: T) => void;
  className?: string;
}) {
  return (
    <div
      className={cn(
        "rounded-2xl border border-biz-line bg-white shadow-soft p-1 grid",
        className
      )}
      style={{ gridTemplateColumns: `repeat(${options.length}, minmax(0, 1fr))` }}
    >
      {options.map((o) => {
        const active = o.value === value;
        const disabled = !!o.disabled;

        return (
          <button
            key={o.value}
            onClick={() => (!disabled ? onChange(o.value) : undefined)}
            disabled={disabled}
            className={cn(
              "rounded-2xl py-2 text-xs font-bold transition",
              active
                ? "text-white bg-gradient-to-br from-biz-accent2 to-biz-accent shadow-float"
                : "text-biz-ink",
              disabled ? "opacity-40 cursor-not-allowed" : ""
            )}
            title={disabled ? "Locked on current plan" : undefined}
          >
            {o.label}
          </button>
        );
      })}
    </div>
  );
}


==========================================================================================
FILE: src/lib/bizhubPlans.ts
==========================================================================================

// FILE: src/lib/bizhubPlans.ts

export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
export type BizhubBillingCycle = "monthly" | "quarterly" | "biannually" | "yearly";

export type PlanCatalog = {
  key: BizhubPlanKey;

  /**
   * IMPORTANT:
   * Internal key stays "FREE", but the display name is "Free access"
   * (as you requested: FREE is not a plan name on the pricing page).
   */
  name: string;

  tagline: string;

  /** Shown on pricing/subscription UI */
  recommendedFor: string;

  /** All plans support all cycles */
  priceNgn: Record<BizhubBillingCycle, number>;

  limits: {
    maxProducts: number | "unlimited";
  };

  /** Short bullets for plan cards */
  highlights: string[];

  /** Longer breakdown */
  benefits: Record<string, string[]>;

  /** Optional add-ons / upgrades (can include ‚Äúcoming soon‚Äù) */
  purchases: Record<string, string[]>;
};

const NAIRA = "\u20A6"; // ‚Ç¶

export const BIZHUB_PLANS: Record<BizhubPlanKey, PlanCatalog> = {
  FREE: {
    key: "FREE",
    name: "Free access",
    tagline: "Starter use to test the app and build trust.",
    recommendedFor: "Trying myBizHub and setting up your first products.",
    priceNgn: { monthly: 0, quarterly: 0, biannually: 0, yearly: 0 },
    limits: { maxProducts: 20 },

    highlights: [
      "Up to 20 products",
      "Basic orders",
      "Basic customers",
      "Basic business summary",
    ],

    benefits: {
      "Storefront basics": [
        "Public store link",
        "Product pages",
        "Cart + checkout",
        "Store link sharing",
      ],
      "Sales & orders": [
        "Manual order tracking",
        "Basic order list",
      ],
      Inventory: [
        "Basic stock count",
        "Out-of-stock handling",
      ],
      Customers: [
        "Basic customer list (from orders)",
      ],
      "Business summary": [
        "Simple daily / weekly sales summary (limited)",
      ],
      Support: [
        "Help center access",
      ],
      "Business assistant": [
        "Free business assistant (very limited)",
      ],
      Sales: [
        "Run sales on up to 5 products",
      ],
    },

    purchases: {
      "Optional upgrades": [
        "Upgrade your plan anytime to unlock more tools",
        `Product Boost (${NAIRA}1,700/day)`,
      ],
    },
  },

  LAUNCH: {
    key: "LAUNCH",
    name: "Launch",
    tagline: "For new and growing businesses that want to start properly.",
    recommendedFor: "New and growing businesses (solo sellers and small shops).",
    priceNgn: { monthly: 5000, quarterly: 14000, biannually: 27000, yearly: 50000 },
    limits: { maxProducts: "unlimited" },

    highlights: [
      "Unlimited products",
      "Order progress updates",
      "Stock signals",
      "Sales on up to 30 products",
    ],

    benefits: {
      "Everything in Free access": [
        "Store link sharing",
        "Basic customer list",
      ],

      "Sales & orders": [
        "Unlimited product listing",
        "Order status updates",
        "Order filtering (basic)",
        "Delivery notes per order (if enabled on your plan)",
        "Offline order recording (coming soon)",
      ],

      Payments: [
        "Payment confirmation tracking (coming soon)",
        "Proof-of-payment upload (coming soon)",
        "Pay-on-delivery support (coming soon)",
        "Paystack escrow + bank transfer orders",
      ],

      Inventory: [
        "Stock tracking",
        "Low-stock alerts",
        "Auto-hide out-of-stock items",
      ],

      Customers: [
        "Customer purchase history (basic)",
        "Customer notes (VIP / issue) (coming soon)",
      ],

      "Business tools": [
        "Weekly performance summary",
        "Expense tracking (coming soon)",
        "Profit estimation (coming soon)",
      ],

      Support: [
        "Standard support",
      ],

      Sales: [
        "Run sales on up to 30 products",
      ],
    },

    purchases: {
      "Growth tools": [
        `Product Boost (${NAIRA}1,700/day)`,
        "More growth tools (coming soon)",
      ],
    },
  },

  MOMENTUM: {
    key: "MOMENTUM",
    name: "Momentum",
    tagline: "For businesses that want steady growth and more control.",
    recommendedFor: "Growing businesses with a small team and steady sales.",
    priceNgn: { monthly: 10000, quarterly: 28000, biannually: 55000, yearly: 100000 },
    limits: { maxProducts: "unlimited" },

    highlights: [
      "Everything in Launch",
      "Better sales tools",
      "Deeper insights",
      "Sales on up to 50 products",
    ],

    benefits: {
      "Everything in Launch": [
        "Unlimited products",
        "Order status updates",
        "Stock tracking and alerts",
      ],

      "Better sales tools": [
        "Scheduled sales (set a start time)",
        "Better marketplace visibility for sales (Hot deals)",
        "Run sales on up to 50 products",
      ],

      "Sales control": [
        "Automated order follow-ups (coming soon)",
        "Custom order stages (coming soon)",
        "Failed order detection (coming soon)",
      ],

      "Payments & protection": [
        "Partial payments support (coming soon)",
        "Refund management (coming soon)",
        "Priority dispute review (coming soon)",
      ],

      "Inventory intelligence": [
        "Best-selling product tracking (coming soon)",
        "Dead stock detection (coming soon)",
        "Sales trend per product (coming soon)",
      ],

      "Customer growth": [
        "Repeat-buyer tagging (coming soon)",
        "Re-engagement broadcasts (already available with limits)",
        "Abandoned order recovery (coming soon)",
      ],

      "Business insights": [
        "Monthly business report (coming soon)",
        "Profit trend analysis (coming soon)",
      ],

      "Business assistant": [
        "More daily assistant usage",
        "Advice based on your store data (coming soon)",
        "Customer reply drafting (coming soon)",
      ],

      Support: [
        "Faster support response (coming soon)",
      ],
    },

    purchases: {
      "Growth tools": [
        `Product Boost (${NAIRA}1,700/day)`,
        "Advanced analytics pack (coming soon)",
      ],
    },
  },

  APEX: {
    key: "APEX",
    name: "Apex",
    tagline: "For high-volume and serious businesses.",
    recommendedFor: "Big businesses and brands scaling with higher volume.",
    priceNgn: { monthly: 25000, quarterly: 70000, biannually: 130000, yearly: 200000 },
    limits: { maxProducts: "unlimited" },

    highlights: [
      "Everything in Momentum",
      "Best sales visibility",
      "Advanced automation (coming soon)",
      "Unlimited sales products",
    ],

    benefits: {
      "Everything in Momentum": [
        "Scheduled sales",
        "Hot deals marketplace visibility",
        "Deeper insights (more)",
      ],

      "Better sales tools": [
        "Unlimited sales products",
        "Best marketplace visibility for sales",
        "More control for high-volume sales (coming soon)",
      ],

      "Advanced sales automation": [
        "Automated workflows (coming soon)",
        "High-value order alerts (coming soon)",
        "Bulk order actions (coming soon)",
      ],

      "Advanced payments & trust": [
        "Delivery confirmation system (coming soon)",
        "Buyer reliability indicators (coming soon)",
        "Faster dispute resolution (coming soon)",
      ],

      "Advanced inventory & forecasting": [
        "Smart restock prediction (coming soon)",
        "Seasonal product performance (coming soon)",
        "Supplier tracking (coming soon)",
      ],

      "Advanced customer management": [
        "Customer segmentation (coming soon)",
        "Loyalty and birthday messaging (coming soon)",
        "Customer lifetime value estimation (coming soon)",
      ],

      "Business intelligence": [
        "Business health score (coming soon)",
        "Sales channel comparison (coming soon)",
        "Downloadable detailed reports (coming soon)",
      ],

      "Business assistant": [
        "Highest assistant limits",
        "Smart growth recommendations (coming soon)",
        "Pricing and product strategy help (coming soon)",
      ],

      Support: [
        "Highest priority support (coming soon)",
        "Early access to new features (coming soon)",
      ],
    },

    purchases: {
      "Premium tools": [
        `Product Boost (${NAIRA}1,700/day)`,
        "Premium tools bundle (coming soon)",
      ],
    },
  },
};

export function priceKoboFor(planKey: BizhubPlanKey, cycle: BizhubBillingCycle) {
  const ngn = Number(BIZHUB_PLANS[planKey]?.priceNgn?.[cycle] ?? 0);
  if (!Number.isFinite(ngn) || ngn < 0) throw new Error("Invalid plan price");
  return Math.round(ngn * 100);
}

export function computeExpiryMs(cycle: BizhubBillingCycle, startMs = Date.now()) {
  const day = 24 * 60 * 60 * 1000;
  const days = cycle === "yearly" ? 365 : cycle === "biannually" ? 182 : cycle === "quarterly" ? 91 : 30;
  return startMs + days * day;
}

export type BusinessTrial = {
  planKey: Exclude<BizhubPlanKey, "FREE">;
  startedAtMs: number;
  endsAtMs: number;
};

export type BusinessSubscription = {
  planKey: Exclude<BizhubPlanKey, "FREE">;
  cycle: BizhubBillingCycle;
  status: "active" | "expired";
  startedAtMs: number;
  expiresAtMs: number;
  lastPaymentReference?: string;
};

export type Entitlement = {
  planKey: BizhubPlanKey;
  source: "trial" | "subscription" | "free";
  expiresAtMs?: number;
};

// Trials are deprecated; kept only for backwards compatibility.
export const DEFAULT_TRIAL_DAYS = 0;
/** Deprecated */
export const DEFAULT_TRIAL_PLAN: Exclude<BizhubPlanKey, "FREE"> = "LAUNCH";

export function getEntitlement(params: {
  trial?: Partial<BusinessTrial> | null;
  subscription?: Partial<BusinessSubscription> | null;
}): Entitlement {
  const now = Date.now();

  const s = params.subscription;
  if (s?.planKey && Number(s.expiresAtMs || 0) > now) {
    return { planKey: s.planKey as BizhubPlanKey, source: "subscription", expiresAtMs: Number(s.expiresAtMs) };
  }

  return { planKey: "FREE", source: "free" };
}

export function productLimitFor(planKey: BizhubPlanKey): number | "unlimited" {
  return BIZHUB_PLANS[planKey]?.limits?.maxProducts ?? 20;
}


==========================================================================================
FILE: src/lib/search/marketTaxonomy.ts
==========================================================================================

// FILE: src/lib/search/marketTaxonomy.ts
export type MarketCategoryKey =
  | "fashion"
  | "phones"
  | "beauty"
  | "home"
  | "bags"
  | "services"
  | "other";

export const MARKET_CATEGORIES: { key: MarketCategoryKey; label: string; hint: string; synonyms: string[] }[] = [
  {
    key: "fashion",
    label: "Fashion",
    hint: "Clothes, shoes",
    synonyms: [
      "fashion","clothes","cloth","shirt","tshirt","top","gown","dress","skirt","trouser","trousers","pants","jeans","joggers",
      "shoe","shoes","slipper","slippers","slides","slide","sandal","sandals","heels","sneaker","sneakers",
      "cap","hat","jacket","hoodie","native","agbada","kaftan","wear",
      // Nigeria common terms
      "pam","pams",
    ],
  },
  {
    key: "phones",
    label: "Phones",
    hint: "Android, iPhone",
    synonyms: [
      "phone","phones","iphone","ipad","android","samsung","tecno","infinix","itel","redmi","xiaomi",
      "airpod","airpods","earpiece","earpieces","earphone","earphones","charger","charging","powerbank","power",
      "screen","case","casing",
    ],
  },
  {
    key: "beauty",
    label: "Beauty",
    hint: "Hair, makeup",
    synonyms: [
      "beauty","hair","wig","wigs","attachment","braids","braid","weavon","weave","shampoo","conditioner",
      "makeup","lipstick","powder","foundation","lash","lashes","nails","nail","pedicure","manicure","skincare","cream","oil","perfume",
    ],
  },
  {
    key: "home",
    label: "Home",
    hint: "Kitchen, decor",
    synonyms: [
      "home","kitchen","decor","decoration","plate","plates","pot","pots","pan","pans","spoon","cup","mug","bowl",
      "bed","bedsheet","curtain","lamp","chair","table","furniture",
    ],
  },
  {
    key: "bags",
    label: "Bags",
    hint: "Handbags",
    synonyms: ["bag","bags","handbag","handbags","purse","purses","backpack","wallet","luggage","travelbag"],
  },
  {
    key: "services",
    label: "Services",
    hint: "Lash, nails",
    synonyms: ["service","services","repair","repairs","installation","install","barbing","barber","hairdresser","makeupartist","massage","cleaning"],
  },
  { key: "other", label: "Other", hint: "Everything else", synonyms: ["other"] },
];

function norm(s: string) {
  return String(s || "").toLowerCase().replace(/[^a-z0-9\s]/g, " ").replace(/\s+/g, " ").trim();
}

export function suggestCategoriesFromText(text: string, max = 3): MarketCategoryKey[] {
  const t = norm(text);
  if (!t) return ["other"];

  const words = new Set(t.split(" ").filter(Boolean));

  const scored = MARKET_CATEGORIES.map((c) => {
    let score = 0;

    for (const syn of c.synonyms) {
      if (words.has(syn)) score += 3;
      for (const w of words) {
        if (w.length >= 4 && syn.length >= 4 && (w.includes(syn) || syn.includes(w))) score += 1;
      }
    }

    return { key: c.key, score };
  })
    .filter((x) => x.score > 0)
    .sort((a, b) => b.score - a.score);

  if (!scored.length) return ["other"];

  const out: MarketCategoryKey[] = [];
  for (const x of scored) {
    if (out.includes(x.key)) continue;
    out.push(x.key);
    if (out.length >= Math.max(1, Math.min(3, Number(max || 3)))) break;
  }

  return out.length ? out : ["other"];
}


==========================================================================================
FILE: src\lib\firebase\market.ts
==========================================================================================

import { db } from "@/lib/firebase/client";
import { collection, getDocs, limit, query } from "firebase/firestore";

export async function listBusinesses(max = 10) {
  const q = query(collection(db, "businesses"), limit(max));
  const snap = await getDocs(q);
  return snap.docs.map((d) => ({ id: d.id, ...(d.data() as any) }));
}

export async function listTrendingProducts(max = 12) {
  // Simple: just grab first products. Later we‚Äôll do analytics-based trending.
  const q = query(collection(db, "products"), limit(max));
  const snap = await getDocs(q);

  // Attach business slug/name if present on product, else best-effort
  return snap.docs.map((d) => {
    const x = d.data() as any;
    return {
      id: d.id,
      name: x.name,
      price: x.price,
      imageUrl: x.images?.[0] ?? null,
      businessId: x.businessId,
      businessSlug: x.businessSlug ?? x.storeSlug ?? "miracle-store",
      businessName: x.businessName ?? "Store",
    };
  });
}


==========================================================================================
FILE: src\lib\search\marketTaxonomy.ts
==========================================================================================

// FILE: src/lib/search/marketTaxonomy.ts
export type MarketCategoryKey =
  | "fashion"
  | "phones"
  | "beauty"
  | "home"
  | "bags"
  | "services"
  | "other";

export const MARKET_CATEGORIES: { key: MarketCategoryKey; label: string; hint: string; synonyms: string[] }[] = [
  {
    key: "fashion",
    label: "Fashion",
    hint: "Clothes, shoes",
    synonyms: [
      "fashion","clothes","cloth","shirt","tshirt","top","gown","dress","skirt","trouser","trousers","pants","jeans","joggers",
      "shoe","shoes","slipper","slippers","slides","slide","sandal","sandals","heels","sneaker","sneakers",
      "cap","hat","jacket","hoodie","native","agbada","kaftan","wear",
      // Nigeria common terms
      "pam","pams",
    ],
  },
  {
    key: "phones",
    label: "Phones",
    hint: "Android, iPhone",
    synonyms: [
      "phone","phones","iphone","ipad","android","samsung","tecno","infinix","itel","redmi","xiaomi",
      "airpod","airpods","earpiece","earpieces","earphone","earphones","charger","charging","powerbank","power",
      "screen","case","casing",
    ],
  },
  {
    key: "beauty",
    label: "Beauty",
    hint: "Hair, makeup",
    synonyms: [
      "beauty","hair","wig","wigs","attachment","braids","braid","weavon","weave","shampoo","conditioner",
      "makeup","lipstick","powder","foundation","lash","lashes","nails","nail","pedicure","manicure","skincare","cream","oil","perfume",
    ],
  },
  {
    key: "home",
    label: "Home",
    hint: "Kitchen, decor",
    synonyms: [
      "home","kitchen","decor","decoration","plate","plates","pot","pots","pan","pans","spoon","cup","mug","bowl",
      "bed","bedsheet","curtain","lamp","chair","table","furniture",
    ],
  },
  {
    key: "bags",
    label: "Bags",
    hint: "Handbags",
    synonyms: ["bag","bags","handbag","handbags","purse","purses","backpack","wallet","luggage","travelbag"],
  },
  {
    key: "services",
    label: "Services",
    hint: "Lash, nails",
    synonyms: ["service","services","repair","repairs","installation","install","barbing","barber","hairdresser","makeupartist","massage","cleaning"],
  },
  { key: "other", label: "Other", hint: "Everything else", synonyms: ["other"] },
];

function norm(s: string) {
  return String(s || "").toLowerCase().replace(/[^a-z0-9\s]/g, " ").replace(/\s+/g, " ").trim();
}

export function suggestCategoriesFromText(text: string, max = 3): MarketCategoryKey[] {
  const t = norm(text);
  if (!t) return ["other"];

  const words = new Set(t.split(" ").filter(Boolean));

  const scored = MARKET_CATEGORIES.map((c) => {
    let score = 0;

    for (const syn of c.synonyms) {
      if (words.has(syn)) score += 3;
      for (const w of words) {
        if (w.length >= 4 && syn.length >= 4 && (w.includes(syn) || syn.includes(w))) score += 1;
      }
    }

    return { key: c.key, score };
  })
    .filter((x) => x.score > 0)
    .sort((a, b) => b.score - a.score);

  if (!scored.length) return ["other"];

  const out: MarketCategoryKey[] = [];
  for (const x of scored) {
    if (out.includes(x.key)) continue;
    out.push(x.key);
    if (out.length >= Math.max(1, Math.min(3, Number(max || 3)))) break;
  }

  return out.length ? out : ["other"];
}


===========================================================================================
KEYWORD HITS (trust/location/attrs/payment/delivery signals) ó helps us find the real sources
===========================================================================================

src\app\account\forgot\page.tsx:3  import { useState } from "react";
src\app\account\forgot\page.tsx:24  const [email, setEmail] = useState("");
src\app\account\forgot\page.tsx:25  const [msg, setMsg] = useState<string | null>(null);
src\app\account\forgot\page.tsx:26  const [ok, setOk] = useState(false);
src\app\account\forgot\page.tsx:27  const [loading, setLoading] = useState(false);
src\app\account\invite\invite-client.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\account\invite\invite-client.tsx:18  const [status, setStatus] = useState<Status>("loading");
src\app\account\invite\invite-client.tsx:19  const [msg, setMsg] = useState<string>("Preparing...");
src\app\account\invite\invite-client.tsx:20  const [errCode, setErrCode] = useState<string>("");
src\app\account\invite\invite-client.tsx:51  if (!user.emailVerified) {
src\app\account\login\login-client.tsx:3  import { useState } from "react";
src\app\account\login\login-client.tsx:14  const [email, setEmail] = useState("");
src\app\account\login\login-client.tsx:15  const [password, setPassword] = useState("");
src\app\account\login\login-client.tsx:16  const [msg, setMsg] = useState<string | null>(null);
src\app\account\login\login-client.tsx:17  const [loading, setLoading] = useState(false);
src\app\account\login\login-client.tsx:32  const emailVerified = !!data?.me?.emailVerified;
src\app\account\login\login-client.tsx:45  if (!emailVerified) {
src\app\account\login\login-client.tsx:82  className="mt-4 w-full rounded-2xl py-3 text-sm font-extrabold text-white shadow-[0_12px_30px_rgba(17,24,39,0.10)] bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-50"
src\app\account\register\page-client.tsx:5  import { useMemo, useState } from "react";
src\app\account\register\page-client.tsx:19  const [mode, setMode] = useState<Mode>("customer");
src\app\account\register\page-client.tsx:21  const [email, setEmail] = useState("");
src\app\account\register\page-client.tsx:22  const [password, setPassword] = useState("");
src\app\account\register\page-client.tsx:25  const [businessName, setBusinessName] = useState("");
src\app\account\register\page-client.tsx:26  const [businessSlug, setBusinessSlug] = useState("");
src\app\account\register\page-client.tsx:28  const [msg, setMsg] = useState<string | null>(null);
src\app\account\register\page-client.tsx:29  const [loading, setLoading] = useState(false);
src\app\account\register\page-client.tsx:163  className="mt-4 w-full rounded-2xl py-3 text-sm font-extrabold text-white shadow-[0_12px_30px_rgba(17,24,39,0.10)] bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-50"
src\app\account\verify\verify-client.tsx:3  import { useEffect, useState } from "react";
src\app\account\verify\verify-client.tsx:13  const [code, setCode] = useState("");
src\app\account\verify\verify-client.tsx:14  const [msg, setMsg] = useState<string | null>(null);
src\app\account\verify\verify-client.tsx:15  const [devCode, setDevCode] = useState<string | null>(null);
src\app\account\verify\verify-client.tsx:16  const [loading, setLoading] = useState(false);
src\app\account\verify\verify-client.tsx:86  className="mt-4 w-full rounded-2xl py-3 text-sm font-extrabold text-white shadow-[0_12px_30px_rgba(17,24,39,0.10)] bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-50"
src\app\account\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\account\page.tsx:6  import { onAuthStateChanged, signOut } from "firebase/auth";
src\app\account\page.tsx:13  const [email, setEmail] = useState<string | null>(null);
src\app\account\page.tsx:14  const [role, setRole] = useState<string | null>(null);
src\app\account\page.tsx:16  const [optOutSlugs, setOptOutSlugs] = useState<string[]>([]);
src\app\account\page.tsx:17  const [optOutInput, setOptOutInput] = useState("");
src\app\account\page.tsx:18  const [optMsg, setOptMsg] = useState<string | null>(null);
src\app\account\page.tsx:19  const [savingOpt, setSavingOpt] = useState(false);
src\app\account\page.tsx:32  return onAuthStateChanged(auth, async (u) => {
src\app\account\page.tsx:106  <div className="relative">
src\app\account\page.tsx:134  <p className="text-xs opacity-95 mt-1 break-all">
src\app\account\page.tsx:226  className="px-4 rounded-2xl text-sm font-extrabold text-white bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-50"
src\app\account\page.tsx:276  <p className="text-[11px] opacity-95">{label}</p>
src\app\admin\analytics\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\admin\analytics\page.tsx:39  export default function AdminPlatformAnalyticsPage() {
src\app\admin\analytics\page.tsx:40  const [range, setRange] = useState<Range>("week");
src\app\admin\analytics\page.tsx:41  const [metric, setMetric] = useState<Metric>("views");
src\app\admin\analytics\page.tsx:44  const [month, setMonth] = useState<string>("");
src\app\admin\analytics\page.tsx:46  const [loading, setLoading] = useState(true);
src\app\admin\analytics\page.tsx:47  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\analytics\page.tsx:49  const [data, setData] = useState<any>(null);
src\app\admin\analytics\page.tsx:70  const j = await api(`/api/admin/analytics/platform${qs}`);
src\app\admin\analytics\page.tsx:97  subtitle="Platform performance (daily tracking)"
src\app\admin\analytics\page.tsx:163  <p className="text-xs opacity-95">Platform summary</p>
src\app\admin\analytics\page.tsx:167  <p className="text-[11px] opacity-95 mt-2">
src\app\admin\analytics\page.tsx:236  <Button variant="secondary" onClick={() => (window.location.href = "/admin/vendors")}>
src\app\admin\analytics\page.tsx:239  <Button variant="secondary" onClick={() => (window.location.href = "/admin/customers")}>
src\app\admin\analytics\page.tsx:242  <Button variant="secondary" onClick={() => (window.location.href = "/admin/finance")}>
src\app\admin\customers\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\admin\customers\page.tsx:23  const [range, setRange] = useState<Range>("week");
src\app\admin\customers\page.tsx:24  const [month, setMonth] = useState<string>("");
src\app\admin\customers\page.tsx:26  const [loading, setLoading] = useState(true);
src\app\admin\customers\page.tsx:27  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\customers\page.tsx:28  const [data, setData] = useState<any>(null);
src\app\admin\customers\page.tsx:122  <p className="text-xs opacity-95">Customer summary</p>
src\app\admin\customers\page.tsx:126  <p className="text-[11px] opacity-95 mt-2">
src\app\admin\disputes\page.tsx:3  import { useEffect, useState } from "react";
src\app\admin\disputes\page.tsx:20  const [items, setItems] = useState<any[]>([]);
src\app\admin\disputes\page.tsx:21  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\disputes\page.tsx:88  const priorityReview = d.priorityDisputeReview === true;
src\app\admin\disputes\page.tsx:109  <b>{String(d.vendorPlanKey || "FREE")}</b>{" "}
src\app\admin\disputes\page.tsx:115  {priorityReview ? (
src\app\admin\disputes\page.tsx:117  Priority review
src\app\admin\finance\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\admin\finance\page.tsx:46  t.includes("subscription")
src\app\admin\finance\page.tsx:62  const [loading, setLoading] = useState(true);
src\app\admin\finance\page.tsx:63  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\finance\page.tsx:64  const [finance, setFinance] = useState<any>(null);
src\app\admin\finance\page.tsx:65  const [ledger, setLedger] = useState<any[]>([]);
src\app\admin\finance\page.tsx:67  // Platform payout details (myBizHub bank)
src\app\admin\finance\page.tsx:68  const [pdLoading, setPdLoading] = useState(false);
src\app\admin\finance\page.tsx:69  const [payoutDetails, setPayoutDetails] = useState<any>(null);
src\app\admin\finance\page.tsx:70  const [bankName, setBankName] = useState("");
src\app\admin\finance\page.tsx:71  const [accountNumber, setAccountNumber] = useState("");
src\app\admin\finance\page.tsx:72  const [accountName, setAccountName] = useState("");
src\app\admin\finance\page.tsx:75  const [pinSet, setPinSet] = useState<boolean>(false);
src\app\admin\finance\page.tsx:76  const [pin, setPin] = useState<string>("");
src\app\admin\finance\page.tsx:79  const [otp, setOtp] = useState<string>("");
src\app\admin\finance\page.tsx:80  const [otpSentMsg, setOtpSentMsg] = useState<string | null>(null);
src\app\admin\finance\page.tsx:81  const [devOtp, setDevOtp] = useState<string | null>(null);
src\app\admin\finance\page.tsx:83  const [withdrawAmountNgn, setWithdrawAmountNgn] = useState<number>(1000);
src\app\admin\finance\page.tsx:84  const [withdrawNote, setWithdrawNote] = useState<string>("");
src\app\admin\finance\page.tsx:86  const [withdrawing, setWithdrawing] = useState(false);
src\app\admin\finance\page.tsx:87  const [sendingOtp, setSendingOtp] = useState(false);
src\app\admin\finance\page.tsx:89  const [platformWithdrawals, setPlatformWithdrawals] = useState<any[]>([]);
src\app\admin\finance\page.tsx:118  async function loadPlatformWithdrawals() {
src\app\admin\finance\page.tsx:120  const data = await api("/api/admin/platform/withdraw");
src\app\admin\finance\page.tsx:121  setPlatformWithdrawals(Array.isArray(data.withdrawals) ? data.withdrawals : []);
src\app\admin\finance\page.tsx:123  setPlatformWithdrawals([]);
src\app\admin\finance\page.tsx:130  const data = await api("/api/admin/platform/payout-details");
src\app\admin\finance\page.tsx:145  async function loadPinState() {
src\app\admin\finance\page.tsx:147  const data = await api("/api/admin/platform/pin");
src\app\admin\finance\page.tsx:155  await Promise.all([loadFinance(), loadPayoutDetails(), loadPinState(), loadPlatformWithdrawals()]);
src\app\admin\finance\page.tsx:164  const subKobo = useMemo(() => Number(finance?.subscriptionRevenueKobo || 0), [finance]);
src\app\admin\finance\page.tsx:171  await api("/api/admin/platform/payout-details", {
src\app\admin\finance\page.tsx:176  setMsg("Platform payout details saved.");
src\app\admin\finance\page.tsx:188  await api("/api/admin/platform/pin", {
src\app\admin\finance\page.tsx:195  await loadPinState();
src\app\admin\finance\page.tsx:206  const data = await api("/api/admin/platform/withdraw/send-code", { method: "POST" });
src\app\admin\finance\page.tsx:222  await api("/api/admin/platform/withdraw", {
src\app\admin\finance\page.tsx:233  setMsg("Platform withdrawal recorded. (Manual payout)");
src\app\admin\finance\page.tsx:258  subtitle="Platform finance overview"
src\app\admin\finance\page.tsx:275  <p className="text-xs opacity-95">Total platform balance</p>
src\app\admin\finance\page.tsx:277  <p className="text-[11px] opacity-90 mt-2">
src\app\admin\finance\page.tsx:285  <p className="text-xs text-biz-muted">Subscription revenue</p>
src\app\admin\finance\page.tsx:294  {/* Platform payout details */}
src\app\admin\finance\page.tsx:296  title="Platform payout details"
src\app\admin\finance\page.tsx:297  subtitle="Where you withdraw platform funds to"
src\app\admin\finance\page.tsx:321  <SectionCard title="Create withdrawal PIN" subtitle="Required before any platform withdrawal">
src\app\admin\finance\page.tsx:343  {/* Platform withdrawal */}
src\app\admin\finance\page.tsx:344  <SectionCard title="Withdraw platform funds" subtitle="Manual payout + strict verification">
src\app\admin\finance\page.tsx:404  Save platform payout details first.
src\app\admin\finance\page.tsx:410  {/* Platform withdrawals history */}
src\app\admin\finance\page.tsx:411  <SectionCard title="Platform withdrawals" subtitle="History (manual payouts)">
src\app\admin\finance\page.tsx:412  {platformWithdrawals.length === 0 ? (
src\app\admin\finance\page.tsx:413  <div className="text-sm text-biz-muted">No platform withdrawals yet.</div>
src\app\admin\finance\page.tsx:416  {platformWithdrawals.slice(0, 30).map((w) => (
src\app\admin\finance\page.tsx:439  <Button variant="secondary" onClick={loadPlatformWithdrawals}>
src\app\admin\finance\page.tsx:446  <SectionCard title="Ledger" subtitle="Latest platform inflows/outflows (MVP)">
src\app\admin\finance\page.tsx:497  Note: Vendor payouts are handled in Admin ? Withdrawals. Platform withdrawals are logged above.
src\app\admin\packages\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\admin\packages\page.tsx:11  type PlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\app\admin\packages\page.tsx:20  const [loading, setLoading] = useState(true);
src\app\admin\packages\page.tsx:21  const [saving, setSaving] = useState(false);
src\app\admin\packages\page.tsx:22  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\packages\page.tsx:23  const [cfg, setCfg] = useState<any>(null);
src\app\admin\packages\page.tsx:51  const plans: PlanKey[] = ["FREE", "LAUNCH", "MOMENTUM", "APEX"];
src\app\admin\packages\page.tsx:72  function setFeature(plan: PlanKey, key: string, value: boolean) {
src\app\admin\packages\page.tsx:88  function setLimit(plan: PlanKey, key: string, value: number) {
src\app\admin\packages\page.tsx:119  const usdEligiblePlan = p === "MOMENTUM" || p === "APEX";
src\app\admin\packages\page.tsx:141  label="Verified Apex badge (earned)"
src\app\admin\packages\page.tsx:142  value={!!f.apexVerifiedBadge}
src\app\admin\packages\page.tsx:145  onClick={(v) => setFeature(p, "apexVerifiedBadge", v)}
src\app\admin\packages\page.tsx:167  <Toggle label="Dead stock" value={!!f.deadStock} onClick={(v) => setFeature(p, "deadStock", v)} />
src\app\admin\packages\page.tsx:171  <Toggle label="Installment plans" value={!!f.installmentPlans} onClick={(v) => setFeature(p, "installmentPlans", v)} />
src\app\admin\packages\page.tsx:174  label="USD card checkout (customers)"
src\app\admin\packages\page.tsx:175  value={!!f.usdCheckout}
src\app\admin\packages\page.tsx:176  disabled={!usdEligiblePlan}
src\app\admin\packages\page.tsx:177  helper={!usdEligiblePlan ? "Momentum/Apex only" : "Allow customers pay in USD (Flutterwave only)"}
src\app\admin\packages\page.tsx:178  onClick={(v) => setFeature(p, "usdCheckout", v)}
src\app\admin\packages\page.tsx:201  <LimitInput label="Dead stock max rows" value={safeNum(l.deadStockMaxRows, 0)} onChange={(n) => setLimit(p, "deadStockMaxRows", n)} />
src\app\admin\packages\page.tsx:202  <LimitInput label="Dead stock max days" value={safeNum(l.deadStockMaxDays, 0)} onChange={(n) => setLimit(p, "deadStockMaxDays", n)} />
src\app\admin\packages\page.tsx:204  label="Dead stock ignore new (days)"
src\app\admin\packages\page.tsx:205  value={safeNum(l.deadStockIgnoreNewerThanDays, 7)}
src\app\admin\packages\page.tsx:206  onChange={(n) => setLimit(p, "deadStockIgnoreNewerThanDays", n)}
src\app\admin\packages\page.tsx:249  disabled ? "opacity-50 cursor-not-allowed" : "",
src\app\admin\reports\page.tsx:3  import { useEffect, useState } from "react";
src\app\admin\reports\page.tsx:10  const [loading, setLoading] = useState(true);
src\app\admin\reports\page.tsx:11  const [sending, setSending] = useState(false);
src\app\admin\reports\page.tsx:12  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\reports\page.tsx:13  const [report, setReport] = useState<any>(null);
src\app\admin\reports\page.tsx:88  <p className="text-sm font-bold text-biz-ink">Preview</p>
src\app\admin\subscription\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\admin\subscription\page.tsx:46  const [loading, setLoading] = useState(true);
src\app\admin\subscription\page.tsx:47  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\subscription\page.tsx:49  const [rows, setRows] = useState<any[]>([]);
src\app\admin\subscription\page.tsx:50  const [unreadCount, setUnreadCount] = useState(0);
src\app\admin\subscription\page.tsx:108  const upgrades = useMemo(() => rows.filter((r) => String(r.type || "").includes("subscription")), [rows]);
src\app\admin\subscription\page.tsx:153  const planKey = String(n.planKey || "");
src\app\admin\subscription\page.tsx:183  {planKey ? (
src\app\admin\subscription\page.tsx:185  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\admin\vendors\[businessId]\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\admin\vendors\[businessId]\page.tsx:16  type PlanKey = "LAUNCH" | "MOMENTUM" | "APEX";
src\app\admin\vendors\[businessId]\page.tsx:71  const [range, setRange] = useState<Range>("week");
src\app\admin\vendors\[businessId]\page.tsx:72  const [month, setMonth] = useState<string>("");
src\app\admin\vendors\[businessId]\page.tsx:73  const [metric, setMetric] = useState<Metric>("views");
src\app\admin\vendors\[businessId]\page.tsx:75  const [loading, setLoading] = useState(true);
src\app\admin\vendors\[businessId]\page.tsx:76  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\vendors\[businessId]\page.tsx:77  const [data, setData] = useState<any>(null);
src\app\admin\vendors\[businessId]\page.tsx:79  // ? subscription control (manual override)
src\app\admin\vendors\[businessId]\page.tsx:80  const [planKey, setPlanKey] = useState<PlanKey>("LAUNCH");
src\app\admin\vendors\[businessId]\page.tsx:81  const [cycle, setCycle] = useState<Cycle>("monthly");
src\app\admin\vendors\[businessId]\page.tsx:82  const [lastPaymentReference, setLastPaymentReference] = useState<string>("manual-admin");
src\app\admin\vendors\[businessId]\page.tsx:83  const [savingSub, setSavingSub] = useState(false);
src\app\admin\vendors\[businessId]\page.tsx:84  const [subMsg, setSubMsg] = useState<string | null>(null);
src\app\admin\vendors\[businessId]\page.tsx:107  // prefill dropdown from current subscription (if any)
src\app\admin\vendors\[businessId]\page.tsx:108  const s = j?.business?.subscription || null;
src\app\admin\vendors\[businessId]\page.tsx:109  if (s?.planKey === "LAUNCH" || s?.planKey === "MOMENTUM" || s?.planKey === "APEX") {
src\app\admin\vendors\[businessId]\page.tsx:110  setPlanKey(String(s.planKey) as PlanKey);
src\app\admin\vendors\[businessId]\page.tsx:142  if (biz?.subscription?.planKey && Number(biz?.subscription?.expiresAtMs || 0) > Date.now()) {
src\app\admin\vendors\[businessId]\page.tsx:143  return `Subscribed ï ${biz.subscription.planKey}`;
src\app\admin\vendors\[businessId]\page.tsx:145  if (biz?.trial?.planKey && Number(biz?.trial?.endsAtMs || 0) > Date.now()) {
src\app\admin\vendors\[businessId]\page.tsx:146  return `Trial ï ${biz.trial.planKey}`;
src\app\admin\vendors\[businessId]\page.tsx:151  const sub = biz?.subscription || null;
src\app\admin\vendors\[businessId]\page.tsx:158  await api(`/api/admin/vendors/${encodeURIComponent(businessId)}/subscription`, {
src\app\admin\vendors\[businessId]\page.tsx:163  planKey,
src\app\admin\vendors\[businessId]\page.tsx:169  setSubMsg(`Activated ${planKey} (${cycle}).`);
src\app\admin\vendors\[businessId]\page.tsx:180  const ok = confirm("Remove this vendor subscription and return them to Free access?");
src\app\admin\vendors\[businessId]\page.tsx:186  await api(`/api/admin/vendors/${encodeURIComponent(businessId)}/subscription`, {
src\app\admin\vendors\[businessId]\page.tsx:192  setSubMsg("Subscription removed.");
src\app\admin\vendors\[businessId]\page.tsx:195  setSubMsg(e?.message || "Failed to remove subscription");
src\app\admin\vendors\[businessId]\page.tsx:215  {/* ? Subscription control */}
src\app\admin\vendors\[businessId]\page.tsx:216  <SectionCard title="Subscription control" subtitle="Admin manual upgrade (override anytime)">
src\app\admin\vendors\[businessId]\page.tsx:233  value={planKey}
src\app\admin\vendors\[businessId]\page.tsx:234  onChange={(e) => setPlanKey(e.target.value as PlanKey)}
src\app\admin\vendors\[businessId]\page.tsx:284  Note: Paystack can still auto-activate plans. This is an admin override tool.
src\app\admin\vendors\[businessId]\page.tsx:329  <p className="text-xs opacity-95">Vendor</p>
src\app\admin\vendors\[businessId]\page.tsx:332  <span className="opacity-95 text-[11px]">({biz?.slug || "ó"})</span>
src\app\admin\vendors\[businessId]\page.tsx:334  <p className="text-[11px] opacity-95 mt-2">
src\app\admin\vendors\[businessId]\page.tsx:411  subtitle="Latest orders in this window"
src\app\admin\vendors\[businessId]\page.tsx:447  <Button onClick={() => router.push("/admin/analytics")}>Platform analytics</Button>
src\app\admin\vendors\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\admin\vendors\page.tsx:27  : t.includes("subscription")
src\app\admin\vendors\page.tsx:41  const [q, setQ] = useState("");
src\app\admin\vendors\page.tsx:42  const [loading, setLoading] = useState(true);
src\app\admin\vendors\page.tsx:43  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\vendors\page.tsx:44  const [vendors, setVendors] = useState<any[]>([]);
src\app\admin\vendors\page.tsx:81  const planKey = String(ent.planKey || "FREE");
src\app\admin\vendors\page.tsx:86  if (source === "subscription" && exp > Date.now()) activePaid++;
src\app\admin\vendors\page.tsx:96  subtitle="Search and review vendor performance"
src\app\admin\vendors\page.tsx:131  const planKey = String(ent.planKey || "FREE");
src\app\admin\vendors\page.tsx:136  planKey === "FREE"
src\app\admin\vendors\page.tsx:139  ? `Trial ï ${planKey}`
src\app\admin\vendors\page.tsx:140  : `Subscribed ï ${planKey}`;
src\app\admin\vendors\page.tsx:157  {planKey !== "FREE" ? (
src\app\admin\verification\page.tsx:4  import { useEffect, useState } from "react";
src\app\admin\verification\page.tsx:21  const [loading, setLoading] = useState(true);
src\app\admin\verification\page.tsx:22  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\verification\page.tsx:23  const [items, setItems] = useState<any[]>([]);
src\app\admin\verification\page.tsx:24  const [note, setNote] = useState("");
src\app\admin\verification\page.tsx:68  <GradientHeader title="Verification" subtitle="Tier reviews" showBack={true} />
src\app\admin\withdrawals\page.tsx:3  import { useEffect, useState } from "react";
src\app\admin\withdrawals\page.tsx:29  const [loading, setLoading] = useState(true);
src\app\admin\withdrawals\page.tsx:30  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\withdrawals\page.tsx:31  const [items, setItems] = useState<any[]>([]);
src\app\admin\withdrawals\page.tsx:32  const [note, setNote] = useState("");
src\app\admin\page.tsx:3  import { useEffect, useState } from "react";
src\app\admin\page.tsx:12  const [me, setMe] = useState<any>(null);
src\app\admin\page.tsx:13  const [msg, setMsg] = useState<string | null>(null);
src\app\admin\page.tsx:15  const [unread, setUnread] = useState<number>(0);
src\app\admin\page.tsx:65  className="relative rounded-2xl border border-biz-line bg-white px-3 py-2 text-xs font-extrabold shadow-soft"
src\app\admin\page.tsx:82  <p className="text-xs opacity-95 mt-1">Role: {me?.role || "ó"}</p>
src\app\api\admin\analytics\platform\route.ts:4  import { dayKeysBetween, fetchPlatformDailyMetrics, monthRangeFromYYYYMM } from "@/lib/metrics/daily";
src\app\api\admin\analytics\platform\route.ts:13  // Historical month view: /api/admin/analytics/platform?range=month&month=2026-01
src\app\api\admin\analytics\platform\route.ts:43  const metricDocs = await fetchPlatformDailyMetrics(dayKeys);
src\app\api\admin\analytics\platform\route.ts:90  // Daily change (today vs yesterday) from platformMetricsDaily
src\app\api\admin\apex\trust\recompute\route.ts:17  pt === "paystack_escrow" ||
src\app\api\admin\apex\trust\recompute\route.ts:27  async function updateProductsForBusiness(args: { businessId: string; apexBadgeActive: boolean; apexRiskScore: number }) {
src\app\api\admin\apex\trust\recompute\route.ts:28  const { businessId, apexBadgeActive, apexRiskScore } = args;
src\app\api\admin\apex\trust\recompute\route.ts:45  apexBadgeActive,
src\app\api\admin\apex\trust\recompute\route.ts:79  const snap = await adminDb.collection("businesses").where("subscription.planKey", "==", "APEX").limit(800).get();
src\app\api\admin\apex\trust\recompute\route.ts:87  const planKey = String(plan.planKey || "FREE").toUpperCase();
src\app\api\admin\apex\trust\recompute\route.ts:88  const hasSub = !!plan.hasActiveSubscription;
src\app\api\admin\apex\trust\recompute\route.ts:90  const badgeFeatureEnabled = planKey === "APEX" && hasSub && !!plan.features?.apexVerifiedBadge;
src\app\api\admin\apex\trust\recompute\route.ts:91  const riskShieldEnabled = planKey === "APEX" && hasSub && !!plan.features?.apexSmartRiskShield;
src\app\api\admin\apex\trust\recompute\route.ts:109  await updateProductsForBusiness({ businessId: bid, apexBadgeActive: false, apexRiskScore: 0 });
src\app\api\admin\apex\trust\recompute\route.ts:115  const verificationTier = Number(plan?.business?.verificationTier || 0);
src\app\api\admin\apex\trust\recompute\route.ts:150  .collection("vendorPolicyViolations")
src\app\api\admin\apex\trust\recompute\route.ts:156  const violations30 = v30.docs.length;
src\app\api\admin\apex\trust\recompute\route.ts:181  if (violations30 > 0) {
src\app\api\admin\apex\trust\recompute\route.ts:196  } else if (verificationTier < 1) {
src\app\api\admin\apex\trust\recompute\route.ts:202  } else if (violations30 > 0) {
src\app\api\admin\apex\trust\recompute\route.ts:218  verificationTier,
src\app\api\admin\apex\trust\recompute\route.ts:224  violations30,
src\app\api\admin\apex\trust\recompute\route.ts:238  apexBadgeActive: badgeActive,
src\app\api\admin\finance\route.ts:12  const financeSnap = await adminDb.collection("platform").doc("finance").get();
src\app\api\admin\finance\route.ts:16  .collection("platformLedger")
src\app\api\admin\finance\route.ts:28  subscriptionRevenueKobo: Number(finance.subscriptionRevenueKobo || 0),
src\app\api\admin\finance\route.ts:34  subscriptionRevenueKobo: 0,
src\app\api\admin\notifications\route.ts:9  async function unreadCountFast() {
src\app\api\admin\notifications\route.ts:39  const unreadCount = await unreadCountFast();
src\app\api\admin\plan-config\route.ts:15  const snap = await adminDb.collection("platform").doc("planConfig").get();
src\app\api\admin\plan-config\route.ts:39  await adminDb.collection("platform").doc("planConfig").set(
src\app\api\admin\platform\pin\route.ts:1  // FILE: src/app/api/admin/platform/pin/route.ts
src\app\api\admin\platform\pin\route.ts:3  import { requireAdminSessionVerified } from "@/lib/admin/securityServer";
src\app\api\admin\platform\pin\route.ts:4  import { getAdminWithdrawPinState, setAdminWithdrawPin } from "@/lib/admin/withdrawPinServer";
src\app\api\admin\platform\pin\route.ts:11  const me = await requireAdminSessionVerified(req);
src\app\api\admin\platform\pin\route.ts:12  const st = await getAdminWithdrawPinState(me.uid);
src\app\api\admin\platform\pin\route.ts:21  const me = await requireAdminSessionVerified(req);
src\app\api\admin\platform\withdraw\payout-details\route.ts:1  // FILE: src/app/api/admin/platform/payout-details/route.ts
src\app\api\admin\platform\withdraw\payout-details\route.ts:5  import { requireAdminSessionVerified } from "@/lib/admin/securityServer";
src\app\api\admin\platform\withdraw\payout-details\route.ts:16  await requireAdminSessionVerified(req);
src\app\api\admin\platform\withdraw\payout-details\route.ts:18  const snap = await adminDb.collection("platform").doc("payoutDetails").get();
src\app\api\admin\platform\withdraw\payout-details\route.ts:29  const me = await requireAdminSessionVerified(req);
src\app\api\admin\platform\withdraw\payout-details\route.ts:40  await adminDb.collection("platform").doc("payoutDetails").set(
src\app\api\admin\platform\withdraw\send-code\route.ts:1  // FILE: src/app/api/admin/platform/withdraw/send-code/route.ts
src\app\api\admin\platform\withdraw\send-code\route.ts:3  import { requireAdminSessionVerified, sendAdminOtp } from "@/lib/admin/securityServer";
src\app\api\admin\platform\withdraw\send-code\route.ts:10  const me = await requireAdminSessionVerified(req);
src\app\api\admin\platform\withdraw\route.ts:1  // FILE: src/app/api/admin/platform/withdraw/route.ts
src\app\api\admin\platform\withdraw\route.ts:5  import { requireAdminSessionVerified, verifyAdminOtp } from "@/lib/admin/securityServer";
src\app\api\admin\platform\withdraw\route.ts:23  const me = await requireAdminSessionVerified(req);
src\app\api\admin\platform\withdraw\route.ts:46  const financeRef = adminDb.collection("platform").doc("finance");
src\app\api\admin\platform\withdraw\route.ts:47  const wdRef = adminDb.collection("platformWithdrawals").doc();
src\app\api\admin\platform\withdraw\route.ts:48  const ledgerRef = adminDb.collection("platformLedger").doc();
src\app\api\admin\platform\withdraw\route.ts:58  return { ok: false, status: 400, error: "Insufficient platform balance" as const, balanceKobo };
src\app\api\admin\platform\withdraw\route.ts:61  // Deduct from platform balance
src\app\api\admin\platform\withdraw\route.ts:66  platformWithdrawalOutflowKobo: FieldValue.increment(amountKobo),
src\app\api\admin\platform\withdraw\route.ts:88  type: "platform_withdrawal",
src\app\api\admin\platform\withdraw\route.ts:107  code === "ADMIN_SESSION_NOT_VERIFIED" ? 401 :
src\app\api\admin\platform\withdraw\route.ts:118  await requireAdminSessionVerified(req);
src\app\api\admin\platform\withdraw\route.ts:121  .collection("platformWithdrawals")
src\app\api\admin\reports\daily\route.ts:4  import { buildDailyPlatformReport } from "@/lib/reports/platformDaily";
src\app\api\admin\reports\daily\route.ts:38  const report = await buildDailyPlatformReport();
src\app\api\admin\reports\daily\route.ts:53  const report = await buildDailyPlatformReport();
src\app\api\admin\security\session\route.ts:12  return NextResponse.json({ ok: true, verified: s.verified, verifiedUntilMs: s.verifiedUntilMs });
src\app\api\admin\security\verify-code\route.ts:6  markAdminSessionVerified,
src\app\api\admin\security\verify-code\route.ts:25  const s = await markAdminSessionVerified({
src\app\api\admin\security\verify-code\route.ts:30  return NextResponse.json({ ok: true, verifiedUntilMs: s.verifiedUntilMs });
src\app\api\admin\vendors\[businessId]\analytics\route.ts:140  // Recent orders (latest 10 within window)
src\app\api\admin\vendors\[businessId]\analytics\route.ts:161  subscription: biz.subscription ?? null,
src\app\api\admin\vendors\[businessId]\subscription\route.ts:5  import { computeExpiryMs, type BizhubPlanKey, type BizhubBillingCycle } from "@/lib/bizhubPlans";
src\app\api\admin\vendors\[businessId]\subscription\route.ts:10  function cleanPlanKey(v: any): BizhubPlanKey {
src\app\api\admin\vendors\[businessId]\subscription\route.ts:43  subscription: null,
src\app\api\admin\vendors\[businessId]\subscription\route.ts:44  subscriptionAdmin: {
src\app\api\admin\vendors\[businessId]\subscription\route.ts:56  type: "subscription_cleared",
src\app\api\admin\vendors\[businessId]\subscription\route.ts:66  const planKey = cleanPlanKey(body?.planKey);
src\app\api\admin\vendors\[businessId]\subscription\route.ts:69  if (planKey === "FREE") {
src\app\api\admin\vendors\[businessId]\subscription\route.ts:71  { ok: false, error: "Use action=clear to remove subscription, or set LAUNCH/MOMENTUM/APEX." },
src\app\api\admin\vendors\[businessId]\subscription\route.ts:82  subscription: {
src\app\api\admin\vendors\[businessId]\subscription\route.ts:83  planKey,
src\app\api\admin\vendors\[businessId]\subscription\route.ts:90  subscriptionAdmin: {
src\app\api\admin\vendors\[businessId]\subscription\route.ts:102  type: "subscription_set",
src\app\api\admin\vendors\[businessId]\subscription\route.ts:104  planKey,
src\app\api\admin\vendors\[businessId]\subscription\route.ts:112  return NextResponse.json({ ok: true, planKey, cycle, startedAtMs, expiresAtMs });
src\app\api\admin\vendors\route.ts:50  const entitlement = getEntitlement({ trial: b.trial ?? null, subscription: b.subscription ?? null });
src\app\api\admin\vendors\route.ts:60  subscription: b.subscription ?? null,
src\app\api\admin\verification\route.ts:94  verification[tier].status = decision === "approve" ? "verified" : "rejected";
src\app\api\admin\verification\route.ts:95  verification[tier].reviewedAtMs = nowMs;
src\app\api\admin\verification\route.ts:96  verification[tier].reviewedByUid = me.uid;
src\app\api\admin\verification\route.ts:110  reviewedAtMs: nowMs,
src\app\api\admin\verification\route.ts:111  reviewedAt: FieldValue.serverTimestamp(),
src\app\api\admin\verification\route.ts:112  reviewedByUid: me.uid,
src\app\api\admin\withdrawals\route.ts:22  // Keep it simple: load latest 200 and filter in memory (no index stress)
src\app\api\admin\withdrawals\route.ts:62  const financeRef = adminDb.collection("platform").doc("finance");
src\app\api\admin\withdrawals\route.ts:63  const ledgerRef = adminDb.collection("platformLedger").doc();
src\app\api\admin\withdrawals\route.ts:126  // platform outflow + ledger
src\app\api\auth\verify-email-code\route.ts:41  // Mark email verified in Firebase Auth
src\app\api\auth\verify-email-code\route.ts:42  await adminAuth.updateUser(me.uid, { emailVerified: true });
src\app\api\disputes\create\route.ts:40  function planPriority(args: { planKey: string; apexPriorityOverride: boolean; momentumPriorityReview: boolean }) {
src\app\api\disputes\create\route.ts:41  const k = String(args.planKey || "FREE").toUpperCase();
src\app\api\disputes\create\route.ts:47  if (k === "MOMENTUM" && args.momentumPriorityReview) return 3.6;
src\app\api\disputes\create\route.ts:106  const planKey = String(plan?.planKey || "FREE").toUpperCase();
src\app\api\disputes\create\route.ts:109  !!plan?.features?.apexPriorityDisputeOverride && planKey === "APEX" && !!plan?.hasActiveSubscription;
src\app\api\disputes\create\route.ts:116  const momentumPriorityReview =
src\app\api\disputes\create\route.ts:117  planKey === "MOMENTUM" &&
src\app\api\disputes\create\route.ts:118  !!plan?.hasActiveSubscription &&
src\app\api\disputes\create\route.ts:119  addonIsActive(entMap["addon_priority_dispute_review"], Date.now());
src\app\api\disputes\create\route.ts:141  const priority = planPriority({ planKey, apexPriorityOverride, momentumPriorityReview });
src\app\api\disputes\create\route.ts:171  vendorPlanKey: planKey,
src\app\api\disputes\create\route.ts:176  priorityDisputeReview: momentumPriorityReview ? true : false,
src\app\api\disputes\create\route.ts:179  const isEscrow = order.paymentType === "paystack_escrow";
src\app\api\escrow\confirm\route.ts:12  async function verifyPaystack(reference: string) {
src\app\api\escrow\confirm\route.ts:13  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\escrow\confirm\route.ts:14  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\escrow\confirm\route.ts:16  const res = await fetch(`https://api.paystack.co/transaction/verify/${encodeURIComponent(reference)}`, {
src\app\api\escrow\confirm\route.ts:21  if (!data.status) throw new Error(data.message || "Paystack verify failed");
src\app\api\escrow\confirm\route.ts:25  function fxNgnPerUsd() {
src\app\api\escrow\confirm\route.ts:26  const v = process.env.FX_NGN_PER_USD || process.env.NGN_PER_USD || process.env.USD_NGN_RATE || "";
src\app\api\escrow\confirm\route.ts:58  const type = String(s.type || "delivery") === "pickup" ? "pickup" : "delivery";
src\app\api\escrow\confirm\route.ts:59  const name = String(s.name || "").slice(0, 60) || (type === "pickup" ? "Pickup" : "Delivery");
src\app\api\escrow\confirm\route.ts:86  let providerName: "paystack" | "flutterwave" = "paystack";
src\app\api\escrow\confirm\route.ts:130  const paystackTx = await verifyPaystack(reference);
src\app\api\escrow\confirm\route.ts:132  paidStatus = String(paystackTx.status || "");
src\app\api\escrow\confirm\route.ts:134  return NextResponse.json({ error: `Payment not successful: ${paidStatus}`, raw: paystackTx }, { status: 400 });
src\app\api\escrow\confirm\route.ts:137  paidCurrency = String(paystackTx.currency || "NGN").toUpperCase();
src\app\api\escrow\confirm\route.ts:138  paidMinor = Number(paystackTx.amount || 0);
src\app\api\escrow\confirm\route.ts:139  paidAt = paystackTx.paid_at || null;
src\app\api\escrow\confirm\route.ts:140  channel = paystackTx.channel || null;
src\app\api\escrow\confirm\route.ts:141  rawMetadata = normalizeMetadata(paystackTx.metadata);
src\app\api\escrow\confirm\route.ts:142  providerName = "paystack";
src\app\api\escrow\confirm\route.ts:172  if (chargeCurrency === "USD") {
src\app\api\escrow\confirm\route.ts:173  const fx = fxNgnPerUsd();
src\app\api\escrow\confirm\route.ts:174  if (!fx) return NextResponse.json({ error: "USD payments not configured (missing FX_NGN_PER_USD)" }, { status: 500 });
src\app\api\escrow\confirm\route.ts:176  const expectedUsdCents = Math.round(expectedKobo / fx);
src\app\api\escrow\confirm\route.ts:178  if (paidCurrency !== "USD") return NextResponse.json({ error: "Currency mismatch (expected USD)" }, { status: 400 });
src\app\api\escrow\confirm\route.ts:180  if (paidMinor !== expectedUsdCents) {
src\app\api\escrow\confirm\route.ts:186  expectedUsdCents,
src\app\api\escrow\confirm\route.ts:187  paidUsdCents: paidMinor,
src\app\api\escrow\confirm\route.ts:188  currency: "USD",
src\app\api\escrow\confirm\route.ts:199  { error: "Amount mismatch. Please refresh checkout and try again.", code: "AMOUNT_MISMATCH", expectedUsdCents, paidUsdCents: paidMinor },
src\app\api\escrow\confirm\route.ts:268  saleType: it.saleType ?? null,
src\app\api\escrow\confirm\route.ts:269  salePercent: it.salePercent ?? null,
src\app\api\escrow\confirm\route.ts:270  saleAmountOffNgn: it.saleAmountOffNgn ?? null,
src\app\api\escrow\confirm\route.ts:290  paymentType: "paystack_escrow",
src\app\api\escrow\confirm\route.ts:299  chargeCurrency: chargeCurrency === "USD" ? "USD" : "NGN",
src\app\api\escrow\confirm\route.ts:301  fxNgnPerUsd: chargeCurrency === "USD" ? fxNgnPerUsd() : null,
src\app\api\escrow\confirm\route.ts:334  chargeCurrency: chargeCurrency === "USD" ? "USD" : "NGN",
src\app\api\me\route.ts:15  me: { ...me, emailVerified: !!u.emailVerified },
src\app\api\orders\chat\create\route.ts:9  function hasActiveSubscription(biz: any) {
src\app\api\orders\chat\create\route.ts:10  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\orders\chat\create\route.ts:11  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\orders\chat\create\route.ts:104  const subscribed = hasActiveSubscription(biz);
src\app\api\orders\chat\create\route.ts:115  { ok: false, code: "SUBSCRIPTION_REQUIRED", error: "Continue in Chat requires an active subscription." },
src\app\api\orders\direct\create\route.ts:20  const type = String(s.type || "delivery") === "pickup" ? "pickup" : "delivery";
src\app\api\orders\direct\create\route.ts:21  const name = String(s.name || "").slice(0, 60) || (type === "pickup" ? "Pickup" : "Delivery");
src\app\api\orders\direct\create\route.ts:119  saleType: it.saleType ?? null,
src\app\api\orders\direct\create\route.ts:120  salePercent: it.salePercent ?? null,
src\app\api\orders\direct\create\route.ts:121  saleAmountOffNgn: it.saleAmountOffNgn ?? null,
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:1  // FILE: src/app/api/orders/[orderId]/installments/[idx]/paystack/init/route.ts
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:36  return NextResponse.json({ ok: false, error: "Invalid installment index" }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:54  if (String(o?.paymentType || "") !== "paystack_escrow") {
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:59  const list = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:61  return NextResponse.json({ ok: false, error: "No installment plan found on this order." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:63  if (!list[i]) return NextResponse.json({ ok: false, error: "Installment not found." }, { status: 404 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:68  return NextResponse.json({ ok: false, error: "Installment already paid." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:73  return NextResponse.json({ ok: false, error: "Invalid installment amount." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:80  const redirect_url = `${baseUrl}/orders/${encodeURIComponent(orderIdClean)}?installmentIdx=${i}`;
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:96  title: "Bizhub Installment Payment",
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:97  description: `Order ${orderIdClean.slice(0, 8)} ï Installment ${i + 1}`,
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:99  type: "installment",
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:101  installmentIdx: i,
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:116  // Paystack (kept, hidden)
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:118  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:119  if (!secret) return NextResponse.json({ ok: false, error: "Missing PAYSTACK_SECRET_KEY" }, { status: 500 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:128  installmentIdx: i,
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:129  type: "installment",
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:133  const r = await fetch("https://api.paystack.co/transaction/initialize", {
src\app\api\orders\[orderId]\installments\[idx]\paystack\init\route.ts:151  provider: "paystack",
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:1  // FILE: src/app/api/orders/[orderId]/installments/[idx]/paystack/verify/route.ts
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:21  function computePaidKobo(installments: any[]) {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:22  return (Array.isArray(installments) ? installments : []).reduce((sum, x) => {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:27  function allSettled(installments: any[]) {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:28  const arr = Array.isArray(installments) ? installments : [];
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:32  async function paystackVerify(reference: string) {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:33  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:34  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:36  const r = await fetch(`https://api.paystack.co/transaction/verify/${encodeURIComponent(reference)}`, {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:55  return NextResponse.json({ ok: false, error: "Invalid installment index" }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:60  // reference == Paystack reference OR Flutterwave tx_ref
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:85  if (String(o?.paymentType || "") !== "paystack_escrow") {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:90  const list = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:92  return NextResponse.json({ ok: false, error: "No installment plan on this order." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:95  if (i >= list.length) return NextResponse.json({ ok: false, error: "Installment not found." }, { status: 404 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:136  return NextResponse.json({ ok: false, error: "Amount does not match this installment." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:148  const metaIdx = Number((flwTx as any)?.meta?.installmentIdx);
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:153  return NextResponse.json({ ok: false, error: "Payment reference does not belong to this installment." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:162  reviewedAtMs: now,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:164  paystack: null,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:169  verifiedAtMs: now,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:182  installments: next,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:202  // Paystack (kept, hidden)
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:204  const verified = await paystackVerify(reference);
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:206  const status = String(verified?.status || "").toLowerCase();
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:211  const currency = String(verified?.currency || "NGN").toUpperCase();
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:216  const paidAmountKobo = Number(verified?.amount || 0);
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:220  return NextResponse.json({ ok: false, error: "Invalid amount from Paystack." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:224  return NextResponse.json({ ok: false, error: "Amount does not match this installment." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:228  const psEmail = lowerEmail(verified?.customer?.email || "");
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:230  return NextResponse.json({ ok: false, error: "Paystack email does not match this order." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:233  const metaOrderId = String(verified?.metadata?.orderId || verified?.metadata?.order_id || "");
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:244  reviewedAtMs: now,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:246  paystack: {
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:249  verifiedAtMs: now,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:250  paidAtMs: verified?.paid_at ? new Date(String(verified.paid_at)).getTime() : null,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:251  channel: verified?.channel || null,
src\app\api\orders\[orderId]\installments\[idx]\paystack\verify\route.ts:264  installments: next,
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:55  if (!Number.isFinite(i) || i < 0) return NextResponse.json({ ok: false, error: "Invalid installment index" }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:70  if (!access?.features?.installmentPlans) {
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:72  { ok: false, code: "FEATURE_LOCKED", error: "Installment payments are not available for this store." },
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:90  const list = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:92  return NextResponse.json({ ok: false, error: "No installment plan on this order." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:95  if (i >= list.length) return NextResponse.json({ ok: false, error: "Installment not found." }, { status: 404 });
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:99  return NextResponse.json({ ok: false, error: "This installment is already completed." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:130  const folder = `bizhub/installment-proofs/${businessId}/${orderIdClean}/i${i}`;
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:144  reviewedAtMs: null,
src\app\api\orders\[orderId]\installments\[idx]\proof\route.ts:168  paymentPlan: { ...plan, updatedAtMs: now, installments: next },
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:16  function computePaidKobo(installments: any[]) {
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:17  return (Array.isArray(installments) ? installments : []).reduce((sum, x) => {
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:22  function allSettled(installments: any[]) {
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:23  const arr = Array.isArray(installments) ? installments : [];
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:37  if (!access?.features?.installmentPlans) {
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:39  { ok: false, code: "FEATURE_LOCKED", error: "Installment plans are locked on your plan." },
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:49  if (!Number.isFinite(i) || i < 0) return NextResponse.json({ ok: false, error: "Invalid installment index" }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:68  // Only bank transfer installments need manual review
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:74  const list = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:76  return NextResponse.json({ ok: false, error: "No installment plan on this order." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:79  if (i >= list.length) return NextResponse.json({ ok: false, error: "Installment not found." }, { status: 404 });
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:83  return NextResponse.json({ ok: false, error: "No proof uploaded for this installment yet." }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:90  next[i] = { ...inst, status: "accepted", reviewedAtMs: now, rejectReason: null, reviewedByUid: me.uid || null };
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:95  reviewedAtMs: now,
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:97  reviewedByUid: me.uid || null,
src\app\api\orders\[orderId]\installments\[idx]\review\route.ts:108  installments: next,
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:33  const installments = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:36  const paidKobo = installments.reduce((sum: number, it: any) => {
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:43  const completed = installments.length > 0 && installments.every((it: any) => {
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:66  if (!Number.isFinite(i) || i < 0) return NextResponse.json({ ok: false, error: "Invalid installment index" }, { status: 400 });
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:107  const list = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:109  const err: any = new Error("No installment plan found on this order.");
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:114  const err: any = new Error("Installment not found.");
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:126  const folder = `bizhub/installment-proofs/${String(o?.businessId || "unknown")}/${orderIdClean}`;
src\app\api\orders\[orderId]\installments\[idx]\transfer-proof\route.ts:150  const nextPlan = recomputePlan({ ...plan, installments: nextList });
src\app\api\orders\[orderId]\payment-plan\route.ts:13  function cleanPlanKey(v: any) {
src\app\api\orders\[orderId]\payment-plan\route.ts:18  function installmentRulesForPlan(planKey: string) {
src\app\api\orders\[orderId]\payment-plan\route.ts:19  const k = cleanPlanKey(planKey);
src\app\api\orders\[orderId]\payment-plan\route.ts:22  return { tier: "basic" as const, maxInstallments: 2, maxPlanDays: 30 };
src\app\api\orders\[orderId]\payment-plan\route.ts:25  return { tier: "advanced" as const, maxInstallments: 4, maxPlanDays: 90 };
src\app\api\orders\[orderId]\payment-plan\route.ts:29  return { tier: "apex" as const, maxInstallments: 36, maxPlanDays: 3650 };
src\app\api\orders\[orderId]\payment-plan\route.ts:31  return { tier: "none" as const, maxInstallments: 0, maxPlanDays: 0 };
src\app\api\orders\[orderId]\payment-plan\route.ts:34  function cleanInstallments(list: any[], maxInstallments: number) {
src\app\api\orders\[orderId]\payment-plan\route.ts:42  const label = String(x?.label || `Installment ${idx + 1}`).slice(0, 40);
src\app\api\orders\[orderId]\payment-plan\route.ts:51  reviewedAtMs: null,
src\app\api\orders\[orderId]\payment-plan\route.ts:54  paystack: null,
src\app\api\orders\[orderId]\payment-plan\route.ts:61  const sliced = tmp.slice(0, Math.max(0, Math.floor(Number(maxInstallments || 0))));
src\app\api\orders\[orderId]\payment-plan\route.ts:66  label: String(x.label || `Installment ${idx + 1}`).slice(0, 40) || `Installment ${idx + 1}`,
src\app\api\orders\[orderId]\payment-plan\route.ts:71  reviewedAtMs: null,
src\app\api\orders\[orderId]\payment-plan\route.ts:73  paystack: null,
src\app\api\orders\[orderId]\payment-plan\route.ts:80  function canUseInstallmentsForPaymentType(paymentType: string, orderSource: string) {
src\app\api\orders\[orderId]\payment-plan\route.ts:84  // marketplace orders are paystack only
src\app\api\orders\[orderId]\payment-plan\route.ts:85  if (src === "market" || src === "marketplace") return pt === "paystack_escrow";
src\app\api\orders\[orderId]\payment-plan\route.ts:87  // store orders: allow paystack escrow + bank transfer
src\app\api\orders\[orderId]\payment-plan\route.ts:88  return pt === "paystack_escrow" || pt === "direct_transfer";
src\app\api\orders\[orderId]\payment-plan\route.ts:91  function validateInstallmentDates(installments: any[], nowMs: number, maxPlanDays: number) {
src\app\api\orders\[orderId]\payment-plan\route.ts:92  const arr = Array.isArray(installments) ? installments : [];
src\app\api\orders\[orderId]\payment-plan\route.ts:93  if (!arr.length) return { ok: false, error: "No installments" as const };
src\app\api\orders\[orderId]\payment-plan\route.ts:99  return { ok: false, error: "All installments must have a due date." as const };
src\app\api\orders\[orderId]\payment-plan\route.ts:117  return { ok: false, error: `Installment plan is too long for your plan (max ${maxPlanDays} days).` as const };
src\app\api\orders\[orderId]\payment-plan\route.ts:133  if (!access?.features?.installmentPlans) {
src\app\api\orders\[orderId]\payment-plan\route.ts:135  { ok: false, code: "FEATURE_LOCKED", error: "Installment plans are locked on your plan." },
src\app\api\orders\[orderId]\payment-plan\route.ts:140  const planKey = cleanPlanKey(access?.planKey || "FREE");
src\app\api\orders\[orderId]\payment-plan\route.ts:141  const rules = installmentRulesForPlan(planKey);
src\app\api\orders\[orderId]\payment-plan\route.ts:142  if (rules.maxInstallments <= 0) {
src\app\api\orders\[orderId]\payment-plan\route.ts:144  { ok: false, code: "FEATURE_LOCKED", error: "Installment plans are locked on your plan." },
src\app\api\orders\[orderId]\payment-plan\route.ts:166  if (!canUseInstallmentsForPaymentType(paymentType, orderSource)) {
src\app\api\orders\[orderId]\payment-plan\route.ts:167  return NextResponse.json({ ok: false, error: "Installments are not allowed for this order type." }, { status: 400 });
src\app\api\orders\[orderId]\payment-plan\route.ts:179  const existingInstallments = Array.isArray(existingPlan?.installments) ? existingPlan.installments : [];
src\app\api\orders\[orderId]\payment-plan\route.ts:180  const hasActivity = existingInstallments.some((x: any) => String(x?.status || "") !== "pending");
src\app\api\orders\[orderId]\payment-plan\route.ts:189  const installments = cleanInstallments(body?.installments || [], rules.maxInstallments);
src\app\api\orders\[orderId]\payment-plan\route.ts:191  if (installments.length < 2) {
src\app\api\orders\[orderId]\payment-plan\route.ts:193  { ok: false, error: `Add at least 2 installments. (Your plan allows up to ${rules.maxInstallments}.)` },
src\app\api\orders\[orderId]\payment-plan\route.ts:198  if (installments.length > rules.maxInstallments) {
src\app\api\orders\[orderId]\payment-plan\route.ts:200  { ok: false, error: `Too many installments for your plan (max ${rules.maxInstallments}).` },
src\app\api\orders\[orderId]\payment-plan\route.ts:210  const sum = installments.reduce((s, x) => s + Number(x.amountKobo || 0), 0);
src\app\api\orders\[orderId]\payment-plan\route.ts:213  { ok: false, error: "Installment amounts must add up exactly to the order total." },
src\app\api\orders\[orderId]\payment-plan\route.ts:220  const dateCheck = validateInstallmentDates(installments, now, rules.maxPlanDays);
src\app\api\orders\[orderId]\payment-plan\route.ts:227  type: "installments",
src\app\api\orders\[orderId]\payment-plan\route.ts:231  installments,
src\app\api\orders\[orderId]\payment-plan\route.ts:252  plan: { tier: rules.tier, maxInstallments: rules.maxInstallments, maxPlanDays: rules.maxPlanDays },
src\app\api\orders\[orderId]\route.ts:17  // If installments enabled, only show paid when completed
src\app\api\orders\[orderId]\route.ts:28  if (pt === "paystack_escrow") return "paid";
src\app\api\orders\[orderId]\route.ts:36  const installments = Array.isArray(plan.installments) ? plan.installments : [];
src\app\api\orders\[orderId]\route.ts:40  type: String(plan.type || "installments"),
src\app\api\orders\[orderId]\route.ts:48  installments: installments.map((x: any) => ({
src\app\api\orders\[orderId]\route.ts:56  reviewedAtMs: x?.reviewedAtMs ? Number(x.reviewedAtMs) : null,
src\app\api\orders\[orderId]\route.ts:62  // customer can see reference if they used paystack
src\app\api\orders\[orderId]\route.ts:63  paystackReference: x?.paystack?.reference ? String(x.paystack.reference) : null,
src\app\api\paystack\initialize\route.ts:1  // FILE: src/app/api/paystack/initialize/route.ts
src\app\api\paystack\initialize\route.ts:27  function fxNgnPerUsd() {
src\app\api\paystack\initialize\route.ts:28  const v = process.env.FX_NGN_PER_USD || process.env.NGN_PER_USD || process.env.USD_NGN_RATE || "";
src\app\api\paystack\initialize\route.ts:33  function cleanChargeCurrency(v: any): "NGN" | "USD" {
src\app\api\paystack\initialize\route.ts:34  return String(v || "NGN").toUpperCase() === "USD" ? "USD" : "NGN";
src\app\api\paystack\initialize\route.ts:57  const paystackSecret = process.env.PAYSTACK_SECRET_KEY || "";
src\app\api\paystack\initialize\route.ts:93  let vendorPlanKey: string = "FREE";
src\app\api\paystack\initialize\route.ts:95  let vendorUsdCheckoutEnabled = false;
src\app\api\paystack\initialize\route.ts:134  vendorPlanKey = String(resolved?.planKey || "FREE").toUpperCase();
src\app\api\paystack\initialize\route.ts:135  vendorHasActiveSub = !!resolved?.hasActiveSubscription;
src\app\api\paystack\initialize\route.ts:136  vendorUsdCheckoutEnabled = !!(resolved as any)?.features?.usdCheckout;
src\app\api\paystack\initialize\route.ts:147  const usdAllowed =
src\app\api\paystack\initialize\route.ts:148  vendorHasActiveSub && (vendorPlanKey === "MOMENTUM" || vendorPlanKey === "APEX") && vendorUsdCheckoutEnabled;
src\app\api\paystack\initialize\route.ts:150  const chargeCurrency: "NGN" | "USD" = requestedCurrency === "USD" && usdAllowed ? "USD" : "NGN";
src\app\api\paystack\initialize\route.ts:155  metadata.charge.vendorPlanKey = vendorPlanKey;
src\app\api\paystack\initialize\route.ts:156  metadata.charge.vendorHasActiveSubscription = vendorHasActiveSub;
src\app\api\paystack\initialize\route.ts:157  metadata.charge.vendorUsdCheckoutEnabled = vendorUsdCheckoutEnabled;
src\app\api\paystack\initialize\route.ts:158  metadata.charge.usdAllowed = usdAllowed;
src\app\api\paystack\initialize\route.ts:163  if (chargeCurrency === "USD") {
src\app\api\paystack\initialize\route.ts:164  const fx = fxNgnPerUsd();
src\app\api\paystack\initialize\route.ts:166  return NextResponse.json({ error: "USD payments not configured (missing FX_NGN_PER_USD)" }, { status: 500 });
src\app\api\paystack\initialize\route.ts:169  // amountKobo is NGN kobo (NGN * 100). Divide by NGN/USD => USD * 100 => USD cents.
src\app\api\paystack\initialize\route.ts:170  const usdCents = Math.round(amountKobo / fx);
src\app\api\paystack\initialize\route.ts:171  if (!Number.isFinite(usdCents) || usdCents <= 0) {
src\app\api\paystack\initialize\route.ts:172  return NextResponse.json({ error: "USD conversion failed" }, { status: 500 });
src\app\api\paystack\initialize\route.ts:175  metadata.charge.fxNgnPerUsd = fx;
src\app\api\paystack\initialize\route.ts:176  metadata.charge.usdCents = usdCents;
src\app\api\paystack\initialize\route.ts:179  chargeAmountMajor = usdCents / 100;
src\app\api\paystack\initialize\route.ts:180  amountMinor = usdCents;
src\app\api\paystack\initialize\route.ts:228  // ? Only flat meta (prevents "Invalid meta data passed")
src\app\api\paystack\initialize\route.ts:232  // optional: you can restrict methods by currency if you want later
src\app\api\paystack\initialize\route.ts:233  // payment_options: chargeCurrency === "USD" ? "card" : undefined,
src\app\api\paystack\initialize\route.ts:246  // Paystack (NGN only)
src\app\api\paystack\initialize\route.ts:248  if (!paystackSecret) return NextResponse.json({ error: "Missing PAYSTACK_SECRET_KEY" }, { status: 500 });
src\app\api\paystack\initialize\route.ts:250  return NextResponse.json({ error: "USD checkout is only available on Flutterwave" }, { status: 400 });
src\app\api\paystack\initialize\route.ts:252  const res = await fetch("https://api.paystack.co/transaction/initialize", {
src\app\api\paystack\initialize\route.ts:255  Authorization: `Bearer ${paystackSecret}`,
src\app\api\paystack\initialize\route.ts:267  if (!data?.status) return NextResponse.json({ error: data?.message || "Paystack init failed", raw: data }, { status: 400 });
src\app\api\paystack\initialize\route.ts:272  provider: "paystack",
src\app\api\paystack\verify\route.ts:1  // FILE: src/app/api/paystack/verify/route.ts
src\app\api\paystack\verify\route.ts:9  async function verifyPaystack(reference: string) {
src\app\api\paystack\verify\route.ts:10  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\paystack\verify\route.ts:11  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\paystack\verify\route.ts:13  const res = await fetch(`https://api.paystack.co/transaction/verify/${encodeURIComponent(reference)}`, {
src\app\api\paystack\verify\route.ts:39  const reference = String(body.reference || "").trim(); // paystack ref OR flutterwave tx_ref
src\app\api\paystack\verify\route.ts:67  // keep "amount" as minor-units for compatibility with old Paystack verify consumers
src\app\api\paystack\verify\route.ts:81  // Paystack (kept, hidden)
src\app\api\paystack\verify\route.ts:87  const ps = await verifyPaystack(reference);
src\app\api\paystack\verify\route.ts:90  provider: "paystack",
src\app\api\promotions\confirm\route.ts:5  import { computeVendorAccessState } from "@/lib/vendor/access";
src\app\api\promotions\confirm\route.ts:12  async function verifyPaystack(reference: string) {
src\app\api\promotions\confirm\route.ts:13  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\promotions\confirm\route.ts:14  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\promotions\confirm\route.ts:16  const res = await fetch(`https://api.paystack.co/transaction/verify/${reference}`, {
src\app\api\promotions\confirm\route.ts:21  if (!data.status) throw new Error(data.message || "Paystack verify failed");
src\app\api\promotions\confirm\route.ts:88  const state = computeVendorAccessState(biz);
src\app\api\promotions\confirm\route.ts:89  if (state.locked) {
src\app\api\promotions\confirm\route.ts:117  const platformRef = adminDb.collection("platform").doc("finance");
src\app\api\promotions\confirm\route.ts:118  const ledgerRef = adminDb.collection("platformLedger").doc();
src\app\api\promotions\confirm\route.ts:164  platformRef,
src\app\api\promotions\confirm\route.ts:168  subscriptionRevenueKobo: FieldValue.increment(0),
src\app\api\promotions\confirm\route.ts:202  // Paystack (kept, hidden)
src\app\api\promotions\confirm\route.ts:204  const tx = await verifyPaystack(reference);
src\app\api\promotions\confirm\route.ts:230  const state = computeVendorAccessState(biz);
src\app\api\promotions\confirm\route.ts:231  if (state.locked) {
src\app\api\promotions\confirm\route.ts:240  return NextResponse.json({ ok: false, error: "Invalid amount from Paystack" }, { status: 400 });
src\app\api\promotions\confirm\route.ts:254  const platformRef = adminDb.collection("platform").doc("finance");
src\app\api\promotions\confirm\route.ts:255  const ledgerRef = adminDb.collection("platformLedger").doc();
src\app\api\promotions\confirm\route.ts:301  platformRef,
src\app\api\promotions\confirm\route.ts:305  subscriptionRevenueKobo: FieldValue.increment(0),
src\app\api\promotions\initialize\route.ts:26  async function paystackInitialize(params: {
src\app\api\promotions\initialize\route.ts:32  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\promotions\initialize\route.ts:33  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\promotions\initialize\route.ts:35  const res = await fetch("https://api.paystack.co/transaction/initialize", {
src\app\api\promotions\initialize\route.ts:50  if (!data.status) throw new Error(data.message || "Paystack init failed");
src\app\api\promotions\initialize\route.ts:127  // Paystack (kept, hidden)
src\app\api\promotions\initialize\route.ts:129  const { authorization_url, reference } = await paystackInitialize({
src\app\api\promotions\my\route.ts:59  // product previews
src\app\api\public\orders\[orderId]\transfer-proof\route.ts:63  if (!access?.hasActiveSubscription) {
src\app\api\public\orders\[orderId]\transfer-proof\route.ts:136  reviewedAtMs: null,
src\app\api\public\orders\[orderId]\transfer-proof\route.ts:137  reviewedByUid: null,
src\app\api\public\store\[slug]\payment-options\route.ts:14  function fxNgnPerUsd() {
src\app\api\public\store\[slug]\payment-options\route.ts:15  const v = process.env.FX_NGN_PER_USD || process.env.NGN_PER_USD || process.env.USD_NGN_RATE || "";
src\app\api\public\store\[slug]\payment-options\route.ts:35  const fxOk = fxNgnPerUsd() > 0;
src\app\api\public\store\[slug]\payment-options\route.ts:37  const planKey = String(resolved.planKey || "FREE").toUpperCase();
src\app\api\public\store\[slug]\payment-options\route.ts:38  const hasSub = !!resolved.hasActiveSubscription;
src\app\api\public\store\[slug]\payment-options\route.ts:39  const usdFeature = !!(resolved.features as any)?.usdCheckout;
src\app\api\public\store\[slug]\payment-options\route.ts:41  const usdEligible =
src\app\api\public\store\[slug]\payment-options\route.ts:45  (planKey === "MOMENTUM" || planKey === "APEX") &&
src\app\api\public\store\[slug]\payment-options\route.ts:46  usdFeature;
src\app\api\public\store\[slug]\payment-options\route.ts:52  usdEligible,
src\app\api\public\store\[slug]\payment-options\route.ts:56  planKey,
src\app\api\public\store\[slug]\payment-options\route.ts:57  hasActiveSubscription: hasSub,
src\app\api\public\store\[slug]\payment-options\route.ts:58  usdFeature,
src\app\api\public\store\[slug]\trust\route.ts:12  function hasActiveSubscription(biz: any) {
src\app\api\public\store\[slug]\trust\route.ts:13  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\public\store\[slug]\trust\route.ts:14  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\public\store\[slug]\trust\route.ts:21  * - paused + remainingMs>0 => active *only if subscriptionActive* (effective resume)
src\app\api\public\store\[slug]\trust\route.ts:23  function addonIsActiveEffective(ent: any, nowMs: number, subscriptionActive: boolean) {
src\app\api\public\store\[slug]\trust\route.ts:31  if (status === "paused") return subscriptionActive && remainingMs > 0;
src\app\api\public\store\[slug]\trust\route.ts:48  const planKey = String(biz?.subscription?.planKey || "FREE").toUpperCase();
src\app\api\public\store\[slug]\trust\route.ts:49  const subscriptionActive = hasActiveSubscription(biz);
src\app\api\public\store\[slug]\trust\route.ts:53  const plan = (cfg as any)?.plans?.[planKey] || (fallbackPlanConfig() as any).plans.FREE;
src\app\api\public\store\[slug]\trust\route.ts:55  const apexVerifiedFeatureOn = !!plan?.features?.apexVerifiedBadge;
src\app\api\public\store\[slug]\trust\route.ts:61  const apexBadgeActive = planKey === "APEX" && subscriptionActive && apexVerifiedFeatureOn && badgeEarned;
src\app\api\public\store\[slug]\trust\route.ts:68  const temporaryApexBadgeActive =
src\app\api\public\store\[slug]\trust\route.ts:69  planKey === "MOMENTUM" && addonIsActiveEffective(tempEnt, nowMs, subscriptionActive);
src\app\api\public\store\[slug]\trust\route.ts:72  apexBadgeActive
src\app\api\public\store\[slug]\trust\route.ts:74  : temporaryApexBadgeActive
src\app\api\public\store\[slug]\trust\route.ts:82  planKey,
src\app\api\public\store\[slug]\trust\route.ts:83  hasActiveSubscription: subscriptionActive,
src\app\api\public\store\[slug]\trust\route.ts:85  apexBadgeActive,
src\app\api\public\store\[slug]\trust\route.ts:86  temporaryApexBadgeActive,
src\app\api\staff\accept\route.ts:12  function hasActiveSubscription(biz: any) {
src\app\api\staff\accept\route.ts:13  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\staff\accept\route.ts:14  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\staff\accept\route.ts:27  if (status === "paused") return remainingMs > 0; // effective resume when subscription is active
src\app\api\staff\accept\route.ts:68  subscription: biz?.subscription ?? null,
src\app\api\staff\accept\route.ts:71  const planKey = String(entitlement?.planKey || "FREE").toUpperCase();
src\app\api\staff\accept\route.ts:72  let seatLimit = staffSeatLimitFor(planKey);
src\app\api\staff\accept\route.ts:75  const subActive = hasActiveSubscription(biz);
src\app\api\staff\accept\route.ts:78  if (subActive && planKey === "LAUNCH" && addonSeatPlus1ActiveEffective(biz, nowMs)) {
src\app\api\staff\accept\route.ts:158  return { ok: true, businessId, planKey, seatLimit };
src\app\api\subscriptions\confirm\route.ts:1  // FILE: src/app/api/subscriptions/confirm/route.ts
src\app\api\subscriptions\confirm\route.ts:11  type BizhubPlanKey,
src\app\api\subscriptions\confirm\route.ts:18  async function verifyPaystack(reference: string) {
src\app\api\subscriptions\confirm\route.ts:19  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\subscriptions\confirm\route.ts:20  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\subscriptions\confirm\route.ts:23  `https://api.paystack.co/transaction/verify/${encodeURIComponent(reference)}`,
src\app\api\subscriptions\confirm\route.ts:28  if (!data?.status) throw new Error(data?.message || "Paystack verify failed");
src\app\api\subscriptions\confirm\route.ts:78  if (md?.purpose !== "subscription") {
src\app\api\subscriptions\confirm\route.ts:84  const planKey = String(md.planKey || "") as BizhubPlanKey;
src\app\api\subscriptions\confirm\route.ts:89  const allowedPlans: BizhubPlanKey[] = ["LAUNCH", "MOMENTUM", "APEX"];
src\app\api\subscriptions\confirm\route.ts:91  if (!allowedPlans.includes(planKey)) return NextResponse.json({ ok: false, error: "Invalid planKey" }, { status: 400 });
src\app\api\subscriptions\confirm\route.ts:94  const expectedKobo = priceKoboFor(planKey, cycle);
src\app\api\subscriptions\confirm\route.ts:98  return NextResponse.json({ ok: false, error: "Invalid currency for subscription (expected NGN)" }, { status: 400 });
src\app\api\subscriptions\confirm\route.ts:114  const subRef = adminDb.collection("subscriptions").doc(String(reference));
src\app\api\subscriptions\confirm\route.ts:115  const platformRef = adminDb.collection("platform").doc("finance");
src\app\api\subscriptions\confirm\route.ts:116  const ledgerRef = adminDb.collection("platformLedger").doc();
src\app\api\subscriptions\confirm\route.ts:129  planKey: d.planKey,
src\app\api\subscriptions\confirm\route.ts:142  planKey,
src\app\api\subscriptions\confirm\route.ts:167  subscription: {
src\app\api\subscriptions\confirm\route.ts:168  planKey,
src\app\api\subscriptions\confirm\route.ts:182  platformRef,
src\app\api\subscriptions\confirm\route.ts:185  subscriptionRevenueKobo: FieldValue.increment(paidKobo),
src\app\api\subscriptions\confirm\route.ts:193  type: "subscription",
src\app\api\subscriptions\confirm\route.ts:197  planKey,
src\app\api\subscriptions\confirm\route.ts:206  purpose: "subscription",
src\app\api\subscriptions\confirm\route.ts:210  planKey,
src\app\api\subscriptions\confirm\route.ts:220  type: "subscription_paid",
src\app\api\subscriptions\confirm\route.ts:224  planKey,
src\app\api\subscriptions\confirm\route.ts:235  return { ok: true, alreadyProcessed: false, businessId, planKey, expiresAtMs };
src\app\api\subscriptions\confirm\route.ts:243  // Paystack (kept, hidden)
src\app\api\subscriptions\confirm\route.ts:245  const paystackTx = await verifyPaystack(reference);
src\app\api\subscriptions\confirm\route.ts:246  if (paystackTx.status !== "success") {
src\app\api\subscriptions\confirm\route.ts:247  return NextResponse.json({ ok: false, error: `Payment not successful: ${paystackTx.status}` }, { status: 400 });
src\app\api\subscriptions\confirm\route.ts:250  const md = normalizeMetadata(paystackTx.metadata);
src\app\api\subscriptions\confirm\route.ts:251  if (md?.purpose !== "subscription") {
src\app\api\subscriptions\confirm\route.ts:257  const planKey = String(md.planKey || "") as BizhubPlanKey;
src\app\api\subscriptions\confirm\route.ts:262  const allowedPlans: BizhubPlanKey[] = ["LAUNCH", "MOMENTUM", "APEX"];
src\app\api\subscriptions\confirm\route.ts:265  if (!allowedPlans.includes(planKey)) return NextResponse.json({ ok: false, error: "Invalid planKey" }, { status: 400 });
src\app\api\subscriptions\confirm\route.ts:268  const expectedKobo = priceKoboFor(planKey, cycle);
src\app\api\subscriptions\confirm\route.ts:269  const paidKobo = Number(paystackTx.amount || 0);
src\app\api\subscriptions\confirm\route.ts:272  return NextResponse.json({ ok: false, error: "Invalid Paystack amount" }, { status: 400 });
src\app\api\subscriptions\confirm\route.ts:281  const subRef = adminDb.collection("subscriptions").doc(String(reference));
src\app\api\subscriptions\confirm\route.ts:282  const platformRef = adminDb.collection("platform").doc("finance");
src\app\api\subscriptions\confirm\route.ts:283  const ledgerRef = adminDb.collection("platformLedger").doc();
src\app\api\subscriptions\confirm\route.ts:296  planKey: d.planKey,
src\app\api\subscriptions\confirm\route.ts:309  planKey,
src\app\api\subscriptions\confirm\route.ts:314  currency: paystackTx.currency || "NGN",
src\app\api\subscriptions\confirm\route.ts:315  provider: "paystack",
src\app\api\subscriptions\confirm\route.ts:316  paidAt: paystackTx.paid_at || null,
src\app\api\subscriptions\confirm\route.ts:331  subscription: {
src\app\api\subscriptions\confirm\route.ts:332  planKey,
src\app\api\subscriptions\confirm\route.ts:346  platformRef,
src\app\api\subscriptions\confirm\route.ts:349  subscriptionRevenueKobo: FieldValue.increment(paidKobo),
src\app\api\subscriptions\confirm\route.ts:357  type: "subscription",
src\app\api\subscriptions\confirm\route.ts:361  planKey,
src\app\api\subscriptions\confirm\route.ts:364  currency: paystackTx.currency || "NGN",
src\app\api\subscriptions\confirm\route.ts:370  purpose: "subscription",
src\app\api\subscriptions\confirm\route.ts:374  planKey,
src\app\api\subscriptions\confirm\route.ts:384  type: "subscription_paid",
src\app\api\subscriptions\confirm\route.ts:388  planKey,
src\app\api\subscriptions\confirm\route.ts:391  currency: paystackTx.currency || "NGN",
src\app\api\subscriptions\confirm\route.ts:392  paidAt: paystackTx.paid_at || null,
src\app\api\subscriptions\confirm\route.ts:399  return { ok: true, alreadyProcessed: false, businessId, planKey, expiresAtMs };
src\app\api\subscriptions\initialize\route.ts:1  // FILE: src/app/api/subscriptions/initialize/route.ts
src\app\api\subscriptions\initialize\route.ts:10  type BizhubPlanKey,
src\app\api\subscriptions\initialize\route.ts:23  async function paystackInitialize(params: {
src\app\api\subscriptions\initialize\route.ts:29  const secret = process.env.PAYSTACK_SECRET_KEY;
src\app\api\subscriptions\initialize\route.ts:30  if (!secret) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\subscriptions\initialize\route.ts:32  const res = await fetch("https://api.paystack.co/transaction/initialize", {
src\app\api\subscriptions\initialize\route.ts:47  if (!data.status) throw new Error(data.message || "Paystack init failed");
src\app\api\subscriptions\initialize\route.ts:63  const planKey = String(body.planKey || "") as BizhubPlanKey;
src\app\api\subscriptions\initialize\route.ts:66  const allowedPlans: BizhubPlanKey[] = ["LAUNCH", "MOMENTUM", "APEX"];
src\app\api\subscriptions\initialize\route.ts:69  if (!allowedPlans.includes(planKey)) {
src\app\api\subscriptions\initialize\route.ts:70  return NextResponse.json({ ok: false, error: "Invalid planKey" }, { status: 400 });
src\app\api\subscriptions\initialize\route.ts:76  const amountKobo = priceKoboFor(planKey, cycle);
src\app\api\subscriptions\initialize\route.ts:79  const callbackUrl = `${appUrlFrom(req)}/payment/subscription/callback`;
src\app\api\subscriptions\initialize\route.ts:96  title: "Bizhub Subscription",
src\app\api\subscriptions\initialize\route.ts:97  description: `${planKey} ï ${cycle}`,
src\app\api\subscriptions\initialize\route.ts:99  purpose: "subscription",
src\app\api\subscriptions\initialize\route.ts:103  planKey,
src\app\api\subscriptions\initialize\route.ts:113  // Paystack (kept, hidden)
src\app\api\subscriptions\initialize\route.ts:115  const { authorization_url, reference } = await paystackInitialize({
src\app\api\subscriptions\initialize\route.ts:120  purpose: "subscription",
src\app\api\subscriptions\initialize\route.ts:124  planKey,
src\app\api\subscriptions\my\route.ts:21  subscription: biz?.subscription ?? null,
src\app\api\subscriptions\my\route.ts:26  .collection("subscriptions")
src\app\api\subscriptions\my\route.ts:42  subscription: biz.subscription ?? null,
src\app\api\track\route.ts:93  // ===== Platform daily metrics (NEW) =====
src\app\api\track\route.ts:95  const platRef = adminDb.collection("platformMetricsDaily").doc(dk);
src\app\api\track\route.ts:119  await platRef.set(plinc, { merge: true });
src\app\api\vendor\access\route.ts:38  planKey: String(plan?.planKey || "FREE").toUpperCase(),
src\app\api\vendor\access\route.ts:39  hasActiveSubscription: !!plan?.hasActiveSubscription,
src\app\api\vendor\analytics\route.ts:44  function tierFor(planKey: string) {
src\app\api\vendor\analytics\route.ts:45  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\analytics\route.ts:122  const planKey = String(entitlement.planKey || "FREE").toUpperCase();
src\app\api\vendor\analytics\route.ts:125  const tier = tierFor(planKey);
src\app\api\vendor\analytics\route.ts:150  notice = "Free plan analytics is limited to weekly view.";
src\app\api\vendor\analytics\route.ts:165  const paystackOrders = ordersWin.filter((o) => o.paymentType === "paystack_escrow").length;
src\app\api\vendor\analytics\route.ts:190  if (o.paymentType === "paystack_escrow") {
src\app\api\vendor\analytics\route.ts:265  const outOfStockCount = products.filter((p) => Number(p.stock ?? 0) <= 0).length;
src\app\api\vendor\analytics\route.ts:266  const lowStockCount = products.filter((p) => {
src\app\api\vendor\analytics\route.ts:267  const s = Number(p.stock ?? 0);
src\app\api\vendor\analytics\route.ts:337  paystackOrders,
src\app\api\vendor\analytics\route.ts:372  if (awaitingConfirmCountAll > 0) suggestion = "Confirm pending direct transfers so you can close sales faster.";
src\app\api\vendor\analytics\route.ts:373  else if (disputedCountAll > 0) suggestion = "Respond to disputes quickly with clear delivery proof to protect visibility.";
src\app\api\vendor\analytics\route.ts:375  else if (outOfStockCount > 0) suggestion = "Restock your out-of-stock products so customers donít bounce.";
src\app\api\vendor\analytics\route.ts:376  else if (lowStockCount > 0) suggestion = "Top up low stock items (especially your fast movers).";
src\app\api\vendor\analytics\route.ts:422  } else if (outOfStockCount > 0) {
src\app\api\vendor\analytics\route.ts:424  id: "out_of_stock",
src\app\api\vendor\analytics\route.ts:426  title: "Some items are out of stock",
src\app\api\vendor\analytics\route.ts:427  body: `${outOfStockCount} product(s) are out of stock. Restock to avoid losing ready buyers.`,
src\app\api\vendor\analytics\route.ts:431  } else if (lowStockCount > 0) {
src\app\api\vendor\analytics\route.ts:433  id: "low_stock",
src\app\api\vendor\analytics\route.ts:435  title: "Low stock reminder",
src\app\api\vendor\analytics\route.ts:436  body: `${lowStockCount} product(s) are low on stock. Top up your fast movers.`,
src\app\api\vendor\analytics\route.ts:467  planKey,
src\app\api\vendor\analytics\route.ts:490  outOfStockCount,
src\app\api\vendor\analytics\route.ts:491  lowStockCount,
src\app\api\vendor\assistant\summary\route.ts:37  function cleanPlanKey(v: any) {
src\app\api\vendor\assistant\summary\route.ts:72  const planKey = cleanPlanKey(resolved?.planKey || access.planKey || "FREE");
src\app\api\vendor\assistant\summary\route.ts:73  const hasActiveSubscription = !!resolved?.hasActiveSubscription;
src\app\api\vendor\assistant\summary\route.ts:81  planKey === "MOMENTUM" &&
src\app\api\vendor\assistant\summary\route.ts:82  hasActiveSubscription &&
src\app\api\vendor\assistant\summary\route.ts:86  planKey === "APEX" && hasActiveSubscription && !!resolved?.features?.apexSmartRiskShield;
src\app\api\vendor\assistant\summary\route.ts:134  const isPaid = payType === "paystack_escrow";
src\app\api\vendor\assistant\summary\route.ts:166  if (disputeLevel === "warn") riskNotes.push("Disputes are trending up. Reply fast, keep evidence, and avoid delays.");
src\app\api\vendor\assistant\summary\route.ts:174  planKey: access.planKey,
src\app\api\vendor\best-sellers\route.ts:56  if (pt === "paystack_escrow") {
src\app\api\vendor\best-sellers\route.ts:94  function orderScanCapForPlan(planKey: string) {
src\app\api\vendor\best-sellers\route.ts:95  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\best-sellers\route.ts:102  function bestSellersExpansionSuggestion(planKey: string, maxRows: number, maxDays: number) {
src\app\api\vendor\best-sellers\route.ts:103  const pk = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\best-sellers\route.ts:155  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\best-sellers\route.ts:173  const insightsAllowed = wantInsights && planKey === "APEX";
src\app\api\vendor\best-sellers\route.ts:186  const orderScanCap = orderScanCapForPlan(planKey);
src\app\api\vendor\best-sellers\route.ts:372  planKey,
src\app\api\vendor\best-sellers\route.ts:377  bestSellersExpansionSuggestion: bestSellersExpansionSuggestion(planKey, maxRows, maxDays),
src\app\api\vendor\chat\availability\route.ts:7  function hasActiveSubscription(biz: any) {
src\app\api\vendor\chat\availability\route.ts:8  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\vendor\chat\availability\route.ts:9  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\vendor\chat\availability\route.ts:36  const subscribed = hasActiveSubscription(biz);
src\app\api\vendor\chat\availability\route.ts:38  // Strict rule: NOT available for free users => subscription required.
src\app\api\vendor\coupons\route.ts:10  function hasActiveSubscription(biz: any) {
src\app\api\vendor\coupons\route.ts:11  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\vendor\coupons\route.ts:12  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\vendor\coupons\route.ts:67  // Coupons are an advanced feature: require active subscription
src\app\api\vendor\coupons\route.ts:68  if (!hasActiveSubscription(business)) {
src\app\api\vendor\coupons\route.ts:70  { ok: false, code: "SUBSCRIPTION_REQUIRED", error: "Subscribe to create discount codes." },
src\app\api\vendor\customers\export\route.ts:30  function listCaps(planKey: string) {
src\app\api\vendor\customers\export\route.ts:31  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\customers\export\route.ts:38  function exportUnlocked(planKey: string) {
src\app\api\vendor\customers\export\route.ts:39  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\customers\export\route.ts:70  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\customers\export\route.ts:72  if (!exportUnlocked(planKey)) {
src\app\api\vendor\customers\export\route.ts:79  const caps = listCaps(planKey);
src\app\api\vendor\customers\route.ts:30  function listCaps(planKey: string) {
src\app\api\vendor\customers\route.ts:31  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\customers\route.ts:38  function exportUnlocked(planKey: string) {
src\app\api\vendor\customers\route.ts:39  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\customers\route.ts:64  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\customers\route.ts:66  const caps = listCaps(planKey);
src\app\api\vendor\customers\route.ts:224  planKey,
src\app\api\vendor\customers\route.ts:227  customersExportUnlocked: exportUnlocked(planKey),
src\app\api\vendor\dead-stock\route.ts:38  function orderScanCapForPlan(planKey: string) {
src\app\api\vendor\dead-stock\route.ts:39  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\dead-stock\route.ts:46  function productScanCapForPlan(planKey: string) {
src\app\api\vendor\dead-stock\route.ts:47  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\dead-stock\route.ts:69  // If installments exist, count only when fully completed
src\app\api\vendor\dead-stock\route.ts:76  if (pt === "paystack_escrow") {
src\app\api\vendor\dead-stock\route.ts:121  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\dead-stock\route.ts:124  if (!access?.features?.deadStock) {
src\app\api\vendor\dead-stock\route.ts:126  { ok: false, code: "FEATURE_LOCKED", error: "Dead stock detection is locked on your plan. Upgrade to unlock it." },
src\app\api\vendor\dead-stock\route.ts:131  const maxDays = clampInt(access?.limits?.deadStockMaxDays, 1, 365);
src\app\api\vendor\dead-stock\route.ts:132  const maxRows = clampInt(access?.limits?.deadStockMaxRows, 1, 5000);
src\app\api\vendor\dead-stock\route.ts:133  const ignoreNewerThanDays = clampInt(access?.limits?.deadStockIgnoreNewerThanDays, 0, 60);
src\app\api\vendor\dead-stock\route.ts:148  const orderScanCap = orderScanCapForPlan(planKey);
src\app\api\vendor\dead-stock\route.ts:191  const productScanCap = productScanCapForPlan(planKey);
src\app\api\vendor\dead-stock\route.ts:212  // 3) Dead stock = in-stock product not sold within the window
src\app\api\vendor\dead-stock\route.ts:222  const stock = Math.floor(Number(p?.stock ?? 0));
src\app\api\vendor\dead-stock\route.ts:223  if (!Number.isFinite(stock) || stock <= 0) continue;
src\app\api\vendor\dead-stock\route.ts:236  const deadValueKobo = stock * Math.max(0, priceKobo);
src\app\api\vendor\dead-stock\route.ts:242  stock,
src\app\api\vendor\dead-stock\route.ts:257  dead.sort((a, b) => (b.deadValueKobo - a.deadValueKobo) || (b.stock - a.stock));
src\app\api\vendor\dead-stock\route.ts:265  planKey,
src\app\api\vendor\discounts\route.ts:43  function productCapForPlan(planKey: string): number {
src\app\api\vendor\discounts\route.ts:44  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\discounts\route.ts:45  if (k === "APEX") return 5000; // ìunlimitedî fair-use cap
src\app\api\vendor\discounts\route.ts:51  function canSchedule(planKey: string) {
src\app\api\vendor\discounts\route.ts:52  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\discounts\route.ts:74  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\discounts\route.ts:75  const cap = productCapForPlan(planKey);
src\app\api\vendor\discounts\route.ts:86  planKey,
src\app\api\vendor\discounts\route.ts:88  productSelectCapLabel: planKey === "APEX" ? "Unlimited" : String(cap),
src\app\api\vendor\discounts\route.ts:89  scheduledAllowed: canSchedule(planKey),
src\app\api\vendor\discounts\route.ts:90  hotDealsEligible: planKey === "MOMENTUM" || planKey === "APEX",
src\app\api\vendor\discounts\route.ts:110  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\discounts\route.ts:111  const cap = productCapForPlan(planKey);
src\app\api\vendor\discounts\route.ts:140  if (startsAtMs && startsAtMs > nowMs && !canSchedule(planKey)) {
src\app\api\vendor\discounts\route.ts:186  planKey,
src\app\api\vendor\discounts\route.ts:195  const saleBoosted = planKey === "MOMENTUM" || planKey === "APEX";
src\app\api\vendor\discounts\route.ts:204  saleActive: false,
src\app\api\vendor\discounts\route.ts:206  saleType: FieldValue.delete(),
src\app\api\vendor\discounts\route.ts:207  salePercent: FieldValue.delete(),
src\app\api\vendor\discounts\route.ts:208  saleAmountOffNgn: FieldValue.delete(),
src\app\api\vendor\discounts\route.ts:212  salePlanKey: FieldValue.delete(),
src\app\api\vendor\discounts\route.ts:224  saleActive: active,
src\app\api\vendor\discounts\route.ts:226  saleType: type,
src\app\api\vendor\discounts\route.ts:227  salePercent: percent,
src\app\api\vendor\discounts\route.ts:228  saleAmountOffNgn: amountOffNgn,
src\app\api\vendor\discounts\route.ts:232  salePlanKey: planKey,
src\app\api\vendor\onboard\route.ts:61  // Free is unlimited time, restricted by planConfig.
src\app\api\vendor\orders\export\route.ts:40  if (pt === "paystack_escrow") return "paid";
src\app\api\vendor\orders\export\route.ts:46  function planExportCap(planKey: string) {
src\app\api\vendor\orders\export\route.ts:47  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\orders\export\route.ts:63  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\orders\export\route.ts:65  const cap = planExportCap(planKey);
src\app\api\vendor\orders\export\route.ts:87  const isLaunch = planKey === "LAUNCH";
src\app\api\vendor\orders\export\route.ts:88  const isMomentum = planKey === "MOMENTUM";
src\app\api\vendor\orders\export\route.ts:89  const isApex = planKey === "APEX";
src\app\api\vendor\orders\[orderId]\followups\route.ts:30  function cleanPlanKey(v: any) {
src\app\api\vendor\orders\[orderId]\followups\route.ts:35  function suggestionForLimit(args: { planKey: string; cap: number }) {
src\app\api\vendor\orders\[orderId]\followups\route.ts:36  const planKey = cleanPlanKey(args.planKey);
src\app\api\vendor\orders\[orderId]\followups\route.ts:39  if (planKey === "LAUNCH") {
src\app\api\vendor\orders\[orderId]\followups\route.ts:48  return { action: "upgrade", title: "Upgrade to increase follow-ups capacity", url: "/vendor/subscription" };
src\app\api\vendor\orders\[orderId]\followups\route.ts:51  if (planKey === "MOMENTUM") {
src\app\api\vendor\orders\[orderId]\followups\route.ts:60  return { action: "upgrade", title: "Upgrade for more power tools", url: "/vendor/subscription" };
src\app\api\vendor\orders\[orderId]\followups\route.ts:63  if (planKey === "APEX") {
src\app\api\vendor\orders\[orderId]\followups\route.ts:67  return { action: "upgrade", title: "Upgrade to unlock follow-ups", url: "/vendor/subscription" };
src\app\api\vendor\orders\[orderId]\followups\route.ts:81  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\orders\[orderId]\followups\route.ts:89  suggestion: { action: "upgrade", url: "/vendor/subscription" },
src\app\api\vendor\orders\[orderId]\followups\route.ts:102  suggestion: { action: "upgrade", url: "/vendor/subscription" },
src\app\api\vendor\orders\[orderId]\followups\route.ts:166  err.planKey = planKey;
src\app\api\vendor\orders\[orderId]\followups\route.ts:193  planKey,
src\app\api\vendor\orders\[orderId]\followups\route.ts:212  const planKey = String(e?.planKey || "FREE");
src\app\api\vendor\orders\[orderId]\followups\route.ts:221  suggestion: suggestionForLimit({ planKey, cap }),
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:16  function computePaidKobo(installments: any[]) {
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:17  return (Array.isArray(installments) ? installments : []).reduce((sum, x) => {
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:22  function allSettled(installments: any[]) {
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:23  const arr = Array.isArray(installments) ? installments : [];
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:37  if (!access?.features?.installmentPlans) {
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:39  { ok: false, code: "FEATURE_LOCKED", error: "Installment plans are locked on your plan." },
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:50  return NextResponse.json({ ok: false, error: "Invalid installment index" }, { status: 400 });
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:70  // Only bank transfer installments need manual review
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:76  const list = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:78  return NextResponse.json({ ok: false, error: "No installment plan on this order." }, { status: 400 });
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:81  if (i >= list.length) return NextResponse.json({ ok: false, error: "Installment not found." }, { status: 404 });
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:85  return NextResponse.json({ ok: false, error: "No proof uploaded for this installment yet." }, { status: 400 });
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:92  next[i] = { ...inst, status: "accepted", reviewedAtMs: now, rejectReason: null, reviewedByUid: me.uid || null };
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:97  reviewedAtMs: now,
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:99  reviewedByUid: me.uid || null,
src\app\api\vendor\orders\[orderId]\installments\[idx]\review\route.ts:110  installments: next,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:13  function cleanPlanKey(v: any) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:18  function installmentRulesForPlan(planKey: string) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:19  const k = cleanPlanKey(planKey);
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:22  return { tier: "basic" as const, maxInstallments: 2, maxPlanDays: 30 };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:25  return { tier: "advanced" as const, maxInstallments: 4, maxPlanDays: 90 };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:28  return { tier: "apex" as const, maxInstallments: 36, maxPlanDays: 3650 };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:30  return { tier: "none" as const, maxInstallments: 0, maxPlanDays: 0 };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:33  function cleanInstallments(list: any[], maxInstallments: number) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:40  const label = String(x?.label || `Installment ${idx + 1}`).slice(0, 40);
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:49  reviewedAtMs: null,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:52  paystack: null,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:58  const sliced = tmp.slice(0, Math.max(0, Math.floor(Number(maxInstallments || 0))));
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:62  label: String(x.label || `Installment ${idx + 1}`).slice(0, 40) || `Installment ${idx + 1}`,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:67  reviewedAtMs: null,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:69  paystack: null,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:74  function canUseInstallmentsForPaymentType(paymentType: string, orderSource: string) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:78  if (src === "market" || src === "marketplace") return pt === "paystack_escrow";
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:79  return pt === "paystack_escrow" || pt === "direct_transfer";
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:82  function validateInstallmentDates(installments: any[], nowMs: number, maxPlanDays: number) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:83  const arr = Array.isArray(installments) ? installments : [];
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:84  if (!arr.length) return { ok: false, error: "No installments" as const };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:89  return { ok: false, error: "All installments must have a due date." as const };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:105  return { ok: false, error: `Installment plan is too long for your plan (max ${maxPlanDays} days).` as const };
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:120  if (!access?.features?.installmentPlans) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:122  { ok: false, code: "FEATURE_LOCKED", error: "Installment plans are locked on your plan." },
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:127  const planKey = cleanPlanKey(access?.planKey || "FREE");
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:128  const rules = installmentRulesForPlan(planKey);
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:129  if (rules.maxInstallments <= 0) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:131  { ok: false, code: "FEATURE_LOCKED", error: "Installment plans are locked on your plan." },
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:153  if (!canUseInstallmentsForPaymentType(paymentType, orderSource)) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:154  return NextResponse.json({ ok: false, error: "Installments are not allowed for this order type." }, { status: 400 });
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:164  const existingInstallments = Array.isArray(existingPlan?.installments) ? existingPlan.installments : [];
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:165  const hasActivity = existingInstallments.some((x: any) => String(x?.status || "") !== "pending");
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:174  const installments = cleanInstallments(body?.installments || [], rules.maxInstallments);
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:176  if (installments.length < 2) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:178  { ok: false, error: `Add at least 2 installments. (Your plan allows up to ${rules.maxInstallments}.)` },
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:183  if (installments.length > rules.maxInstallments) {
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:185  { ok: false, error: `Too many installments for your plan (max ${rules.maxInstallments}).` },
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:195  const sum = installments.reduce((s, x) => s + Number(x.amountKobo || 0), 0);
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:198  { ok: false, error: "Installment amounts must add up exactly to the order total." },
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:204  const dateCheck = validateInstallmentDates(installments, now, rules.maxPlanDays);
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:211  type: "installments",
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:215  installments,
src\app\api\vendor\orders\[orderId]\payment-plan\route.ts:236  plan: { tier: rules.tier, maxInstallments: rules.maxInstallments, maxPlanDays: rules.maxPlanDays },
src\app\api\vendor\orders\[orderId]\transfer-proof\review\route.ts:66  reviewedAtMs: now,
src\app\api\vendor\orders\[orderId]\transfer-proof\review\route.ts:67  reviewedByUid: me.uid || null,
src\app\api\vendor\orders\[orderId]\transfer-proof\review\route.ts:86  reviewedAtMs: now,
src\app\api\vendor\orders\[orderId]\transfer-proof\review\route.ts:87  reviewedByUid: me.uid || null,
src\app\api\vendor\orders\[orderId]\route.ts:24  if (pt === "paystack_escrow") return "paid";
src\app\api\vendor\orders\[orderId]\route.ts:36  function cleanPlanKey(v: any) {
src\app\api\vendor\orders\[orderId]\route.ts:41  function followUpsBoostSuggestion(planKey: string, cap: number) {
src\app\api\vendor\orders\[orderId]\route.ts:42  const pk = cleanPlanKey(planKey);
src\app\api\vendor\orders\[orderId]\route.ts:93  const installmentPlansUnlocked = !!access?.features?.installmentPlans;
src\app\api\vendor\orders\[orderId]\route.ts:125  const planKey = String(access.planKey || "FREE").toUpperCase();
src\app\api\vendor\orders\[orderId]\route.ts:126  const boostSuggestion = followUpsBoostSuggestion(planKey, followUpsCap72h);
src\app\api\vendor\orders\[orderId]\route.ts:131  planKey: access.planKey,
src\app\api\vendor\orders\[orderId]\route.ts:132  hasActiveSubscription: access.hasActiveSubscription,
src\app\api\vendor\orders\[orderId]\route.ts:139  installmentPlansUnlocked,
src\app\api\vendor\orders\[orderId]\route.ts:185  reviewedAtMs: typeof tp.reviewedAtMs === "number" ? tp.reviewedAtMs : null,
src\app\api\vendor\orders\route.ts:32  if (pt === "paystack_escrow") return "paid";
src\app\api\vendor\orders\route.ts:76  planKey: access.planKey,
src\app\api\vendor\orders\route.ts:77  hasActiveSubscription: access.hasActiveSubscription,
src\app\api\vendor\plans\route.ts:4  import { getPlanConfig, fallbackPlanConfig, type BizhubPlanKey } from "@/lib/vendor/planConfigServer";
src\app\api\vendor\plans\route.ts:12  const PRICE_NGN: Record<BizhubPlanKey, Record<BillingCycle, number>> = {
src\app\api\vendor\plans\route.ts:19  function planName(k: BizhubPlanKey) {
src\app\api\vendor\plans\route.ts:26  function planTagline(k: BizhubPlanKey) {
src\app\api\vendor\plans\route.ts:33  function recommendedFor(k: BizhubPlanKey) {
src\app\api\vendor\plans\route.ts:44  function buildBenefitsForPlan(planKey: BizhubPlanKey, features: any, limits: any) {
src\app\api\vendor\plans\route.ts:50  addIf(core, !!features.storeCustomize, "Customize your store with your brand, logo, and banner");
src\app\api\vendor\plans\route.ts:56  // ? PAYMENTS (user-friendly, no USD jargon)
src\app\api\vendor\plans\route.ts:58  if ((planKey === "MOMENTUM" || planKey === "APEX") && !!features.usdCheckout) {
src\app\api\vendor\plans\route.ts:59  payments.push("Accept card payments in USD from international buyers");
src\app\api\vendor\plans\route.ts:90  addIf(ops, !!features.proofOfPayment, "Review bank transfer proof uploads faster");
src\app\api\vendor\plans\route.ts:91  addIf(ops, !!features.installmentPlans, "Accept installment payments (split billing)");
src\app\api\vendor\plans\route.ts:119  if (!!features.deadStock) {
src\app\api\vendor\plans\route.ts:120  const rows = Number(limits.deadStockMaxRows || 0);
src\app\api\vendor\plans\route.ts:121  const days = Number(limits.deadStockMaxDays || 0);
src\app\api\vendor\plans\route.ts:123  insights.push(`Spot slow-moving stock early (${rows} products, ${days} days)`);
src\app\api\vendor\plans\route.ts:136  addIf(apex, !!features.apexVerifiedBadge, "Display a Verified Apex badge to build buyer trust");
src\app\api\vendor\plans\route.ts:141  if (planKey === "APEX") {
src\app\api\vendor\plans\route.ts:157  function purchasesForPlan(planKey: BizhubPlanKey) {
src\app\api\vendor\plans\route.ts:158  const addOns = addonsForPlan(planKey);
src\app\api\vendor\plans\route.ts:182  (["FREE", "LAUNCH", "MOMENTUM", "APEX"] as BizhubPlanKey[]).forEach((k) => {
src\app\api\vendor\products\[productId]\route.ts:72  if (!data.attrs) data.attrs = { colors: [], sizes: [] };
src\app\api\vendor\products\[productId]\route.ts:101  const stock = Number(body.stock ?? existing.stock ?? 0);
src\app\api\vendor\products\[productId]\route.ts:113  const colors = cleanListCsv(body.colorsCsv);
src\app\api\vendor\products\[productId]\route.ts:114  const sizes = cleanListCsv(body.sizesCsv);
src\app\api\vendor\products\[productId]\route.ts:120  const keywords = keywordsForProduct({ name, description, categoryKeys, colors, sizes });
src\app\api\vendor\products\[productId]\route.ts:128  stock: Number.isFinite(stock) ? stock : 0,
src\app\api\vendor\products\[productId]\route.ts:136  attrs: { colors, sizes },
src\app\api\vendor\products\route.ts:96  const stock = Number(body.stock ?? 0);
src\app\api\vendor\products\route.ts:108  // ? category + attrs
src\app\api\vendor\products\route.ts:109  const colors = cleanListCsv(body.colorsCsv);
src\app\api\vendor\products\route.ts:110  const sizes = cleanListCsv(body.sizesCsv);
src\app\api\vendor\products\route.ts:115  const keywords = keywordsForProduct({ name, description, categoryKeys, colors, sizes });
src\app\api\vendor\products\route.ts:119  const businessHasActiveSubscription = !!plan.hasActiveSubscription;
src\app\api\vendor\products\route.ts:126  businessState: biz?.state ?? null,
src\app\api\vendor\products\route.ts:127  businessCity: biz?.city ?? null,
src\app\api\vendor\products\route.ts:130  businessHasActiveSubscription,
src\app\api\vendor\products\route.ts:131  marketTier: Number(biz?.verificationTier || 0),
src\app\api\vendor\products\route.ts:142  attrs: { colors, sizes },
src\app\api\vendor\products\route.ts:145  stock: Number.isFinite(stock) ? stock : 0,
src\app\api\vendor\purchases\catalog\route.ts:11  function cleanPlanKey(v: any) {
src\app\api\vendor\purchases\catalog\route.ts:16  // Prefer last subscribed plan for catalog display even if subscription is currently inactive
src\app\api\vendor\purchases\catalog\route.ts:17  function planKeyForCatalog(resolved: any) {
src\app\api\vendor\purchases\catalog\route.ts:19  const subKey = cleanPlanKey(biz?.subscription?.planKey);
src\app\api\vendor\purchases\catalog\route.ts:20  const resolvedKey = cleanPlanKey(resolved?.planKey);
src\app\api\vendor\purchases\catalog\route.ts:51  const catalogPlanKey = planKeyForCatalog(resolved);
src\app\api\vendor\purchases\catalog\route.ts:52  const subscriptionActive = !!resolved?.hasActiveSubscription;
src\app\api\vendor\purchases\catalog\route.ts:58  const items = addonsForPlan(catalogPlanKey as any).map((a) => {
src\app\api\vendor\purchases\catalog\route.ts:76  planKey: catalogPlanKey,
src\app\api\vendor\purchases\catalog\route.ts:77  subscriptionActive,
src\app\api\vendor\purchases\confirm\route.ts:13  function paystackSecret() {
src\app\api\vendor\purchases\confirm\route.ts:14  return process.env.PAYSTACK_SECRET_KEY || "";
src\app\api\vendor\purchases\confirm\route.ts:17  async function paystackVerify(reference: string) {
src\app\api\vendor\purchases\confirm\route.ts:18  const sk = paystackSecret();
src\app\api\vendor\purchases\confirm\route.ts:19  if (!sk) throw new Error("Missing PAYSTACK_SECRET_KEY");
src\app\api\vendor\purchases\confirm\route.ts:21  const r = await fetch(`https://api.paystack.co/transaction/verify/${encodeURIComponent(reference)}`, {
src\app\api\vendor\purchases\confirm\route.ts:26  if (!j?.status) throw new Error(j?.message || "Paystack verify failed");
src\app\api\vendor\purchases\confirm\route.ts:206  planKey: addon.plan,
src\app\api\vendor\purchases\confirm\route.ts:225  // Paystack (kept, hidden)
src\app\api\vendor\purchases\confirm\route.ts:227  const tx = await paystackVerify(reference);
src\app\api\vendor\purchases\confirm\route.ts:314  provider: "paystack",
src\app\api\vendor\purchases\confirm\route.ts:334  planKey: addon.plan,
src\app\api\vendor\purchases\initialize\route.ts:20  function cleanPlanKey(v: any) {
src\app\api\vendor\purchases\initialize\route.ts:25  function isSubscriptionActive(biz: any) {
src\app\api\vendor\purchases\initialize\route.ts:26  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\vendor\purchases\initialize\route.ts:27  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\vendor\purchases\initialize\route.ts:36  function paystackSecret() {
src\app\api\vendor\purchases\initialize\route.ts:37  return process.env.PAYSTACK_SECRET_KEY || process.env.PAYSTACK_SECRET || process.env.PAYSTACK_PRIVATE_KEY || "";
src\app\api\vendor\purchases\initialize\route.ts:40  async function paystackInitialize(args: {
src\app\api\vendor\purchases\initialize\route.ts:47  const sk = paystackSecret();
src\app\api\vendor\purchases\initialize\route.ts:48  if (!sk) throw new Error("Missing PAYSTACK_SECRET_KEY env");
src\app\api\vendor\purchases\initialize\route.ts:50  const r = await fetch("https://api.paystack.co/transaction/initialize", {
src\app\api\vendor\purchases\initialize\route.ts:66  if (!r.ok || !j?.status) throw new Error(j?.message || "Paystack initialize failed");
src\app\api\vendor\purchases\initialize\route.ts:89  const planKey = cleanPlanKey(plan.planKey);
src\app\api\vendor\purchases\initialize\route.ts:93  if (planKey !== addon.plan) {
src\app\api\vendor\purchases\initialize\route.ts:97  // Require subscription active
src\app\api\vendor\purchases\initialize\route.ts:98  if (!isSubscriptionActive(biz)) {
src\app\api\vendor\purchases\initialize\route.ts:100  { ok: false, error: "Your subscription is not active. Renew subscription to buy add-ons." },
src\app\api\vendor\purchases\initialize\route.ts:130  planKey,
src\app\api\vendor\purchases\initialize\route.ts:160  planKey,
src\app\api\vendor\purchases\initialize\route.ts:173  // Paystack (kept, hidden)
src\app\api\vendor\purchases\initialize\route.ts:175  const data = await paystackInitialize({
src\app\api\vendor\purchases\initialize\route.ts:186  planKey,
src\app\api\vendor\purchases\route.ts:12  function isSubscriptionActive(biz: any) {
src\app\api\vendor\purchases\route.ts:13  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\vendor\purchases\route.ts:14  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\vendor\purchases\route.ts:17  function cleanPlanKey(v: any) {
src\app\api\vendor\purchases\route.ts:46  const planKey = cleanPlanKey(plan.planKey);
src\app\api\vendor\purchases\route.ts:48  const subscriptionActive = isSubscriptionActive(biz);
src\app\api\vendor\purchases\route.ts:52  const items = addonsForPlan(planKey as any).map((a) => {
src\app\api\vendor\purchases\route.ts:70  planKey,
src\app\api\vendor\purchases\route.ts:71  subscriptionActive,
src\app\api\vendor\reengagement\audience\route.ts:40  function planOrderScanCap(planKey: string) {
src\app\api\vendor\reengagement\audience\route.ts:41  const k = String(planKey || "FREE").toUpperCase();
src\app\api\vendor\reengagement\audience\route.ts:73  if (pt === "paystack_escrow") return true;
src\app\api\vendor\reengagement\audience\route.ts:163  const planKey = String(plan.planKey || "FREE").toUpperCase();
src\app\api\vendor\reengagement\audience\route.ts:174  const allowVip = planKey === "APEX" && !!plan?.features?.reengagementAiRemix;
src\app\api\vendor\reengagement\audience\route.ts:187  const orderScanCap = planOrderScanCap(planKey);
src\app\api\vendor\reengagement\audience\route.ts:326  planKey,
src\app\api\vendor\reengagement\remix\route.ts:14  function cleanPlanKey(v: any) {
src\app\api\vendor\reengagement\remix\route.ts:19  function capForPlan(planKey: string) {
src\app\api\vendor\reengagement\remix\route.ts:20  const k = cleanPlanKey(planKey);
src\app\api\vendor\reengagement\remix\route.ts:23  if (k === "APEX") return Infinity; // unlimited
src\app\api\vendor\reengagement\remix\route.ts:27  function suggestionForRemixLocked(planKey: string) {
src\app\api\vendor\reengagement\remix\route.ts:28  const k = cleanPlanKey(planKey);
src\app\api\vendor\reengagement\remix\route.ts:51  url: "/vendor/subscription",
src\app\api\vendor\reengagement\remix\route.ts:58  title: "Upgrade to Apex for unlimited AI remix",
src\app\api\vendor\reengagement\remix\route.ts:59  url: "/vendor/subscription",
src\app\api\vendor\reengagement\remix\route.ts:81  const planKey = cleanPlanKey(plan.planKey);
src\app\api\vendor\reengagement\remix\route.ts:91  suggestion: suggestionForRemixLocked(planKey),
src\app\api\vendor\reengagement\remix\route.ts:95  // If Apex: unlimited (still can return usage = null)
src\app\api\vendor\reengagement\remix\route.ts:96  const cap = capForPlan(planKey);
src\app\api\vendor\reengagement\remix\route.ts:98  // If somehow enabled but cap invalid, treat as unlimited
src\app\api\vendor\reengagement\send\route.ts:12  type PlanKey,
src\app\api\vendor\reengagement\send\route.ts:72  const planKey = String(plan.planKey || "FREE").toUpperCase() as PlanKey;
src\app\api\vendor\reengagement\send\route.ts:99  const allowVip = String(planKey || "").toUpperCase() === "APEX" && allowAiRemix;
src\app\api\vendor\reengagement\send\route.ts:133  await adminDb.collection("vendorPolicyViolations").doc().set({
src\app\api\vendor\reengagement\send\route.ts:166  planKey,
src\app\api\vendor\reengagement\send\route.ts:190  planKey,
src\app\api\vendor\reengagement\send\route.ts:223  planKey,
src\app\api\vendor\reengagement\send\route.ts:239  limit: { planKey, ...allowed },
src\app\api\vendor\shipping\options\route.ts:40  type: o.type || "delivery",
src\app\api\vendor\shipping\options\route.ts:41  name: o.name || "Delivery",
src\app\api\vendor\shipping\options\route.ts:44  areasText: o.areasText || null,
src\app\api\vendor\shipping\route.ts:12  type ShipType = "pickup" | "delivery";
src\app\api\vendor\shipping\route.ts:15  return String(v || "delivery") === "pickup" ? "pickup" : "delivery";
src\app\api\vendor\shipping\route.ts:100  const areasText = cleanText(body.areasText, 160);
src\app\api\vendor\shipping\route.ts:113  type, // pickup | delivery
src\app\api\vendor\shipping\route.ts:119  areasText: areasText || null,
src\app\api\vendor\staff\route.ts:7  import { getStaffSeatState } from "@/lib/vendor/staffSeatsServer";
src\app\api\vendor\staff\route.ts:45  function suggestionForStaffLimit(planKey: string) {
src\app\api\vendor\staff\route.ts:46  const pk = String(planKey || "").toUpperCase();
src\app\api\vendor\staff\route.ts:58  url: "/vendor/subscription",
src\app\api\vendor\staff\route.ts:78  const seats = await getStaffSeatState(me.businessId);
src\app\api\vendor\staff\route.ts:99  const seats = await getStaffSeatState(me.businessId);
src\app\api\vendor\staff\route.ts:106  suggestion: { action: "upgrade", url: "/vendor/subscription" },
src\app\api\vendor\staff\route.ts:113  const sug = suggestionForStaffLimit(String(seats.planKey || ""));
src\app\api\vendor\store\route.ts:13  function hasActiveSubscription(biz: any) {
src\app\api\vendor\store\route.ts:14  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\app\api\vendor\store\route.ts:15  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\app\api\vendor\store\route.ts:50  if (wantsContinueInChatEnabled && !hasActiveSubscription(biz)) {
src\app\api\vendor\store\route.ts:52  { ok: false, code: "SUBSCRIPTION_REQUIRED", error: "Subscribe to enable Continue in Chat." },
src\app\api\vendor\store\route.ts:62  state: typeof body.state === "string" ? body.state.trim() : undefined,
src\app\api\vendor\store\route.ts:63  city: typeof body.city === "string" ? body.city.trim() : undefined,
src\app\api\vendor\store\route.ts:78  state: typeof body.state === "string" ? body.state.trim() : String(biz?.state || ""),
src\app\api\vendor\store\route.ts:79  city: typeof body.city === "string" ? body.city.trim() : String(biz?.city || ""),
src\app\api\vendor\store\route.ts:91  return NextResponse.json({ ok: true, planKey: plan.planKey, canCustomize });
src\app\api\vendor\support\chat\route.ts:47  "3) Price and stock must be correct",
src\app\api\vendor\support\chat\route.ts:48  "- Out of stock = people stop clicking",
src\app\api\vendor\verification\route.ts:57  state: biz?.state ?? null,
src\app\api\vendor\verification\route.ts:58  city: biz?.city ?? null,
src\app\api\vendor\verification\route.ts:61  verificationTier: Number(biz?.verificationTier || 0),
src\app\api\vendor\verification\route.ts:100  status: "verified", // auto
src\app\api\vendor\verification\route.ts:103  verifiedAtMs: nowMs,
src\app\api\vendor\verification\route.ts:118  status: "auto_verified",
src\app\api\vendor\verification\route.ts:122  reviewedAtMs: nowMs,
src\app\api\vendor\verification\route.ts:127  return NextResponse.json({ ok: true, tier: "tier1", status: "verified" });
src\app\api\vendor\verification\route.ts:131  // Tier 2: ID number only (no photo) -> pending admin review
src\app\api\vendor\verification\route.ts:169  // Tier 3: proof of address (upload) -> pending admin review
src\app\b\[slug]\checkout\page.tsx:8  import { useEffect, useMemo, useState } from "react";
src\app\b\[slug]\checkout\page.tsx:9  import { onAuthStateChanged } from "firebase/auth";
src\app\b\[slug]\checkout\page.tsx:21  type: "pickup" | "delivery";
src\app\b\[slug]\checkout\page.tsx:25  areasText?: string | null;
src\app\b\[slug]\checkout\page.tsx:28  type PayCurrency = "NGN" | "USD";
src\app\b\[slug]\checkout\page.tsx:45  const v = String(localStorage.getItem(key) || "").toUpperCase();
src\app\b\[slug]\checkout\page.tsx:46  return v === "USD" ? "USD" : "NGN";
src\app\b\[slug]\checkout\page.tsx:55  localStorage.setItem(key, c);
src\app\b\[slug]\checkout\page.tsx:69  if (m.includes("usd payments not configured") || m.includes("missing fx")) {
src\app\b\[slug]\checkout\page.tsx:70  return "USD payments are not available right now. Please switch to NGN or try again later.";
src\app\b\[slug]\checkout\page.tsx:93  const [authLoading, setAuthLoading] = useState(true);
src\app\b\[slug]\checkout\page.tsx:94  const [loggedIn, setLoggedIn] = useState(false);
src\app\b\[slug]\checkout\page.tsx:95  const [emailVerified, setEmailVerified] = useState<boolean>(false);
src\app\b\[slug]\checkout\page.tsx:97  const [email, setEmail] = useState("");
src\app\b\[slug]\checkout\page.tsx:98  const [fullName, setFullName] = useState("");
src\app\b\[slug]\checkout\page.tsx:99  const [phone, setPhone] = useState("");
src\app\b\[slug]\checkout\page.tsx:100  const [address, setAddress] = useState("");
src\app\b\[slug]\checkout\page.tsx:104  const [couponCode, setCouponCode] = useState("");
src\app\b\[slug]\checkout\page.tsx:105  const [couponMsg, setCouponMsg] = useState<string | null>(null);
src\app\b\[slug]\checkout\page.tsx:106  const [couponLoading, setCouponLoading] = useState(false);
src\app\b\[slug]\checkout\page.tsx:107  const [applied, setApplied] = useState<any>(null);
src\app\b\[slug]\checkout\page.tsx:109  const [shipLoading, setShipLoading] = useState(false);
src\app\b\[slug]\checkout\page.tsx:110  const [shipMsg, setShipMsg] = useState<string | null>(null);
src\app\b\[slug]\checkout\page.tsx:111  const [shippingOptions, setShippingOptions] = useState<ShippingOption[]>([]);
src\app\b\[slug]\checkout\page.tsx:112  const [selectedShipId, setSelectedShipId] = useState<string>("");
src\app\b\[slug]\checkout\page.tsx:114  const [quoteLoading, setQuoteLoading] = useState(false);
src\app\b\[slug]\checkout\page.tsx:115  const [quoteMsg, setQuoteMsg] = useState<string | null>(null);
src\app\b\[slug]\checkout\page.tsx:116  const [quote, setQuote] = useState<any>(null);
src\app\b\[slug]\checkout\page.tsx:118  const [payLoading, setPayLoading] = useState(false);
src\app\b\[slug]\checkout\page.tsx:120  // USD eligibility
src\app\b\[slug]\checkout\page.tsx:121  const [usdEligible, setUsdEligible] = useState(false);
src\app\b\[slug]\checkout\page.tsx:122  const [payCurrency, setPayCurrency] = useState<PayCurrency>("NGN");
src\app\b\[slug]\checkout\page.tsx:152  // Fetch USD eligibility from server
src\app\b\[slug]\checkout\page.tsx:163  const ok = !!j?.usdEligible;
src\app\b\[slug]\checkout\page.tsx:166  setUsdEligible(ok);
src\app\b\[slug]\checkout\page.tsx:174  setUsdEligible(false);
src\app\b\[slug]\checkout\page.tsx:250  const unsub = onAuthStateChanged(auth, async (u) => {
src\app\b\[slug]\checkout\page.tsx:271  const ok = !!data?.me?.emailVerified;
src\app\b\[slug]\checkout\page.tsx:272  setEmailVerified(ok);
src\app\b\[slug]\checkout\page.tsx:278  setEmailVerified(false);
src\app\b\[slug]\checkout\page.tsx:461  const totalNgn = totalKobo / 100;
src\app\b\[slug]\checkout\page.tsx:472  emailVerified &&
src\app\b\[slug]\checkout\page.tsx:484  const effectiveCurrency: PayCurrency = usdEligible ? payCurrency : "NGN";
src\app\b\[slug]\checkout\page.tsx:528  const r = await fetch("/api/paystack/initialize", {
src\app\b\[slug]\checkout\page.tsx:575  window.location.href = url;
src\app\b\[slug]\checkout\page.tsx:593  <p className="text-xs opacity-95 mt-1">
src\app\b\[slug]\checkout\page.tsx:597  <p className="text-2xl font-bold mt-2">{fmtNaira(totalNgn)}</p>
src\app\b\[slug]\checkout\page.tsx:599  <p className="text-[11px] opacity-95 mt-2">
src\app\b\[slug]\checkout\page.tsx:621  {quoteLoading ? <p className="text-[11px] opacity-95 mt-2">Updating totalÖ</p> : null}
src\app\b\[slug]\checkout\page.tsx:625  <SectionCard title="Shipping" subtitle="Choose delivery or pickup">
src\app\b\[slug]\checkout\page.tsx:656  {o.name} {o.type === "pickup" ? "(Pickup)" : "(Delivery)"}
src\app\b\[slug]\checkout\page.tsx:658  <p className={active ? "text-[11px] opacity-90 mt-1" : "text-[11px] text-biz-muted mt-1"}>
src\app\b\[slug]\checkout\page.tsx:661  {o.areasText ? ` ï ${o.areasText}` : ""}
src\app\b\[slug]\checkout\page.tsx:692  <SectionCard title="Customer details" subtitle="Saved on this device for faster checkout">
src\app\b\[slug]\checkout\page.tsx:699  <textarea
src\app\b\[slug]\checkout\page.tsx:701  placeholder="Delivery address"
src\app\b\[slug]\checkout\page.tsx:708  <p className="text-xs text-biz-muted">Pickup selected ó delivery address not required.</p>
src\app\b\[slug]\checkout\page.tsx:713  {!emailVerified ? <p className="mt-3 text-xs text-red-700">Please verify your email to continue checkout.</p> : null}
src\app\b\[slug]\checkout\page.tsx:719  {usdEligible ? (
src\app\b\[slug]\checkout\page.tsx:722  <p className="text-[11px] text-biz-muted mt-1">This vendor supports USD card payments.</p>
src\app\b\[slug]\checkout\page.tsx:738  onClick={() => setPayCurrency("USD")}
src\app\b\[slug]\checkout\page.tsx:740  payCurrency === "USD"
src\app\b\[slug]\checkout\page.tsx:745  USD
src\app\b\[slug]\checkout\page.tsx:752  Pay with card {usdEligible ? `(${payCurrency})` : ""}
src\app\b\[slug]\p\[productId]\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\b\[slug]\p\[productId]\page.tsx:29  type: "pickup" | "delivery";
src\app\b\[slug]\p\[productId]\page.tsx:33  areasText?: string | null;
src\app\b\[slug]\p\[productId]\page.tsx:72  if (p?.saleActive !== true) return false;
src\app\b\[slug]\p\[productId]\page.tsx:80  const t = String(p?.saleType || "");
src\app\b\[slug]\p\[productId]\page.tsx:89  const t = String(p?.saleType || "");
src\app\b\[slug]\p\[productId]\page.tsx:91  const off = Number(p?.saleAmountOffNgn || 0);
src\app\b\[slug]\p\[productId]\page.tsx:95  const pct = Math.max(0, Math.min(90, Number(p?.salePercent || 0)));
src\app\b\[slug]\p\[productId]\page.tsx:101  const t = String(p?.saleType || "");
src\app\b\[slug]\p\[productId]\page.tsx:103  const off = Number(p?.saleAmountOffNgn || 0);
src\app\b\[slug]\p\[productId]\page.tsx:106  const pct = Number(p?.salePercent || 0);
src\app\b\[slug]\p\[productId]\page.tsx:118  if (j?.apexBadgeActive === true) return "earned_apex";
src\app\b\[slug]\p\[productId]\page.tsx:119  if (j?.temporaryApexBadgeActive === true) return "temporary_apex";
src\app\b\[slug]\p\[productId]\page.tsx:131  const [loading, setLoading] = useState(true);
src\app\b\[slug]\p\[productId]\page.tsx:132  const [p, setP] = useState<any>(null);
src\app\b\[slug]\p\[productId]\page.tsx:133  const [msg, setMsg] = useState<string | null>(null);
src\app\b\[slug]\p\[productId]\page.tsx:134  const [selected, setSelected] = useState<Record<string, string>>({});
src\app\b\[slug]\p\[productId]\page.tsx:136  const [storeTrustBadge, setStoreTrustBadge] = useState<TrustBadgeType>(null);
src\app\b\[slug]\p\[productId]\page.tsx:138  const [activeImg, setActiveImg] = useState(0);
src\app\b\[slug]\p\[productId]\page.tsx:140  const [qty, setQty] = useState<number>(1);
src\app\b\[slug]\p\[productId]\page.tsx:141  const [deliveryLocation, setDeliveryLocation] = useState<string>("");
src\app\b\[slug]\p\[productId]\page.tsx:143  const [shipLoading, setShipLoading] = useState(false);
src\app\b\[slug]\p\[productId]\page.tsx:144  const [shipMsg, setShipMsg] = useState<string | null>(null);
src\app\b\[slug]\p\[productId]\page.tsx:145  const [shippingOptions, setShippingOptions] = useState<ShippingOption[]>([]);
src\app\b\[slug]\p\[productId]\page.tsx:146  const [selectedShipId, setSelectedShipId] = useState<string>("");
src\app\b\[slug]\p\[productId]\page.tsx:148  const [chatAvail, setChatAvail] = useState<ChatAvailability | null>(null);
src\app\b\[slug]\p\[productId]\page.tsx:175  const outOfStock = listingType === "product" && Number(p?.stock ?? 0) <= 0;
src\app\b\[slug]\p\[productId]\page.tsx:194  const itemsSubtotalNgn = Math.max(0, Math.floor(Number(qty || 1)) * unitPriceNgn);
src\app\b\[slug]\p\[productId]\page.tsx:195  const estimatedTotalNgn = itemsSubtotalNgn + shippingFeeNgn;
src\app\b\[slug]\p\[productId]\page.tsx:207  if (outOfStock) return false;
src\app\b\[slug]\p\[productId]\page.tsx:210  if (deliveryLocation.trim().length < 2) return false;
src\app\b\[slug]\p\[productId]\page.tsx:213  }, [qty, p, canChat, bookOnly, outOfStock, shippingRequired, selectedShipping, deliveryLocation]);
src\app\b\[slug]\p\[productId]\page.tsx:289  if (!r.ok) throw new Error(data?.error || "Failed to load delivery options");
src\app\b\[slug]\p\[productId]\page.tsx:305  setShipMsg(e?.message || "Failed to load delivery options");
src\app\b\[slug]\p\[productId]\page.tsx:420  ? `${selectedShipping.name} ${selectedShipping.type === "pickup" ? "(Pickup)" : "(Delivery)"}`
src\app\b\[slug]\p\[productId]\page.tsx:438  lines.push(`Items subtotal: ${fmtNaira(itemsSubtotalNgn)}`);
src\app\b\[slug]\p\[productId]\page.tsx:440  lines.push(`Delivery option: ${shipLabel}`);
src\app\b\[slug]\p\[productId]\page.tsx:443  lines.push(`Delivery location: ${deliveryLocation.trim() || "To be confirmed"}`);
src\app\b\[slug]\p\[productId]\page.tsx:450  lines.push(`Estimated total: ${fmtNaira(estimatedTotalNgn)}`);
src\app\b\[slug]\p\[productId]\page.tsx:472  className="rounded-2xl border border-biz-line bg-white px-3 py-2 text-xs font-extrabold shadow-soft relative"
src\app\b\[slug]\p\[productId]\page.tsx:492  <div className={`${coverAspectClass} w-full rounded-3xl bg-gradient-to-br from-biz-sand to-biz-cream overflow-hidden relative`}>
src\app\b\[slug]\p\[productId]\page.tsx:500  sizes="(max-width: 430px) 100vw, 430px"
src\app\b\[slug]\p\[productId]\page.tsx:529  <CloudImage src={u} alt={`Preview ${idx + 1}`} w={160} h={160} sizes="56px" className="h-full w-full object-cover" />
src\app\b\[slug]\p\[productId]\page.tsx:542  Verified Apex
src\app\b\[slug]\p\[productId]\page.tsx:571  Stock: <b className="text-biz-ink">{Number(p?.stock ?? 0)}</b>
src\app\b\[slug]\p\[productId]\page.tsx:588  <SectionCard title="Variations" subtitle="Optional choices (price/stock stays the same)">
src\app\b\[slug]\p\[productId]\page.tsx:635  <Button variant="secondary" onClick={add} disabled={outOfStock}>
src\app\b\[slug]\p\[productId]\page.tsx:636  {outOfStock ? "Out of stock" : "Add to cart"}
src\app\b\[slug]\p\[productId]\page.tsx:640  <Button onClick={add} disabled={outOfStock}>
src\app\b\[slug]\p\[productId]\page.tsx:641  {outOfStock ? "Out of stock" : "Add to cart"}
src\app\b\[slug]\p\[productId]\page.tsx:651  Select delivery option and enter delivery location (for delivery) to continue in chat.
src\app\b\[slug]\pay\direct\page-client.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\b\[slug]\pay\direct\page-client.tsx:21  type: "pickup" | "delivery";
src\app\b\[slug]\pay\direct\page-client.tsx:25  areasText?: string | null;
src\app\b\[slug]\pay\direct\page-client.tsx:56  const [loading, setLoading] = useState(true);
src\app\b\[slug]\pay\direct\page-client.tsx:57  const [biz, setBiz] = useState<any>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:58  const [error, setError] = useState<string | null>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:60  const [payerName, setPayerName] = useState(sp.get("name") ?? "");
src\app\b\[slug]\pay\direct\page-client.tsx:61  const [payerPhone, setPayerPhone] = useState(sp.get("phone") ?? "");
src\app\b\[slug]\pay\direct\page-client.tsx:63  const [orderId, setOrderId] = useState<string>(sp.get("orderId") ?? "");
src\app\b\[slug]\pay\direct\page-client.tsx:65  const [profileEmail, setProfileEmail] = useState("");
src\app\b\[slug]\pay\direct\page-client.tsx:66  const [profileAddress, setProfileAddress] = useState("");
src\app\b\[slug]\pay\direct\page-client.tsx:68  const [proofFile, setProofFile] = useState<File | null>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:69  const [uploadingProof, setUploadingProof] = useState(false);
src\app\b\[slug]\pay\direct\page-client.tsx:70  const [proofMsg, setProofMsg] = useState<string | null>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:71  const [proofViewUrl, setProofViewUrl] = useState<string>("");
src\app\b\[slug]\pay\direct\page-client.tsx:73  const [shipLoading, setShipLoading] = useState(false);
src\app\b\[slug]\pay\direct\page-client.tsx:74  const [shipMsg, setShipMsg] = useState<string | null>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:75  const [shippingOptions, setShippingOptions] = useState<ShippingOption[]>([]);
src\app\b\[slug]\pay\direct\page-client.tsx:76  const [selectedShipId, setSelectedShipId] = useState<string>("");
src\app\b\[slug]\pay\direct\page-client.tsx:78  const [quoteLoading, setQuoteLoading] = useState(false);
src\app\b\[slug]\pay\direct\page-client.tsx:79  const [quoteMsg, setQuoteMsg] = useState<string | null>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:80  const [quote, setQuote] = useState<any>(null);
src\app\b\[slug]\pay\direct\page-client.tsx:243  const grandTotalNgn = grandTotalKobo / 100;
src\app\b\[slug]\pay\direct\page-client.tsx:377  <p className="text-2xl font-bold mt-2">{fmtNaira(grandTotalNgn)}</p>
src\app\b\[slug]\pay\direct\page-client.tsx:379  <p className="text-[11px] opacity-95 mt-2">
src\app\b\[slug]\pay\direct\page-client.tsx:407  {quoteLoading ? <p className="text-[11px] opacity-95 mt-2">Updating totalÖ</p> : null}
src\app\b\[slug]\pay\direct\page-client.tsx:451  Tip: Put your name in the transfer narration so the vendor can confirm faster.
src\app\b\[slug]\pay\direct\page-client.tsx:514  {selectedShipping.type === "pickup" ? "Pickup" : "Delivery"} {BULLET} Fee:{" "}
src\app\b\[slug]\pay\direct\page-client.tsx:543  className="w-full rounded-2xl py-3 text-sm font-bold text-white shadow-float bg-gradient-to-br from-biz-accent2 to-biz-accent disabled:opacity-50"
src\app\b\[slug]\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\b\[slug]\page.tsx:13  import { EmptyState } from "@/components/ui/EmptyState";
src\app\b\[slug]\page.tsx:41  if (p?.saleActive !== true) return false;
src\app\b\[slug]\page.tsx:49  const t = String(p?.saleType || "");
src\app\b\[slug]\page.tsx:58  const t = String(p?.saleType || "");
src\app\b\[slug]\page.tsx:60  const off = Number(p?.saleAmountOffNgn || 0);
src\app\b\[slug]\page.tsx:64  const pct = Math.max(0, Math.min(90, Number(p?.salePercent || 0)));
src\app\b\[slug]\page.tsx:70  const t = String(p?.saleType || "");
src\app\b\[slug]\page.tsx:72  const off = Number(p?.saleAmountOffNgn || 0);
src\app\b\[slug]\page.tsx:75  const pct = Number(p?.salePercent || 0);
src\app\b\[slug]\page.tsx:105  <div className={`${aspectClass} w-full rounded-2xl bg-gradient-to-br from-biz-sand to-biz-cream overflow-hidden relative`}>
src\app\b\[slug]\page.tsx:112  sizes="(max-width: 430px) 45vw, 200px"
src\app\b\[slug]\page.tsx:173  if (j?.apexBadgeActive === true) return "earned_apex";
src\app\b\[slug]\page.tsx:174  if (j?.temporaryApexBadgeActive === true) return "temporary_apex";
src\app\b\[slug]\page.tsx:185  const [biz, setBiz] = useState<any>(null);
src\app\b\[slug]\page.tsx:186  const [items, setItems] = useState<any[]>([]);
src\app\b\[slug]\page.tsx:187  const [msg, setMsg] = useState<string | null>(null);
src\app\b\[slug]\page.tsx:188  const [loading, setLoading] = useState(true);
src\app\b\[slug]\page.tsx:190  const [trustBadge, setTrustBadge] = useState<TrustBadgeType>(null);
src\app\b\[slug]\page.tsx:281  const location = [biz?.city, biz?.state].filter(Boolean).join(", ");
src\app\b\[slug]\page.tsx:289  subtitle={location || `Vendor: ${slug}`}
src\app\b\[slug]\page.tsx:315  sizes="(max-width: 430px) 100vw, 430px"
src\app\b\[slug]\page.tsx:325  <CloudImage src={logo} alt="Logo" w={160} h={160} sizes="56px" className="h-full w-full object-cover" />
src\app\b\[slug]\page.tsx:340  title="Verified Apex badge (earned + maintained)"
src\app\b\[slug]\page.tsx:343  Verified Apex
src\app\b\[slug]\page.tsx:358  <p className="text-xs text-biz-muted mt-1">{location || "Nigeria"}</p>
src\app\b\[slug]\page.tsx:396  <EmptyState
src\app\b\[slug]\page.tsx:426  const outOfStock = Number(p?.stock ?? 0) <= 0;
src\app\b\[slug]\page.tsx:427  const canQuickAdd = !hasOptions && !outOfStock;
src\app\cart\page.tsx:9  import { useEffect, useMemo, useState } from "react";
src\app\cart\page.tsx:52  const [chatAvail, setChatAvail] = useState<ChatAvailability | null>(null);
src\app\cart\page.tsx:53  const [chatMsg, setChatMsg] = useState<string | null>(null);
src\app\cart\page.tsx:158  <GradientHeader title="Cart" subtitle="Review items before checkout" showBack={false} />
src\app\fcm-sw\route.ts:10  const storageBucket = process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET || "";
src\app\fcm-sw\route.ts:23  storageBucket: ${JSON.stringify(storageBucket)},
src\app\market\page.tsx:3  import { useEffect, useMemo, useRef, useState } from "react";
src\app\market\page.tsx:13  import { EmptyState } from "@/components/ui/EmptyState";
src\app\market\page.tsx:72  if (p?.saleActive !== true) return false;
src\app\market\page.tsx:80  const t = String(p?.saleType || "");
src\app\market\page.tsx:90  const t = String(p?.saleType || "");
src\app\market\page.tsx:92  const off = Number(p?.saleAmountOffNgn || 0);
src\app\market\page.tsx:96  const pct = Math.max(0, Math.min(90, Number(p?.salePercent || 0)));
src\app\market\page.tsx:102  const t = String(p?.saleType || "");
src\app\market\page.tsx:104  const off = Number(p?.saleAmountOffNgn || 0);
src\app\market\page.tsx:108  const pct = Number(p?.salePercent || 0);
src\app\market\page.tsx:116  const apexBoost = p?.apexBadgeActive === true ? 2500 : 0;
src\app\market\page.tsx:123  function hasActiveSubscriptionBusiness(b: any) {
src\app\market\page.tsx:124  const exp = Number(b?.subscription?.expiresAtMs || 0);
src\app\market\page.tsx:125  return !!(b?.subscription?.planKey && exp && exp > Date.now());
src\app\market\page.tsx:131  const [qText, setQText] = useState("");
src\app\market\page.tsx:132  const [loading, setLoading] = useState(false);
src\app\market\page.tsx:133  const [items, setItems] = useState<DocumentData[]>([]);
src\app\market\page.tsx:134  const [msg, setMsg] = useState<string | null>(null);
src\app\market\page.tsx:136  const [deals, setDeals] = useState<DocumentData[]>([]);
src\app\market\page.tsx:137  const [dealsLoading, setDealsLoading] = useState(false);
src\app\market\page.tsx:139  const [stores, setStores] = useState<DocumentData[]>([]);
src\app\market\page.tsx:140  const [storesLoading, setStoresLoading] = useState(false);
src\app\market\page.tsx:143  const [tierFilter, setTierFilter] = useState<number | null>(null);
src\app\market\page.tsx:144  const [stateFilter, setStateFilter] = useState<string>("");
src\app\market\page.tsx:145  const [cityFilter, setCityFilter] = useState<string>("");
src\app\market\page.tsx:147  const [saleOnly, setSaleOnly] = useState(false);
src\app\market\page.tsx:149  const [categoryFilter, setCategoryFilter] = useState<MarketCategoryKey | null>(null);
src\app\market\page.tsx:150  const [apexOnly, setApexOnly] = useState(false);
src\app\market\page.tsx:151  const [colorFilter, setColorFilter] = useState("");
src\app\market\page.tsx:152  const [sizeFilter, setSizeFilter] = useState("");
src\app\market\page.tsx:165  .filter((p: any) => p?.businessHasActiveSubscription !== false)
src\app\market\page.tsx:168  return Number(p?.marketTier || 0) === tierFilter;
src\app\market\page.tsx:171  if (!stateFilter.trim()) return true;
src\app\market\page.tsx:172  return String(p?.businessState || "").toLowerCase().includes(stateFilter.trim().toLowerCase());
src\app\market\page.tsx:175  if (!cityFilter.trim()) return true;
src\app\market\page.tsx:176  return String(p?.businessCity || "").toLowerCase().includes(cityFilter.trim().toLowerCase());
src\app\market\page.tsx:193  return p?.apexBadgeActive === true;
src\app\market\page.tsx:197  const colors = Array.isArray(p?.attrs?.colors) ? p.attrs.colors : [];
src\app\market\page.tsx:198  return colors.map((x: any) => String(x || "").toLowerCase()).includes(colorNeedle);
src\app\market\page.tsx:202  const sizes = Array.isArray(p?.attrs?.sizes) ? p.attrs.sizes : [];
src\app\market\page.tsx:203  return sizes.map((x: any) => String(x || "").toLowerCase()).includes(sizeNeedle);
src\app\market\page.tsx:246  const latestRef = query(collection(db, "products"), orderBy("createdAt", "desc"), limit(120));
src\app\market\page.tsx:247  const latestSnap = await getDocs(latestRef);
src\app\market\page.tsx:248  const latest = latestSnap.docs.map((d) => ({ id: d.id, ...d.data() }));
src\app\market\page.tsx:253  for (const p of [...boosted, ...latest]) {
src\app\market\page.tsx:389  .filter((b: any) => hasActiveSubscriptionBusiness(b))
src\app\market\page.tsx:391  if (!stateFilter.trim()) return true;
src\app\market\page.tsx:392  return String(b?.state || "").toLowerCase().includes(stateFilter.trim().toLowerCase());
src\app\market\page.tsx:395  if (!cityFilter.trim()) return true;
src\app\market\page.tsx:396  return String(b?.city || "").toLowerCase().includes(cityFilter.trim().toLowerCase());
src\app\market\page.tsx:427  }, [tierFilter, stateFilter, cityFilter, saleOnly, categoryFilter, apexOnly, colorFilter, sizeFilter]);
src\app\market\page.tsx:453  const tier = Number(p?.marketTier ?? p?.verificationTier ?? 0);
src\app\market\page.tsx:463  const apexBadgeActive = p?.apexBadgeActive === true;
src\app\market\page.tsx:472  <div className={`${aspectClass} w-full rounded-2xl bg-gradient-to-br from-biz-sand to-biz-cream overflow-hidden relative`}>
src\app\market\page.tsx:479  sizes="(max-width: 430px) 45vw, 220px"
src\app\market\page.tsx:486  {apexBadgeActive ? (
src\app\market\page.tsx:489  Verified
src\app\market\page.tsx:535  const state = String(b?.state || "").trim();
src\app\market\page.tsx:536  const city = String(b?.city || "").trim();
src\app\market\page.tsx:538  const loc = [city, state].filter(Boolean).join(", ");
src\app\market\page.tsx:562  stateFilter.trim() ||
src\app\market\page.tsx:563  cityFilter.trim() ||
src\app\market\page.tsx:573  <div className="relative">
src\app\market\page.tsx:610  <>Showing latest + promoted</>
src\app\market\page.tsx:630  Verified
src\app\market\page.tsx:641  <Input placeholder="State (optional)" value={stateFilter} onChange={(e) => setStateFilter(e.target.value)} />
src\app\market\page.tsx:642  <Input placeholder="City (optional)" value={cityFilter} onChange={(e) => setCityFilter(e.target.value)} />
src\app\market\page.tsx:657  setStateFilter("");
src\app\market\page.tsx:658  setCityFilter("");
src\app\market\page.tsx:682  <EmptyState
src\app\market\page.tsx:684  description="Check back soon for discounts from verified vendors."
src\app\market\page.tsx:728  <EmptyState
src\app\market\page.tsx:744  <EmptyState
src\app\market\page.tsx:750  setStateFilter("");
src\app\market\page.tsx:751  setCityFilter("");
src\app\orders\[orderId]\dispute\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\orders\[orderId]\dispute\page.tsx:10  import { onAuthStateChanged } from "firebase/auth";
src\app\orders\[orderId]\dispute\page.tsx:18  const [authLoading, setAuthLoading] = useState(true);
src\app\orders\[orderId]\dispute\page.tsx:19  const [loggedIn, setLoggedIn] = useState(false);
src\app\orders\[orderId]\dispute\page.tsx:21  const [loading, setLoading] = useState(true);
src\app\orders\[orderId]\dispute\page.tsx:22  const [o, setO] = useState<any>(null);
src\app\orders\[orderId]\dispute\page.tsx:23  const [msg, setMsg] = useState<string | null>(null);
src\app\orders\[orderId]\dispute\page.tsx:25  const [reason, setReason] = useState("Not delivered");
src\app\orders\[orderId]\dispute\page.tsx:26  const [details, setDetails] = useState("");
src\app\orders\[orderId]\dispute\page.tsx:27  const [sending, setSending] = useState(false);
src\app\orders\[orderId]\dispute\page.tsx:29  const [evidenceUrls, setEvidenceUrls] = useState<string[]>([]);
src\app\orders\[orderId]\dispute\page.tsx:32  const unsub = onAuthStateChanged(auth, async (u) => {
src\app\orders\[orderId]\dispute\page.tsx:161  <textarea
src\app\orders\[orderId]\dispute\page.tsx:163  placeholder="Explain what happened (dates, delivery info, proof)Ö"
src\app\orders\[orderId]\dispute\page.tsx:187  Disputes are reviewed by myBizHub. Provide clear evidence to help resolve faster.
src\app\orders\[orderId]\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\orders\[orderId]\page.tsx:11  import { onAuthStateChanged } from "firebase/auth";
src\app\orders\[orderId]\page.tsx:97  if (paymentType === "paystack_escrow") return "Card payment";
src\app\orders\[orderId]\page.tsx:101  if (provider.toLowerCase() === "paystack") return "Card payment";
src\app\orders\[orderId]\page.tsx:124  const [authLoading, setAuthLoading] = useState(true);
src\app\orders\[orderId]\page.tsx:125  const [loggedIn, setLoggedIn] = useState(false);
src\app\orders\[orderId]\page.tsx:127  const [loading, setLoading] = useState(true);
src\app\orders\[orderId]\page.tsx:128  const [o, setO] = useState<any>(null);
src\app\orders\[orderId]\page.tsx:129  const [msg, setMsg] = useState<string | null>(null);
src\app\orders\[orderId]\page.tsx:131  // installment UI state
src\app\orders\[orderId]\page.tsx:132  const [uploadingIdx, setUploadingIdx] = useState<string | null>(null);
src\app\orders\[orderId]\page.tsx:133  const [proofMsgMap, setProofMsgMap] = useState<Record<string, string>>({});
src\app\orders\[orderId]\page.tsx:134  const [fileMap, setFileMap] = useState<Record<string, File | null>>({});
src\app\orders\[orderId]\page.tsx:135  const [refMap, setRefMap] = useState<Record<string, string>>({});
src\app\orders\[orderId]\page.tsx:136  const [txIdMap, setTxIdMap] = useState<Record<string, string>>({});
src\app\orders\[orderId]\page.tsx:137  const [verifyingIdx, setVerifyingIdx] = useState<string | null>(null);
src\app\orders\[orderId]\page.tsx:138  const [payingIdx, setPayingIdx] = useState<string | null>(null);
src\app\orders\[orderId]\page.tsx:145  const isCard = paymentType === "paystack_escrow";
src\app\orders\[orderId]\page.tsx:149  const installments: any[] = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\orders\[orderId]\page.tsx:165  const unsub = onAuthStateChanged(auth, async (u) => {
src\app\orders\[orderId]\page.tsx:218  // Auto-verify when redirected back from Flutterwave/Paystack for an installment
src\app\orders\[orderId]\page.tsx:222  const installmentIdxParam = sp.get("installmentIdx");
src\app\orders\[orderId]\page.tsx:226  const idxNum = installmentIdxParam != null ? Number(installmentIdxParam) : NaN;
src\app\orders\[orderId]\page.tsx:238  `/api/orders/${encodeURIComponent(orderId)}/installments/${encodeURIComponent(String(idxNum))}/paystack/verify?reference=${encodeURIComponent(
src\app\orders\[orderId]\page.tsx:245  setProofMsgMap((m) => ({ ...m, [String(idxNum)]: "Payment verified." }));
src\app\orders\[orderId]\page.tsx:261  const canDispute = o?.paymentType === "paystack_escrow" && o?.escrowStatus !== "released" && o?.escrowStatus !== "disputed";
src\app\orders\[orderId]\page.tsx:263  async function uploadInstallmentProof(idx: number) {
src\app\orders\[orderId]\page.tsx:287  `/api/public/orders/${encodeURIComponent(orderId)}/installments/${encodeURIComponent(String(idx))}/proof`,
src\app\orders\[orderId]\page.tsx:304  async function startInstallmentCardPayment(idx: number) {
src\app\orders\[orderId]\page.tsx:312  `/api/orders/${encodeURIComponent(orderId)}/installments/${encodeURIComponent(String(idx))}/paystack/init`,
src\app\orders\[orderId]\page.tsx:318  window.location.href = url;
src\app\orders\[orderId]\page.tsx:326  async function verifyInstallmentPayment(idx: number) {
src\app\orders\[orderId]\page.tsx:342  `/api/orders/${encodeURIComponent(orderId)}/installments/${encodeURIComponent(String(idx))}/paystack/verify?reference=${encodeURIComponent(
src\app\orders\[orderId]\page.tsx:347  setProofMsgMap((m) => ({ ...m, [key]: "Payment verified." }));
src\app\orders\[orderId]\page.tsx:381  <p className="text-xs opacity-95 mt-1">
src\app\orders\[orderId]\page.tsx:385  <p className="text-[11px] opacity-90 mt-2">Created: {fmtDateAny(o.createdAt)}</p>
src\app\orders\[orderId]\page.tsx:394  {/* Installments (kept, but not showing technical stuff) */}
src\app\orders\[orderId]\page.tsx:396  <SectionCard title="Installments" subtitle="Pay in parts">
src\app\orders\[orderId]\page.tsx:406  {installments.map((it: any, idx: number) => {
src\app\orders\[orderId]\page.tsx:418  {it?.label || `Installment ${idx + 1}`} ï{" "}
src\app\orders\[orderId]\page.tsx:477  <Button loading={uploadingIdx === key} disabled={uploadingIdx === key || !fileMap[key]} onClick={() => uploadInstallmentProof(idx)}>
src\app\orders\[orderId]\page.tsx:489  <Button loading={payingIdx === key} disabled={payingIdx === key} onClick={() => startInstallmentCardPayment(idx)}>
src\app\orders\[orderId]\page.tsx:490  Pay installment
src\app\orders\[orderId]\page.tsx:512  onClick={() => verifyInstallmentPayment(idx)}
src\app\orders\[orderId]\page.tsx:524  String(proofMsgMap[key]).toLowerCase().includes("verified")
src\app\orders\[orderId]\page.tsx:595  <SectionCard title="Customer" subtitle="Delivery information">
src\app\orders\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\orders\page.tsx:10  import { EmptyState } from "@/components/ui/EmptyState";
src\app\orders\page.tsx:13  import { onAuthStateChanged } from "firebase/auth";
src\app\orders\page.tsx:75  if (paymentType === "paystack_escrow") return "Card payment";
src\app\orders\page.tsx:101  const [authLoading, setAuthLoading] = useState(true);
src\app\orders\page.tsx:102  const [loggedIn, setLoggedIn] = useState(false);
src\app\orders\page.tsx:104  const [loading, setLoading] = useState(true);
src\app\orders\page.tsx:105  const [orders, setOrders] = useState<any[]>([]);
src\app\orders\page.tsx:106  const [msg, setMsg] = useState<string | null>(null);
src\app\orders\page.tsx:109  const unsub = onAuthStateChanged(auth, async (u) => {
src\app\orders\page.tsx:195  <EmptyState
src\app\orders\page.tsx:199  onCta={() => (window.location.href = "/market")}
src\app\payment\callback\page-client.tsx:4  import { Suspense, useEffect, useMemo, useState } from "react";
src\app\payment\callback\page-client.tsx:34  const [reference] = useState(initial.reference);
src\app\payment\callback\page-client.tsx:35  const [transactionId] = useState(initial.transactionId);
src\app\payment\callback\page-client.tsx:39  const [status, setStatus] = useState<"loading" | "error" | "confirmed">("loading");
src\app\payment\callback\page-client.tsx:40  const [msg, setMsg] = useState("Finalizing payment...");
src\app\payment\callback\page-client.tsx:41  const [orderId, setOrderId] = useState<string | null>(null);
src\app\payment\callback\page-client.tsx:42  const [storeSlug, setStoreSlug] = useState<string | null>(null);
src\app\payment\callback\page-client.tsx:43  const [holdUntilMs, setHoldUntilMs] = useState<number>(0);
src\app\payment\callback\page-client.tsx:56  window.history.replaceState(null, "", next);
src\app\payment\promotion\callback\page-client.tsx:6  import { Suspense, useEffect, useState } from "react";
src\app\payment\promotion\callback\page-client.tsx:18  const [status, setStatus] = useState<"loading" | "error" | "ok">("loading");
src\app\payment\promotion\callback\page-client.tsx:19  const [msg, setMsg] = useState("Confirming promotion‚Ä¶");
src\app\payment\promotion\callback\page-client.tsx:28  setMsg("Missing Paystack reference.");
src\app\payment\promotion\callback\page.tsx:4  import { Suspense, useEffect, useState } from "react";
src\app\payment\promotion\callback\page.tsx:18  const [status, setStatus] = useState<"loading" | "error" | "ok">("loading");
src\app\payment\promotion\callback\page.tsx:19  const [msg, setMsg] = useState("Confirming promotion...");
src\app\payment\subscription\callback\page-client.tsx:1  // FILE: src/app/payment/subscription/callback/page.tsx
src\app\payment\subscription\callback\page-client.tsx:6  import { Suspense, useEffect, useState } from "react";
src\app\payment\subscription\callback\page-client.tsx:14  function SubscriptionCallbackInner() {
src\app\payment\subscription\callback\page-client.tsx:18  const [status, setStatus] = useState<"loading" | "error" | "ok">("loading");
src\app\payment\subscription\callback\page-client.tsx:19  const [msg, setMsg] = useState("Confirming subscription‚Ä¶");
src\app\payment\subscription\callback\page-client.tsx:28  setMsg("Missing Paystack reference.");
src\app\payment\subscription\callback\page-client.tsx:32  const r = await fetch("/api/subscriptions/confirm", {
src\app\payment\subscription\callback\page-client.tsx:43  setMsg("Subscription activated successfully.");
src\app\payment\subscription\callback\page-client.tsx:59  <GradientHeader title="Subscription" subtitle="Payment confirmation" showBack={true} />
src\app\payment\subscription\callback\page-client.tsx:99  <Link href="/vendor/subscription" className="block">
src\app\payment\subscription\callback\page-client.tsx:109  export default function SubscriptionCallbackPage() {
src\app\payment\subscription\callback\page-client.tsx:114  <GradientHeader title="Subscription" subtitle="Payment confirmation" showBack={true} />
src\app\payment\subscription\callback\page-client.tsx:121  <SubscriptionCallbackInner />
src\app\payment\subscription\callback\page.tsx:1  // FILE: src/app/payment/subscription/callback/page.tsx
src\app\payment\subscription\callback\page.tsx:4  import { Suspense, useEffect, useState } from "react";
src\app\payment\subscription\callback\page.tsx:12  function SubscriptionCallbackInner() {
src\app\payment\subscription\callback\page.tsx:16  // Paystack: reference or trxref
src\app\payment\subscription\callback\page.tsx:20  const [status, setStatus] = useState<"loading" | "error" | "ok">("loading");
src\app\payment\subscription\callback\page.tsx:21  const [msg, setMsg] = useState("Confirming subscription...");
src\app\payment\subscription\callback\page.tsx:34  const r = await fetch("/api/subscriptions/confirm", {
src\app\payment\subscription\callback\page.tsx:45  setMsg("Subscription activated successfully.");
src\app\payment\subscription\callback\page.tsx:61  <GradientHeader title="Subscription" subtitle="Payment confirmation" showBack={true} />
src\app\payment\subscription\callback\page.tsx:101  <Link href="/vendor/subscription" className="block">
src\app\payment\subscription\callback\page.tsx:111  export default function SubscriptionCallbackPage() {
src\app\payment\subscription\callback\page.tsx:116  <GradientHeader title="Subscription" subtitle="Payment confirmation" showBack={true} />
src\app\payment\subscription\callback\page.tsx:123  <SubscriptionCallbackInner />
src\app\staff\login\login-client.tsx:3  import { useEffect, useState } from "react";
src\app\staff\login\login-client.tsx:20  const [invite, setInvite] = useState<Invite | null>(null);
src\app\staff\login\login-client.tsx:22  const [email, setEmail] = useState("");
src\app\staff\login\login-client.tsx:23  const [password, setPassword] = useState("");
src\app\staff\login\login-client.tsx:24  const [msg, setMsg] = useState<string | null>(null);
src\app\staff\login\login-client.tsx:25  const [loading, setLoading] = useState(false);
src\app\staff\login\login-client.tsx:86  const emailVerified = !!meData?.me?.emailVerified;
src\app\staff\login\login-client.tsx:88  if (!emailVerified) {
src\app\staff\login\login-client.tsx:139  className="mt-4 w-full rounded-2xl py-3 text-sm font-extrabold text-white shadow-[0_12px_30px_rgba(17,24,39,0.10)] bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-50"
src\app\staff\register\register-client.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\staff\register\register-client.tsx:38  const [invite, setInvite] = useState<Invite | null>(null);
src\app\staff\register\register-client.tsx:39  const [loading, setLoading] = useState(true);
src\app\staff\register\register-client.tsx:40  const [msg, setMsg] = useState<string | null>(null);
src\app\staff\register\register-client.tsx:42  const [password, setPassword] = useState("");
src\app\staff\register\register-client.tsx:43  const [creating, setCreating] = useState(false);
src\app\staff\register\register-client.tsx:118  // Send verification code (your app gates access until verified)
src\app\staff\register\register-client.tsx:195  className="mt-2 w-full rounded-2xl py-3 text-sm font-extrabold text-white shadow-[0_12px_30px_rgba(17,24,39,0.10)] bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-50"
src\app\vendor\analytics\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\analytics\page.tsx:22  const [loading, setLoading] = useState(true);
src\app\vendor\analytics\page.tsx:23  const [me, setMe] = useState<any>(null);
src\app\vendor\analytics\page.tsx:24  const [data, setData] = useState<any>(null);
src\app\vendor\analytics\page.tsx:25  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\analytics\page.tsx:27  const [range, setRange] = useState<RangeKey>("week");
src\app\vendor\analytics\page.tsx:33  return `${window.location.origin}/b/${slug}`;
src\app\vendor\analytics\page.tsx:85  const planKey = String(data?.meta?.access?.planKey || "FREE").toUpperCase();
src\app\vendor\analytics\page.tsx:96  paid: Number(ov.paystackOrders || 0),
src\app\vendor\analytics\page.tsx:132  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\vendor\analytics\page.tsx:152  <Button size="sm" onClick={() => (window.location.href = "/vendor/subscription")}>
src\app\vendor\analytics\page.tsx:159  {/* ? Minimal empty state */}
src\app\vendor\analytics\page.tsx:168  onClick={() => (window.location.href = "/vendor/products/new")}
src\app\vendor\analytics\page.tsx:189  <p className="text-xs opacity-95 mt-1">Store: {me?.businessSlug || "ó"}</p>
src\app\vendor\analytics\page.tsx:191  <p className="text-xs opacity-95 mt-1">Total revenue (recorded orders)</p>
src\app\vendor\analytics\page.tsx:200  <Button variant="secondary" onClick={() => (window.location.href = "/vendor/products")}>
src\app\vendor\analytics\page.tsx:224  <p className="text-xs text-gray-600">Paystack</p>
src\app\vendor\analytics\page.tsx:275  <Button size="sm" onClick={() => (window.location.href = "/vendor/subscription")}>
src\app\vendor\analytics\page.tsx:303  <Button size="sm" onClick={() => (window.location.href = "/vendor/subscription")}>
src\app\vendor\best-sellers\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\vendor\best-sellers\page.tsx:48  const [loading, setLoading] = useState(true);
src\app\vendor\best-sellers\page.tsx:49  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\best-sellers\page.tsx:51  const [meta, setMeta] = useState<any>(null);
src\app\vendor\best-sellers\page.tsx:52  const [products, setProducts] = useState<any[]>([]);
src\app\vendor\best-sellers\page.tsx:53  const [dailySeries, setDailySeries] = useState<any[]>([]);
src\app\vendor\best-sellers\page.tsx:54  const [apexInsights, setApexInsights] = useState<any>(null);
src\app\vendor\best-sellers\page.tsx:56  const [days, setDays] = useState<number>(7);
src\app\vendor\best-sellers\page.tsx:57  const [mode, setMode] = useState<MetricMode>("revenue");
src\app\vendor\best-sellers\page.tsx:97  const planKey = String(meta?.planKey || "FREE").toUpperCase();
src\app\vendor\best-sellers\page.tsx:104  const chartsUnlocked = planKey === "MOMENTUM" || planKey === "APEX";
src\app\vendor\best-sellers\page.tsx:105  const apexUnlocked = planKey === "APEX";
src\app\vendor\best-sellers\page.tsx:208  ? "Increase stock, promote it, or raise price slightly if demand is strong."
src\app\vendor\best-sellers\page.tsx:234  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\best-sellers\page.tsx:247  Plan: <b className="text-biz-ink">{planKey}</b> ï Showing up to{" "}
src\app\vendor\best-sellers\page.tsx:289  <Button size="sm" variant="secondary" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\best-sellers\page.tsx:386  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\best-sellers\page.tsx:487  Tip: promote it or restock early so you donít miss the trend.
src\app\vendor\coupon\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\coupon\page.tsx:40  const [loading, setLoading] = useState(true);
src\app\vendor\coupon\page.tsx:41  const [saving, setSaving] = useState(false);
src\app\vendor\coupon\page.tsx:42  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\coupon\page.tsx:44  const [me, setMe] = useState<any>(null);
src\app\vendor\coupon\page.tsx:45  const [coupons, setCoupons] = useState<any[]>([]);
src\app\vendor\coupon\page.tsx:48  const [code, setCode] = useState("");
src\app\vendor\coupon\page.tsx:49  const [type, setType] = useState<CouponType>("percent");
src\app\vendor\coupon\page.tsx:51  const [percent, setPercent] = useState(10);
src\app\vendor\coupon\page.tsx:52  const [amountOffNgn, setAmountOffNgn] = useState(1000);
src\app\vendor\coupon\page.tsx:54  const [minOrderNgn, setMinOrderNgn] = useState(0);
src\app\vendor\coupon\page.tsx:55  const [maxDiscountNgn, setMaxDiscountNgn] = useState(0);
src\app\vendor\coupon\page.tsx:56  const [usageLimitTotal, setUsageLimitTotal] = useState<number>(0);
src\app\vendor\coupon\page.tsx:58  const [startsAt, setStartsAt] = useState<string>("");
src\app\vendor\coupon\page.tsx:59  const [endsAt, setEndsAt] = useState<string>("");
src\app\vendor\coupon\page.tsx:61  const [active, setActive] = useState(true);
src\app\vendor\coupon\page.tsx:273  {/* ? Minimal empty state for coupons */}
src\app\vendor\customers\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\customers\page.tsx:46  const [loading, setLoading] = useState(true);
src\app\vendor\customers\page.tsx:47  const [exporting, setExporting] = useState(false);
src\app\vendor\customers\page.tsx:49  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\customers\page.tsx:50  const [meta, setMeta] = useState<any>(null);
src\app\vendor\customers\page.tsx:51  const [customers, setCustomers] = useState<any[]>([]);
src\app\vendor\customers\page.tsx:53  const [q, setQ] = useState("");
src\app\vendor\customers\page.tsx:54  const [includeContactsOptedOut, setIncludeContactsOptedOut] = useState(false);
src\app\vendor\customers\page.tsx:56  // Notes UI state
src\app\vendor\customers\page.tsx:57  const [openNotesKey, setOpenNotesKey] = useState<string | null>(null);
src\app\vendor\customers\page.tsx:58  const [savingKey, setSavingKey] = useState<string | null>(null);
src\app\vendor\customers\page.tsx:135  const planKey = String(meta?.planKey || "FREE");
src\app\vendor\customers\page.tsx:178  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\vendor\customers\page.tsx:205  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\customers\page.tsx:241  {/* ? Minimal empty state: no customers */}
src\app\vendor\customers\page.tsx:258  {/* ? Minimal empty state: no matches */}
src\app\vendor\customers\page.tsx:312  onClick={() => router.push("/vendor/subscription")}
src\app\vendor\customers\page.tsx:402  <textarea
src\app\vendor\dead-stock\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\dead-stock\page.tsx:31  planKey?: string;
src\app\vendor\dead-stock\page.tsx:32  hasActiveSubscription?: boolean;
src\app\vendor\dead-stock\page.tsx:37  export default function VendorDeadStockPage() {
src\app\vendor\dead-stock\page.tsx:40  const [loading, setLoading] = useState(true);
src\app\vendor\dead-stock\page.tsx:41  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\dead-stock\page.tsx:42  const [errCode, setErrCode] = useState<string | null>(null);
src\app\vendor\dead-stock\page.tsx:44  const [access, setAccess] = useState<AccessResp | null>(null);
src\app\vendor\dead-stock\page.tsx:46  const [meta, setMeta] = useState<any>(null);
src\app\vendor\dead-stock\page.tsx:47  const [products, setProducts] = useState<any[]>([]);
src\app\vendor\dead-stock\page.tsx:48  const [days, setDays] = useState<number>(30);
src\app\vendor\dead-stock\page.tsx:78  const data = await authedFetchJson(`/api/vendor/dead-stock?days=${encodeURIComponent(String(d))}`);
src\app\vendor\dead-stock\page.tsx:85  setMsg(e?.message || "Failed to load dead stock");
src\app\vendor\dead-stock\page.tsx:101  const planKey = String(meta?.planKey || access?.planKey || "FREE").toUpperCase();
src\app\vendor\dead-stock\page.tsx:109  isFeatureLocked && planKey === "LAUNCH"; // Launch should buy Dead Stock add-on (not forced to upgrade)
src\app\vendor\dead-stock\page.tsx:120  title="Dead stock"
src\app\vendor\dead-stock\page.tsx:138  Buy Dead Stock add-on
src\app\vendor\dead-stock\page.tsx:143  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\dead-stock\page.tsx:156  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\vendor\dead-stock\page.tsx:193  <p className="font-extrabold text-biz-ink">Top dead stock by value</p>
src\app\vendor\dead-stock\page.tsx:223  <p className="text-base font-extrabold text-biz-ink">No dead stock found</p>
src\app\vendor\dead-stock\page.tsx:225  Either products are selling recently, or they are new, or stock is zero.
src\app\vendor\dead-stock\page.tsx:240  Stock: <b className="text-biz-ink">{Number(p.stock || 0)}</b> ï Unit:{" "}
src\app\vendor\discounts\page.tsx:3  import { useEffect, useState } from "react";
src\app\vendor\discounts\page.tsx:13  const [loading, setLoading] = useState(true);
src\app\vendor\discounts\page.tsx:14  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\discounts\page.tsx:16  const [discounts, setDiscounts] = useState<any[]>([]);
src\app\vendor\discounts\page.tsx:17  const [meta, setMeta] = useState<any>(null);
src\app\vendor\discounts\page.tsx:56  const planKey = String(meta?.planKey || meta?.access?.planKey || "FREE").toUpperCase();
src\app\vendor\discounts\page.tsx:77  <Button variant="secondary" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\discounts\page.tsx:83  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\vendor\more\page.tsx:96  {/* ? SUBSCRIPTION AT TOP */}
src\app\vendor\more\page.tsx:100  title="Subscription"
src\app\vendor\more\page.tsx:102  onClick={() => router.push("/vendor/subscription")}
src\app\vendor\more\page.tsx:117  desc="Brand, location, WhatsApp, banner"
src\app\vendor\more\page.tsx:123  desc="Get verified to build buyer trust"
src\app\vendor\more\page.tsx:135  desc="Delivery and pickup options"
src\app\vendor\orders\[orderId]\dispute\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\orders\[orderId]\dispute\page.tsx:19  const [loading, setLoading] = useState(true);
src\app\vendor\orders\[orderId]\dispute\page.tsx:20  const [o, setO] = useState<any>(null);
src\app\vendor\orders\[orderId]\dispute\page.tsx:21  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\orders\[orderId]\dispute\page.tsx:23  const [reason, setReason] = useState("Buyer not responding");
src\app\vendor\orders\[orderId]\dispute\page.tsx:24  const [details, setDetails] = useState("");
src\app\vendor\orders\[orderId]\dispute\page.tsx:25  const [sending, setSending] = useState(false);
src\app\vendor\orders\[orderId]\dispute\page.tsx:28  const [evidenceUrls, setEvidenceUrls] = useState<string[]>([]);
src\app\vendor\orders\[orderId]\dispute\page.tsx:31  const [apexPriorityEnabled, setApexPriorityEnabled] = useState(false);
src\app\vendor\orders\[orderId]\dispute\page.tsx:32  const [timelineText, setTimelineText] = useState("");
src\app\vendor\orders\[orderId]\dispute\page.tsx:33  const [voiceNoteUrl, setVoiceNoteUrl] = useState("");
src\app\vendor\orders\[orderId]\dispute\page.tsx:34  const [screenshotUrls, setScreenshotUrls] = useState<string[]>([]);
src\app\vendor\orders\[orderId]\dispute\page.tsx:35  const [requestFreezeCustomer, setRequestFreezeCustomer] = useState(false);
src\app\vendor\orders\[orderId]\dispute\page.tsx:37  // Momentum add-on: priority dispute review (queue boost only)
src\app\vendor\orders\[orderId]\dispute\page.tsx:38  const [priorityReviewEnabled, setPriorityReviewEnabled] = useState(false);
src\app\vendor\orders\[orderId]\dispute\page.tsx:39  const [planKey, setPlanKey] = useState<string>("FREE");
src\app\vendor\orders\[orderId]\dispute\page.tsx:81  const pk = String(accessData?.planKey || "FREE").toUpperCase();
src\app\vendor\orders\[orderId]\dispute\page.tsx:82  setPlanKey(pk);
src\app\vendor\orders\[orderId]\dispute\page.tsx:90  const pr = pk === "MOMENTUM" && addonActive(ent, "addon_priority_dispute_review");
src\app\vendor\orders\[orderId]\dispute\page.tsx:91  setPriorityReviewEnabled(!!pr);
src\app\vendor\orders\[orderId]\dispute\page.tsx:155  const showBuyPriorityReview = planKey === "MOMENTUM" && !priorityReviewEnabled;
src\app\vendor\orders\[orderId]\dispute\page.tsx:197  {priorityReviewEnabled ? (
src\app\vendor\orders\[orderId]\dispute\page.tsx:204  <p className="text-sm font-extrabold text-biz-ink">Priority dispute review</p>
src\app\vendor\orders\[orderId]\dispute\page.tsx:211  ) : showBuyPriorityReview ? (
src\app\vendor\orders\[orderId]\dispute\page.tsx:213  <p className="text-sm font-extrabold text-biz-ink">Want faster dispute review?</p>
src\app\vendor\orders\[orderId]\dispute\page.tsx:215  Buy <b className="text-biz-ink">Priority dispute review</b> to boost your dispute queue (Momentum add-on).
src\app\vendor\orders\[orderId]\dispute\page.tsx:219  Buy Priority dispute review
src\app\vendor\orders\[orderId]\dispute\page.tsx:234  <option>Delivery failed</option>
src\app\vendor\orders\[orderId]\dispute\page.tsx:238  <textarea
src\app\vendor\orders\[orderId]\dispute\page.tsx:240  placeholder="Explain what happenedÖ (timeline, chats, delivery attempt, proof)"
src\app\vendor\orders\[orderId]\dispute\page.tsx:267  <textarea
src\app\vendor\orders\[orderId]\dispute\page.tsx:269  placeholder={`Example:\n- 10 Jan: Customer paid\n- 11 Jan: Shipped\n- 12 Jan: Delivery attempt\n- 13 Jan: Customer stopped replying`}
src\app\vendor\orders\[orderId]\dispute\page.tsx:310  Admin can temporarily freeze the customer while reviewing this case.
src\app\vendor\orders\[orderId]\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\orders\[orderId]\page.tsx:119  const [loading, setLoading] = useState(true);
src\app\vendor\orders\[orderId]\page.tsx:120  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\orders\[orderId]\page.tsx:122  const [meta, setMeta] = useState<any>(null);
src\app\vendor\orders\[orderId]\page.tsx:123  const [o, setO] = useState<any>(null);
src\app\vendor\orders\[orderId]\page.tsx:125  const [notes, setNotes] = useState<any[]>([]);
src\app\vendor\orders\[orderId]\page.tsx:126  const [noteText, setNoteText] = useState("");
src\app\vendor\orders\[orderId]\page.tsx:127  const [savingNote, setSavingNote] = useState(false);
src\app\vendor\orders\[orderId]\page.tsx:129  const [savingStatus, setSavingStatus] = useState(false);
src\app\vendor\orders\[orderId]\page.tsx:131  // Single transfer proof review (whole order)
src\app\vendor\orders\[orderId]\page.tsx:132  const [reviewing, setReviewing] = useState(false);
src\app\vendor\orders\[orderId]\page.tsx:133  const [rejectReason, setRejectReason] = useState("");
src\app\vendor\orders\[orderId]\page.tsx:135  // Installment plan
src\app\vendor\orders\[orderId]\page.tsx:136  const [planDraft, setPlanDraft] = useState<any[]>([]);
src\app\vendor\orders\[orderId]\page.tsx:137  const [savingPlan, setSavingPlan] = useState(false);
src\app\vendor\orders\[orderId]\page.tsx:138  const [planMsg, setPlanMsg] = useState<string | null>(null);
src\app\vendor\orders\[orderId]\page.tsx:140  // Installment review (bank transfer installments)
src\app\vendor\orders\[orderId]\page.tsx:141  const [reviewingInstallment, setReviewingInstallment] = useState<string | null>(null);
src\app\vendor\orders\[orderId]\page.tsx:142  const [rejectReasonMap, setRejectReasonMap] = useState<Record<string, string>>({});
src\app\vendor\orders\[orderId]\page.tsx:145  const [followUpText, setFollowUpText] = useState("");
src\app\vendor\orders\[orderId]\page.tsx:146  const [sendingFollowUp, setSendingFollowUp] = useState(false);
src\app\vendor\orders\[orderId]\page.tsx:147  const [tick, setTick] = useState(0);
src\app\vendor\orders\[orderId]\page.tsx:149  const [followUpLimitInfo, setFollowUpLimitInfo] = useState<any>(null);
src\app\vendor\orders\[orderId]\page.tsx:161  const installmentPlansUnlocked = !!meta?.limits?.installmentPlansUnlocked;
src\app\vendor\orders\[orderId]\page.tsx:163  const vendorPlanKey = String(meta?.planKey || "FREE").toUpperCase();
src\app\vendor\orders\[orderId]\page.tsx:164  const showInstallmentBuyAddon = !installmentPlansUnlocked && (vendorPlanKey === "LAUNCH" || vendorPlanKey === "MOMENTUM");
src\app\vendor\orders\[orderId]\page.tsx:165  const installmentAddonTitle =
src\app\vendor\orders\[orderId]\page.tsx:166  vendorPlanKey === "LAUNCH"
src\app\vendor\orders\[orderId]\page.tsx:167  ? "Buy Installment plans (basic)"
src\app\vendor\orders\[orderId]\page.tsx:168  : vendorPlanKey === "MOMENTUM"
src\app\vendor\orders\[orderId]\page.tsx:169  ? "Buy Installment plans (advanced)"
src\app\vendor\orders\[orderId]\page.tsx:171  const installmentRulesHint =
src\app\vendor\orders\[orderId]\page.tsx:172  vendorPlanKey === "LAUNCH"
src\app\vendor\orders\[orderId]\page.tsx:173  ? "Launch basic: max 2 installments ï max 30 days."
src\app\vendor\orders\[orderId]\page.tsx:174  : vendorPlanKey === "MOMENTUM"
src\app\vendor\orders\[orderId]\page.tsx:175  ? "Momentum advanced: max 4 installments ï max 90 days."
src\app\vendor\orders\[orderId]\page.tsx:176  : vendorPlanKey === "APEX"
src\app\vendor\orders\[orderId]\page.tsx:178  : "Upgrade to unlock installment plans.";
src\app\vendor\orders\[orderId]\page.tsx:190  const isPaystack = paymentType === "paystack_escrow";
src\app\vendor\orders\[orderId]\page.tsx:194  const planInstallments: any[] = Array.isArray(plan?.installments) ? plan.installments : [];
src\app\vendor\orders\[orderId]\page.tsx:265  { label: "Installment 1", amountKobo: 0, dueAtMs: 0 },
src\app\vendor\orders\[orderId]\page.tsx:266  { label: "Installment 2", amountKobo: 0, dueAtMs: 0 },
src\app\vendor\orders\[orderId]\page.tsx:339  async function reviewProof(action: "accept" | "reject") {
src\app\vendor\orders\[orderId]\page.tsx:343  setReviewing(true);
src\app\vendor\orders\[orderId]\page.tsx:346  await authedFetch(`/api/vendor/orders/${encodeURIComponent(orderId)}/transfer-proof/review`, {
src\app\vendor\orders\[orderId]\page.tsx:358  setMsg(e?.message || "Failed to review proof");
src\app\vendor\orders\[orderId]\page.tsx:360  setReviewing(false);
src\app\vendor\orders\[orderId]\page.tsx:365  if (!installmentPlansUnlocked) return;
src\app\vendor\orders\[orderId]\page.tsx:372  installments: (planDraft || []).map((x: any, idx: number) => ({
src\app\vendor\orders\[orderId]\page.tsx:373  label: String(x?.label || `Installment ${idx + 1}`),
src\app\vendor\orders\[orderId]\page.tsx:385  setPlanMsg("Installment plan saved.");
src\app\vendor\orders\[orderId]\page.tsx:395  if (!installmentPlansUnlocked) return;
src\app\vendor\orders\[orderId]\page.tsx:397  const ok = confirm("Clear this installment plan? Use only if no payment has been made yet.");
src\app\vendor\orders\[orderId]\page.tsx:419  async function reviewInstallment(idx: number, action: "accept" | "reject") {
src\app\vendor\orders\[orderId]\page.tsx:420  setReviewingInstallment(String(idx));
src\app\vendor\orders\[orderId]\page.tsx:424  await authedFetch(`/api/vendor/orders/${encodeURIComponent(orderId)}/installments/${idx}/review`, {
src\app\vendor\orders\[orderId]\page.tsx:435  setMsg(action === "accept" ? `Installment ${idx + 1} accepted.` : `Installment ${idx + 1} rejected.`);
src\app\vendor\orders\[orderId]\page.tsx:437  setMsg(e?.message || "Failed to review installment");
src\app\vendor\orders\[orderId]\page.tsx:439  setReviewingInstallment(null);
src\app\vendor\orders\[orderId]\page.tsx:455  <p className="text-[11px] text-biz-muted mt-1">{title || "Increase your follow-up capacity."}</p>
src\app\vendor\orders\[orderId]\page.tsx:543  <p className="text-xs opacity-95">Amount</p>
src\app\vendor\orders\[orderId]\page.tsx:545  <p className="text-xs opacity-95 mt-1">
src\app\vendor\orders\[orderId]\page.tsx:548  <p className="text-[11px] opacity-90 mt-2">Created: {fmtDate(o?.createdAt)}</p>
src\app\vendor\orders\[orderId]\page.tsx:551  <p className="text-[11px] opacity-95 mt-2">
src\app\vendor\orders\[orderId]\page.tsx:601  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\orders\[orderId]\page.tsx:631  <textarea
src\app\vendor\orders\[orderId]\page.tsx:655  <SectionCard title="Installment plan" subtitle="Split payment into parts">
src\app\vendor\orders\[orderId]\page.tsx:656  {!installmentPlansUnlocked ? (
src\app\vendor\orders\[orderId]\page.tsx:660  {showInstallmentBuyAddon
src\app\vendor\orders\[orderId]\page.tsx:661  ? "Installment plans are not included on your plan by default. Buy the add-on to unlock it."
src\app\vendor\orders\[orderId]\page.tsx:662  : "Upgrade your plan to unlock installment plans."}
src\app\vendor\orders\[orderId]\page.tsx:664  <p className="text-[11px] text-gray-500 mt-2">{installmentRulesHint}</p>
src\app\vendor\orders\[orderId]\page.tsx:667  {showInstallmentBuyAddon ? (
src\app\vendor\orders\[orderId]\page.tsx:669  {installmentAddonTitle}
src\app\vendor\orders\[orderId]\page.tsx:673  <Button size="sm" variant="secondary" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\orders\[orderId]\page.tsx:690  <p className="text-[11px] text-gray-500 mt-2">{installmentRulesHint}</p>
src\app\vendor\orders\[orderId]\page.tsx:712  {planInstallments.map((it, idx) => {
src\app\vendor\orders\[orderId]\page.tsx:724  {it?.label || `Installment ${idx + 1}`} ï{" "}
src\app\vendor\orders\[orderId]\page.tsx:770  <textarea
src\app\vendor\orders\[orderId]\page.tsx:784  loading={reviewingInstallment === String(idx)}
src\app\vendor\orders\[orderId]\page.tsx:785  disabled={reviewingInstallment === String(idx)}
src\app\vendor\orders\[orderId]\page.tsx:786  onClick={() => reviewInstallment(idx, "reject")}
src\app\vendor\orders\[orderId]\page.tsx:791  loading={reviewingInstallment === String(idx)}
src\app\vendor\orders\[orderId]\page.tsx:792  disabled={reviewingInstallment === String(idx)}
src\app\vendor\orders\[orderId]\page.tsx:793  onClick={() => reviewInstallment(idx, "accept")}
src\app\vendor\orders\[orderId]\page.tsx:804  {isPaystack ? (
src\app\vendor\orders\[orderId]\page.tsx:806  Paystack installments will show as <b>paid</b> after verification.
src\app\vendor\orders\[orderId]\page.tsx:819  Add installment amounts and due dates. The total must match the order total exactly.
src\app\vendor\orders\[orderId]\page.tsx:821  <p className="text-[11px] text-gray-500 mt-2">{installmentRulesHint}</p>
src\app\vendor\orders\[orderId]\page.tsx:836  <p className="text-sm font-bold text-biz-ink">Installment {idx + 1}</p>
src\app\vendor\orders\[orderId]\page.tsx:898  { label: `Installment ${(prev || []).length + 1}`, amountKobo: 0, dueAtMs: 0 },
src\app\vendor\orders\[orderId]\page.tsx:903  Add installment
src\app\vendor\orders\[orderId]\page.tsx:913  At least 2 installments, all due dates set, and the sum equals the order total.
src\app\vendor\orders\[orderId]\page.tsx:943  <p className="text-[11px] text-biz-muted mt-1">Upgrade to enable proof-of-payment upload and review.</p>
src\app\vendor\orders\[orderId]\page.tsx:945  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\orders\[orderId]\page.tsx:983  {tp.reviewedAtMs ? (
src\app\vendor\orders\[orderId]\page.tsx:985  Reviewed: <b className="text-biz-ink">{fmtDateMs(Number(tp.reviewedAtMs || 0))}</b>
src\app\vendor\orders\[orderId]\page.tsx:1017  <textarea
src\app\vendor\orders\[orderId]\page.tsx:1027  <Button variant="secondary" loading={reviewing} disabled={reviewing} onClick={() => reviewProof("reject")}>
src\app\vendor\orders\[orderId]\page.tsx:1030  <Button loading={reviewing} disabled={reviewing} onClick={() => reviewProof("accept")}>
src\app\vendor\orders\[orderId]\page.tsx:1040  <SectionCard title="Bank transfer proof" subtitle="Installments active">
src\app\vendor\orders\[orderId]\page.tsx:1042  <p className="text-sm font-bold text-biz-ink">Installment plan is active</p>
src\app\vendor\orders\[orderId]\page.tsx:1044  Proof is collected and reviewed per installment (see installment list above).
src\app\vendor\orders\[orderId]\page.tsx:1056  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\orders\[orderId]\page.tsx:1074  Payment state still exists separately (escrow/transfer/installments). This is the operational progress.
src\app\vendor\orders\[orderId]\page.tsx:1084  <Button size="sm" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\orders\[orderId]\page.tsx:1091  <textarea
src\app\vendor\orders\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\vendor\orders\page.tsx:87  const [loading, setLoading] = useState(true);
src\app\vendor\orders\page.tsx:88  const [exporting, setExporting] = useState(false);
src\app\vendor\orders\page.tsx:90  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\orders\page.tsx:91  const [orders, setOrders] = useState<any[]>([]);
src\app\vendor\orders\page.tsx:92  const [meta, setMeta] = useState<any>(null);
src\app\vendor\orders\page.tsx:94  const [me, setMe] = useState<any>(null);
src\app\vendor\orders\page.tsx:100  return `${window.location.origin}/b/${slug}`;
src\app\vendor\orders\page.tsx:208  const planKey = String(meta?.planKey || "FREE");
src\app\vendor\orders\page.tsx:248  Plan: <b className="text-biz-ink">{planKey}</b> ï Showing up to <b className="text-biz-ink">{cap}</b> orders
src\app\vendor\preferences\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\preferences\page.tsx:37  const raw = localStorage.getItem(KEY);
src\app\vendor\preferences\page.tsx:58  localStorage.setItem(KEY, JSON.stringify(p));
src\app\vendor\preferences\page.tsx:99  const [prefs, setPrefs] = useState<VendorPrefs>(() => loadPrefs());
src\app\vendor\preferences\page.tsx:100  const [saving, setSaving] = useState(false);
src\app\vendor\products\new\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\products\new\page.tsx:17  const PACKAGING = ["Box", "Nylon", "Bottle", "Plate", "Wrap", "Carton", "Sachet", "Bag", "Other"] as const;
src\app\vendor\products\new\page.tsx:61  const [name, setName] = useState("");
src\app\vendor\products\new\page.tsx:62  const [description, setDescription] = useState("");
src\app\vendor\products\new\page.tsx:64  const [priceText, setPriceText] = useState<string>("");
src\app\vendor\products\new\page.tsx:65  const [stockText, setStockText] = useState<string>("");
src\app\vendor\products\new\page.tsx:67  const [packagingChoice, setPackagingChoice] = useState<string>("Box");
src\app\vendor\products\new\page.tsx:68  const [packagingOther, setPackagingOther] = useState<string>("");
src\app\vendor\products\new\page.tsx:70  const [images, setImages] = useState<string[]>([]);
src\app\vendor\products\new\page.tsx:71  const [optionGroups, setOptionGroups] = useState<OptionGroup[]>([]);
src\app\vendor\products\new\page.tsx:73  const [coverAspect, setCoverAspect] = useState<CoverAspectKey>("1:1");
src\app\vendor\products\new\page.tsx:75  const [categoryKeys, setCategoryKeys] = useState<MarketCategoryKey[]>([]);
src\app\vendor\products\new\page.tsx:76  const [categoriesTouched, setCategoriesTouched] = useState(false);
src\app\vendor\products\new\page.tsx:77  const [catMsg, setCatMsg] = useState<string | null>(null);
src\app\vendor\products\new\page.tsx:78  const [colorsCsv, setColorsCsv] = useState("");
src\app\vendor\products\new\page.tsx:79  const [sizesCsv, setSizesCsv] = useState("");
src\app\vendor\products\new\page.tsx:81  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\products\new\page.tsx:82  const [locked, setLocked] = useState(false);
src\app\vendor\products\new\page.tsx:83  const [loading, setLoading] = useState(false);
src\app\vendor\products\new\page.tsx:86  const stock = useMemo(() => parseNumberText(stockText), [stockText]);
src\app\vendor\products\new\page.tsx:90  const raw = sessionStorage.getItem(DRAFT_KEY);
src\app\vendor\products\new\page.tsx:97  if (typeof d?.stockText === "string") setStockText(d.stockText);
src\app\vendor\products\new\page.tsx:108  if (typeof d?.colorsCsv === "string") setColorsCsv(d.colorsCsv);
src\app\vendor\products\new\page.tsx:109  if (typeof d?.sizesCsv === "string") setSizesCsv(d.sizesCsv);
src\app\vendor\products\new\page.tsx:116  sessionStorage.setItem(
src\app\vendor\products\new\page.tsx:122  stockText,
src\app\vendor\products\new\page.tsx:130  colorsCsv,
src\app\vendor\products\new\page.tsx:131  sizesCsv,
src\app\vendor\products\new\page.tsx:143  stockText,
src\app\vendor\products\new\page.tsx:151  colorsCsv,
src\app\vendor\products\new\page.tsx:152  sizesCsv,
src\app\vendor\products\new\page.tsx:214  stock: Number(stock || 0),
src\app\vendor\products\new\page.tsx:222  colorsCsv,
src\app\vendor\products\new\page.tsx:223  sizesCsv,
src\app\vendor\products\new\page.tsx:237  sessionStorage.removeItem(DRAFT_KEY);
src\app\vendor\products\new\page.tsx:263  <Button onClick={() => router.push("/vendor/subscription")}>Upgrade</Button>
src\app\vendor\products\new\page.tsx:275  <textarea
src\app\vendor\products\new\page.tsx:276  className="w-full border border-biz-line rounded-2xl p-3 text-sm outline-none focus:ring-2 focus:ring-biz-accent/30 focus:border-biz-accent/40 disabled:opacity-50"
src\app\vendor\products\new\page.tsx:284  <div className="relative">
src\app\vendor\products\new\page.tsx:285  <span className="absolute left-4 top-1/2 -translate-y-1/2 text-sm font-extrabold text-biz-muted pointer-events-none">
src\app\vendor\products\new\page.tsx:289  className="w-full border border-biz-line rounded-2xl p-3 pl-9 text-sm outline-none focus:ring-2 focus:ring-biz-accent/30 focus:border-biz-accent/40 disabled:opacity-50"
src\app\vendor\products\new\page.tsx:299  placeholder="Stock (optional)"
src\app\vendor\products\new\page.tsx:301  value={stockText}
src\app\vendor\products\new\page.tsx:302  onChange={(e) => setStockText(formatNumberText(e.target.value))}
src\app\vendor\products\new\page.tsx:310  className="mt-2 w-full border border-biz-line rounded-2xl p-3 text-sm bg-white disabled:opacity-50"
src\app\vendor\products\new\page.tsx:334  Preview: <b className="text-biz-ink">{fmtNaira(price)}</b> ï Stock: <b className="text-biz-ink">{stockText || "ó"}</b> ï
src\app\vendor\products\new\page.tsx:358  placeholder="Colors (comma separated) e.g. black, red, white"
src\app\vendor\products\new\page.tsx:359  value={colorsCsv}
src\app\vendor\products\new\page.tsx:360  onChange={(e) => setColorsCsv(e.target.value)}
src\app\vendor\products\new\page.tsx:364  placeholder="Sizes (comma separated) e.g. 40, 41, L, XL"
src\app\vendor\products\new\page.tsx:365  value={sizesCsv}
src\app\vendor\products\new\page.tsx:366  onChange={(e) => setSizesCsv(e.target.value)}
src\app\vendor\products\new\page.tsx:372  Colors and sizes help buyers filter search results. They don't affect stock or pricing.
src\app\vendor\products\[productId]\edit\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\vendor\products\[productId]\edit\page.tsx:17  const PACKAGING = ["Box", "Nylon", "Bottle", "Plate", "Wrap", "Carton", "Sachet", "Bag", "Other"] as const;
src\app\vendor\products\[productId]\edit\page.tsx:56  const [loading, setLoading] = useState(true);
src\app\vendor\products\[productId]\edit\page.tsx:57  const [saving, setSaving] = useState(false);
src\app\vendor\products\[productId]\edit\page.tsx:58  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\products\[productId]\edit\page.tsx:60  const [name, setName] = useState("");
src\app\vendor\products\[productId]\edit\page.tsx:61  const [description, setDescription] = useState("");
src\app\vendor\products\[productId]\edit\page.tsx:63  const [priceText, setPriceText] = useState<string>("");
src\app\vendor\products\[productId]\edit\page.tsx:64  const [stockText, setStockText] = useState<string>("");
src\app\vendor\products\[productId]\edit\page.tsx:66  const [packagingChoice, setPackagingChoice] = useState<string>("Box");
src\app\vendor\products\[productId]\edit\page.tsx:67  const [packagingOther, setPackagingOther] = useState<string>("");
src\app\vendor\products\[productId]\edit\page.tsx:69  const [images, setImages] = useState<string[]>([]);
src\app\vendor\products\[productId]\edit\page.tsx:70  const [optionGroups, setOptionGroups] = useState<OptionGroup[]>([]);
src\app\vendor\products\[productId]\edit\page.tsx:71  const [marketEnabled, setMarketEnabled] = useState(true);
src\app\vendor\products\[productId]\edit\page.tsx:74  const [coverAspect, setCoverAspect] = useState<CoverAspectKey>("1:1");
src\app\vendor\products\[productId]\edit\page.tsx:76  // categories + attrs
src\app\vendor\products\[productId]\edit\page.tsx:77  const [categoryKeys, setCategoryKeys] = useState<MarketCategoryKey[]>([]);
src\app\vendor\products\[productId]\edit\page.tsx:78  const [catMsg, setCatMsg] = useState<string | null>(null);
src\app\vendor\products\[productId]\edit\page.tsx:79  const [colorsCsv, setColorsCsv] = useState("");
src\app\vendor\products\[productId]\edit\page.tsx:80  const [sizesCsv, setSizesCsv] = useState("");
src\app\vendor\products\[productId]\edit\page.tsx:83  const stock = useMemo(() => parseNumberText(stockText), [stockText]);
src\app\vendor\products\[productId]\edit\page.tsx:142  const loadedStock = Number(p?.stock ?? 0);
src\app\vendor\products\[productId]\edit\page.tsx:143  setStockText(loadedStock >= 0 ? loadedStock.toLocaleString("en-NG") : "");
src\app\vendor\products\[productId]\edit\page.tsx:164  const colors = Array.isArray(p?.attrs?.colors) ? p.attrs.colors : [];
src\app\vendor\products\[productId]\edit\page.tsx:165  const sizes = Array.isArray(p?.attrs?.sizes) ? p.attrs.sizes : [];
src\app\vendor\products\[productId]\edit\page.tsx:166  setColorsCsv(colors.join(", "));
src\app\vendor\products\[productId]\edit\page.tsx:167  setSizesCsv(sizes.join(", "));
src\app\vendor\products\[productId]\edit\page.tsx:192  stock,
src\app\vendor\products\[productId]\edit\page.tsx:200  colorsCsv,
src\app\vendor\products\[productId]\edit\page.tsx:201  sizesCsv,
src\app\vendor\products\[productId]\edit\page.tsx:248  <textarea
src\app\vendor\products\[productId]\edit\page.tsx:256  <div className="relative">
src\app\vendor\products\[productId]\edit\page.tsx:257  <span className="absolute left-4 top-1/2 -translate-y-1/2 text-sm font-extrabold text-biz-muted">?</span>
src\app\vendor\products\[productId]\edit\page.tsx:269  placeholder="Stock"
src\app\vendor\products\[productId]\edit\page.tsx:271  value={stockText}
src\app\vendor\products\[productId]\edit\page.tsx:272  onChange={(e) => setStockText(formatNumberText(e.target.value))}
src\app\vendor\products\[productId]\edit\page.tsx:321  Preview: <b className="text-biz-ink">{fmtNaira(price)}</b> ï Stock:{" "}
src\app\vendor\products\[productId]\edit\page.tsx:322  <b className="text-biz-ink">{stockText || "ó"}</b> ï Packaging:{" "}
src\app\vendor\products\[productId]\edit\page.tsx:346  placeholder="Colors (comma separated) e.g. black, red, white"
src\app\vendor\products\[productId]\edit\page.tsx:347  value={colorsCsv}
src\app\vendor\products\[productId]\edit\page.tsx:348  onChange={(e) => setColorsCsv(e.target.value)}
src\app\vendor\products\[productId]\edit\page.tsx:352  placeholder="Sizes (comma separated) e.g. 40, 41, L, XL"
src\app\vendor\products\[productId]\edit\page.tsx:353  value={sizesCsv}
src\app\vendor\products\[productId]\edit\page.tsx:354  onChange={(e) => setSizesCsv(e.target.value)}
src\app\vendor\products\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\products\page.tsx:47  const origin = typeof window !== "undefined" ? window.location.origin : "";
src\app\vendor\products\page.tsx:62  planKey?: string;
src\app\vendor\products\page.tsx:77  const [items, setItems] = useState<any[]>([]);
src\app\vendor\products\page.tsx:78  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\products\page.tsx:80  const [loading, setLoading] = useState(false);
src\app\vendor\products\page.tsx:82  const [q, setQ] = useState("");
src\app\vendor\products\page.tsx:84  const [access, setAccess] = useState<Access | null>(null);
src\app\vendor\products\page.tsx:85  const [planKey, setPlanKey] = useState<string>("ó");
src\app\vendor\products\page.tsx:86  const [features, setFeatures] = useState<any>(null);
src\app\vendor\products\page.tsx:88  const [prodError, setProdError] = useState<string | null>(null);
src\app\vendor\products\page.tsx:89  const [prodStatus, setProdStatus] = useState<number | null>(null);
src\app\vendor\products\page.tsx:91  const [shareOpen, setShareOpen] = useState(false);
src\app\vendor\products\page.tsx:92  const [shareText, setShareText] = useState("");
src\app\vendor\products\page.tsx:93  const [shareTitle, setShareTitle] = useState("");
src\app\vendor\products\page.tsx:122  setPlanKey(String(pData?.planKey || "FREE").toUpperCase());
src\app\vendor\products\page.tsx:212  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\vendor\products\page.tsx:243  <Button onClick={() => router.push("/vendor/subscription")}>Upgrade</Button>
src\app\vendor\products\page.tsx:249  Plan: <b className="text-biz-ink">{planKey}</b>
src\app\vendor\products\page.tsx:282  {/* ? Minimal empty state: no products */}
src\app\vendor\products\page.tsx:305  {/* ? Minimal empty state: no matches */}
src\app\vendor\products\page.tsx:348  {isService ? "Service" : fmtNaira(p?.price || 0)} ï Stock: <b>{Number(p?.stock ?? 0)}</b>
src\app\vendor\products\page.tsx:382  <textarea
src\app\vendor\promote\faq\chat\page.tsx:3  import { useEffect, useMemo, useRef, useState } from "react";
src\app\vendor\promote\faq\chat\page.tsx:27  const [msgs, setMsgs] = useState<ChatMsg[]>([
src\app\vendor\promote\faq\chat\page.tsx:31  const [text, setText] = useState("");
src\app\vendor\promote\faq\chat\page.tsx:32  const [busy, setBusy] = useState(false);
src\app\vendor\promote\faq\chat\page.tsx:33  const [err, setErr] = useState<string | null>(null);
src\app\vendor\promote\faq\page.tsx:3  import { useMemo, useState } from "react";
src\app\vendor\promote\faq\page.tsx:16  | "subscription"
src\app\vendor\promote\faq\page.tsx:43  const [open, setOpen] = useState(false);
src\app\vendor\promote\faq\page.tsx:66  const [topic, setTopic] = useState<TopicKey>("getting_started");
src\app\vendor\promote\faq\page.tsx:79  subtitle: "Add, edit, stock, photos, variations",
src\app\vendor\promote\faq\page.tsx:84  subtitle: "Order status, delivery, cancellations, disputes",
src\app\vendor\promote\faq\page.tsx:97  key: "subscription",
src\app\vendor\promote\faq\page.tsx:128  a: "Check these:\n- Your products have photos and a price\n- Your product is not out of stock\n- Your marketplace setting is ON (if you want it in the Marketplace)\n\nIf it still doesn't show, contact support and tell us your store name.",
src\app\vendor\promote\faq\page.tsx:132  a: "Best order:\n1. Add 5ñ10 products with clear photos\n2. Set correct price and stock\n3. Add your WhatsApp number in store settings\n4. Share your store link with your customers",
src\app\vendor\promote\faq\page.tsx:146  q: "Why is my product showing 'out of stock'?",
src\app\vendor\promote\faq\page.tsx:147  a: "That means the stock number is 0.\n\nUpdate the stock in the product editor, then save.",
src\app\vendor\promote\faq\page.tsx:151  a: "Use clear product names (e.g., \"Men's Black Sneakers Size 42\" instead of \"Item 123\").\n\nAdd categories and colors/sizes if applicable. This helps buyers find you faster.",
src\app\vendor\promote\faq\page.tsx:166  a: "If there's an issue, a dispute can be opened so the order can be reviewed fairly.\n\nAlways keep your proof (chat screenshots, receipts, delivery updates). This helps resolve disputes faster.",
src\app\vendor\promote\faq\page.tsx:170  a: "Best practice:\n1. Confirm the order details (items, price, delivery)\n2. Message the customer on WhatsApp to confirm\n3. Update order status as you progress (contacted ? paid ? in transit ? delivered)\n4. Keep the customer updated",
src\app\vendor\promote\faq\page.tsx:181  a: "Most international cards work.\n\nSometimes a bank blocks online payments. The customer should enable online/international payments in their banking app.",
src\app\vendor\promote\faq\page.tsx:185  a: "Some banks add small charges for online/international payments.\n\nThat depends on the customer's bank, not your store.",
src\app\vendor\promote\faq\page.tsx:196  a: "This can happen if:\n- Your payout details are missing or incorrect\n- There's a pending review on your account\n- Your account needs an extra verification check\n\nContact support and tell us what you see on the screen.",
src\app\vendor\promote\faq\page.tsx:204  subscription: [
src\app\vendor\promote\faq\page.tsx:214  q: "Can I cancel my subscription?",
src\app\vendor\promote\faq\page.tsx:215  a: "You can downgrade at any time, but paid subscriptions don't auto-renew (you pay per cycle).\n\nIf you don't renew, you'll drop back to Free access when your current plan expires.",
src\app\vendor\promote\faq\page.tsx:230  a: "Best tips:\n- Promote your best-selling product (the one customers already love)\n- Use a clear cover photo with good lighting\n- Use a simple product name customers understand\n- Make sure price and stock are correct before you promote",
src\app\vendor\promote\faq\page.tsx:241  a: "Top tips:\n- Clear product photos (3ñ5 photos per product)\n- Fair prices (not too high, not too low)\n- Fast responses on WhatsApp\n- Good reviews from other customers\n- Regular updates (new products, sales, promotions)",
src\app\vendor\promote\faq\page.tsx:249  a: "Best practices:\n- Deliver on time (or update customers if delayed)\n- Message customers after delivery to say thank you\n- Use re-engagement to send follow-up messages\n- Offer loyalty discounts (e.g., \"10% off your next order\")\n- Keep adding new products so they have a reason to return",
src\app\vendor\promote\faq\page.tsx:290  <Button variant="soft" disabled className="opacity-60">
src\app\vendor\promote\page-client.tsx:5  import { useEffect, useMemo, useState } from "react";
src\app\vendor\promote\page-client.tsx:50  const [tab, setTab] = useState<Tab>("setup");
src\app\vendor\promote\page-client.tsx:52  const [loading, setLoading] = useState(true);
src\app\vendor\promote\page-client.tsx:53  const [paying, setPaying] = useState(false);
src\app\vendor\promote\page-client.tsx:54  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\promote\page-client.tsx:56  const [products, setProducts] = useState<any[]>([]);
src\app\vendor\promote\page-client.tsx:57  const [selectedIds, setSelectedIds] = useState<string[]>([]);
src\app\vendor\promote\page-client.tsx:59  const [days, setDays] = useState<number>(2);
src\app\vendor\promote\page-client.tsx:60  const [dailyBudget, setDailyBudget] = useState<number>(1700);
src\app\vendor\promote\page-client.tsx:170  window.location.href = data.authorization_url;
src\app\vendor\promote\page-client.tsx:258  <p className={on ? "text-[11px] opacity-90 mt-1" : "text-[11px] text-biz-muted mt-1"}>
src\app\vendor\promote\page-client.tsx:345  <p className="text-xs opacity-95">Promotion summary</p>
src\app\vendor\promote\page-client.tsx:347  <p className="text-[11px] opacity-95 mt-2">
src\app\vendor\promote\page-client.tsx:350  <p className="text-[11px] opacity-95 mt-1">
src\app\vendor\promotions\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\promotions\page.tsx:9  import { EmptyState } from "@/components/ui/EmptyState";
src\app\vendor\promotions\page.tsx:66  const [loading, setLoading] = useState(true);
src\app\vendor\promotions\page.tsx:67  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\promotions\page.tsx:68  const [campaigns, setCampaigns] = useState<any[]>([]);
src\app\vendor\promotions\page.tsx:166  <EmptyState
src\app\vendor\purchases\callback\page-client.tsx:4  import { useEffect, useState } from "react";
src\app\vendor\purchases\callback\page-client.tsx:18  const [loading, setLoading] = useState(true);
src\app\vendor\purchases\callback\page-client.tsx:19  const [msg, setMsg] = useState<string>("Confirming purchase...");
src\app\vendor\purchases\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\purchases\page.tsx:10  type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\app\vendor\purchases\page.tsx:34  planKey: BizhubPlanKey;
src\app\vendor\purchases\page.tsx:35  subscriptionActive: boolean;
src\app\vendor\purchases\page.tsx:41  const [loading, setLoading] = useState(true);
src\app\vendor\purchases\page.tsx:42  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\purchases\page.tsx:44  const [cycle, setCycle] = useState<AddonCycle>("yearly");
src\app\vendor\purchases\page.tsx:45  const [planKey, setPlanKey] = useState<BizhubPlanKey>("FREE");
src\app\vendor\purchases\page.tsx:46  const [subscriptionActive, setSubscriptionActive] = useState(false);
src\app\vendor\purchases\page.tsx:48  const [items, setItems] = useState<CatalogItem[]>([]);
src\app\vendor\purchases\page.tsx:49  const [buyingSku, setBuyingSku] = useState<string>("");
src\app\vendor\purchases\page.tsx:67  setPlanKey(data.planKey);
src\app\vendor\purchases\page.tsx:68  setSubscriptionActive(!!data.subscriptionActive);
src\app\vendor\purchases\page.tsx:100  window.location.href = String(data.authorization_url);
src\app\vendor\purchases\page.tsx:124  <p className="text-sm font-extrabold text-biz-ink">Your plan: {planKey}</p>
src\app\vendor\purchases\page.tsx:126  Add-ons pause when your subscription expires and resume when your subscription is active again.
src\app\vendor\purchases\page.tsx:128  {!subscriptionActive ? (
src\app\vendor\purchases\page.tsx:129  <p className="mt-2 text-[11px] font-bold text-orange-700">Subscription is not active right now.</p>
src\app\vendor\reengagement\page.tsx:4  import { useEffect, useMemo, useRef, useState } from "react";
src\app\vendor\reengagement\page.tsx:20  type PlanKey,
src\app\vendor\reengagement\page.tsx:56  function cleanPlanKey(v: any): PlanKey {
src\app\vendor\reengagement\page.tsx:58  return (k === "LAUNCH" || k === "MOMENTUM" || k === "APEX" ? k : "FREE") as PlanKey;
src\app\vendor\reengagement\page.tsx:77  const [loading, setLoading] = useState(true);
src\app\vendor\reengagement\page.tsx:78  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\reengagement\page.tsx:80  const [mode, setMode] = useState<Mode>("buyers");
src\app\vendor\reengagement\page.tsx:82  const [segment, setSegment] = useState<ReengagementSegment>("buyers_all");
src\app\vendor\reengagement\page.tsx:83  const [days, setDays] = useState<number>(30);
src\app\vendor\reengagement\page.tsx:84  const [q, setQ] = useState("");
src\app\vendor\reengagement\page.tsx:86  const [people, setPeople] = useState<ReengagementPerson[]>([]);
src\app\vendor\reengagement\page.tsx:87  const [selected, setSelected] = useState<Record<string, boolean>>({});
src\app\vendor\reengagement\page.tsx:89  const [baseText, setBaseText] = useState<string>(defaultBaseFor("buyers"));
src\app\vendor\reengagement\page.tsx:91  const [planKey, setPlanKey] = useState<PlanKey>("FREE");
src\app\vendor\reengagement\page.tsx:92  const [features, setFeatures] = useState<any>(null);
src\app\vendor\reengagement\page.tsx:93  const [limits, setLimits] = useState<any>(null);
src\app\vendor\reengagement\page.tsx:94  const [businessSlug, setBusinessSlug] = useState<string>("");
src\app\vendor\reengagement\page.tsx:95  const [businessName, setBusinessName] = useState<string>("");
src\app\vendor\reengagement\page.tsx:97  const [counts, setCounts] = useState<Record<string, number>>({});
src\app\vendor\reengagement\page.tsx:99  const [rotationKey, setRotationKey] = useState<string>(() => `rot_${Date.now().toString(36)}`);
src\app\vendor\reengagement\page.tsx:101  const [autoRemixAfterCopy, setAutoRemixAfterCopy] = useState<boolean>(() => {
src\app\vendor\reengagement\page.tsx:103  const v = localStorage.getItem("bizhub_reengage_auto_remix");
src\app\vendor\reengagement\page.tsx:116  const vipAllowed = cleanPlanKey(planKey) === "APEX" && aiRemixUnlocked;
src\app\vendor\reengagement\page.tsx:118  const [sending, setSending] = useState(false);
src\app\vendor\reengagement\page.tsx:122  const [remixUsage, setRemixUsage] = useState<RemixUsage | null>(null);
src\app\vendor\reengagement\page.tsx:123  const [remixInfo, setRemixInfo] = useState<any>(null);
src\app\vendor\reengagement\page.tsx:124  const [remixing, setRemixing] = useState(false);
src\app\vendor\reengagement\page.tsx:125  const [tick, setTick] = useState(0);
src\app\vendor\reengagement\page.tsx:145  const pk = String(data?.planKey || "FREE").toUpperCase() as PlanKey;
src\app\vendor\reengagement\page.tsx:147  setPlanKey(pk);
src\app\vendor\reengagement\page.tsx:185  if (data?.meta?.planKey) setPlanKey(String(data.meta.planKey).toUpperCase() as PlanKey);
src\app\vendor\reengagement\page.tsx:293  planKey,
src\app\vendor\reengagement\page.tsx:376  const selectedPreview = useMemo(() => {
src\app\vendor\reengagement\page.tsx:381  planKey,
src\app\vendor\reengagement\page.tsx:392  }, [selectedPeople, smartMessagesOn, planKey, aiRemixUnlocked, businessSlug, businessName, seg, baseText, rotationKey]);
src\app\vendor\reengagement\page.tsx:413  <Button onClick={() => router.push("/vendor/subscription")}>Upgrade</Button>
src\app\vendor\reengagement\page.tsx:553  <textarea
src\app\vendor\reengagement\page.tsx:554  className="w-full rounded-2xl border border-biz-line bg-white px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-biz-accent/30 focus:border-biz-accent/40 disabled:opacity-50"
src\app\vendor\reengagement\page.tsx:562  {selectedPreview ? (
src\app\vendor\reengagement\page.tsx:564  <p className="text-xs font-bold text-biz-ink">Preview (first selected buyer)</p>
src\app\vendor\reengagement\page.tsx:565  <pre className="mt-2 whitespace-pre-wrap text-[12px] text-gray-800">{selectedPreview.text}</pre>
src\app\vendor\reengagement\page.tsx:570  onClick={() => copyForPerson(selectedPreview.p)}
src\app\vendor\security\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\security\page.tsx:8  import { onAuthStateChanged, sendPasswordResetEmail, signOut } from "firebase/auth";
src\app\vendor\security\page.tsx:14  me?: { email?: string | null; emailVerified?: boolean; role?: string };
src\app\vendor\security\page.tsx:28  const [loading, setLoading] = useState(true);
src\app\vendor\security\page.tsx:29  const [email, setEmail] = useState<string | null>(null);
src\app\vendor\security\page.tsx:30  const [emailVerified, setEmailVerified] = useState<boolean>(false);
src\app\vendor\security\page.tsx:31  const [role, setRole] = useState<string>("");
src\app\vendor\security\page.tsx:33  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\security\page.tsx:34  const [busy, setBusy] = useState(false);
src\app\vendor\security\page.tsx:37  const unsub = onAuthStateChanged(auth, async (u) => {
src\app\vendor\security\page.tsx:44  setEmailVerified(false);
src\app\vendor\security\page.tsx:58  setEmailVerified(!!j.me.emailVerified);
src\app\vendor\security\page.tsx:61  setEmailVerified(!!u.emailVerified);
src\app\vendor\security\page.tsx:65  setEmailVerified(!!u.emailVerified);
src\app\vendor\security\page.tsx:80  return emailVerified ? "Verified" : "Not verified";
src\app\vendor\security\page.tsx:81  }, [email, emailVerified]);
src\app\vendor\security\page.tsx:159  {!emailVerified && email ? (
src\app\vendor\settings\payouts\page.tsx:3  import { useEffect, useState } from "react";
src\app\vendor\settings\payouts\page.tsx:9  const [bankName, setBankName] = useState("");
src\app\vendor\settings\payouts\page.tsx:10  const [accountNumber, setAccountNumber] = useState("");
src\app\vendor\settings\payouts\page.tsx:11  const [accountName, setAccountName] = useState("");
src\app\vendor\settings\payouts\page.tsx:12  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\settings\payouts\page.tsx:13  const [loading, setLoading] = useState(false);
src\app\vendor\settings\payouts\page.tsx:70  <button className="mt-4 w-full rounded-2xl bg-black py-3 text-sm font-semibold text-white disabled:opacity-50" onClick={save} disabled={loading}>
src\app\vendor\shipping\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\shipping\page.tsx:13  type ShipType = "delivery" | "pickup";
src\app\vendor\shipping\page.tsx:31  const [loading, setLoading] = useState(true);
src\app\vendor\shipping\page.tsx:32  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\shipping\page.tsx:34  const [options, setOptions] = useState<any[]>([]);
src\app\vendor\shipping\page.tsx:37  const [editingId, setEditingId] = useState<string>("");
src\app\vendor\shipping\page.tsx:38  const [type, setType] = useState<ShipType>("delivery");
src\app\vendor\shipping\page.tsx:39  const [name, setName] = useState("Delivery");
src\app\vendor\shipping\page.tsx:40  const [feeNgn, setFeeNgn] = useState<number>(2000);
src\app\vendor\shipping\page.tsx:41  const [etaDays, setEtaDays] = useState<number>(2);
src\app\vendor\shipping\page.tsx:42  const [areasText, setAreasText] = useState<string>("");
src\app\vendor\shipping\page.tsx:43  const [sortOrder, setSortOrder] = useState<number>(0);
src\app\vendor\shipping\page.tsx:44  const [active, setActive] = useState(true);
src\app\vendor\shipping\page.tsx:46  const [saving, setSaving] = useState(false);
src\app\vendor\shipping\page.tsx:47  const [deletingId, setDeletingId] = useState<string>("");
src\app\vendor\shipping\page.tsx:52  if (type === "delivery" && feeNgn < 0) return true;
src\app\vendor\shipping\page.tsx:91  setType("delivery");
src\app\vendor\shipping\page.tsx:92  setName("Delivery");
src\app\vendor\shipping\page.tsx:95  setAreasText("");
src\app\vendor\shipping\page.tsx:102  setType(String(o.type || "delivery") === "pickup" ? "pickup" : "delivery");
src\app\vendor\shipping\page.tsx:103  setName(String(o.name || "Delivery"));
src\app\vendor\shipping\page.tsx:106  setAreasText(String(o.areasText || ""));
src\app\vendor\shipping\page.tsx:125  areasText: areasText.trim(),
src\app\vendor\shipping\page.tsx:165  <GradientHeader title="Shipping" subtitle="Set delivery and pickup options for checkout" showBack={true} />
src\app\vendor\shipping\page.tsx:187  { value: "delivery", label: "Delivery" },
src\app\vendor\shipping\page.tsx:192  <Input placeholder="Name (e.g. Lagos delivery)" value={name} onChange={(e) => setName(e.target.value)} />
src\app\vendor\shipping\page.tsx:213  placeholder="Areas (optional) e.g. Lekki, VI, Ajah"
src\app\vendor\shipping\page.tsx:214  value={areasText}
src\app\vendor\shipping\page.tsx:215  onChange={(e) => setAreasText(e.target.value)}
src\app\vendor\shipping\page.tsx:257  const isPickup = String(o.type || "delivery") === "pickup";
src\app\vendor\shipping\page.tsx:264  <p className="text-sm font-bold text-biz-ink">{o.name || (isPickup ? "Pickup" : "Delivery")}</p>
src\app\vendor\shipping\page.tsx:267  Type: <b className="text-biz-ink">{isPickup ? "Pickup" : "Delivery"}</b> ï Fee:{" "}
src\app\vendor\shipping\page.tsx:272  {o.areasText ? <p className="text-[11px] text-gray-500 mt-1">{String(o.areasText)}</p> : null}
src\app\vendor\staff\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\staff\page.tsx:66  disabled ? "opacity-50 cursor-not-allowed" : "hover:bg-black/[0.02]",
src\app\vendor\staff\page.tsx:100  const [loading, setLoading] = useState(true);
src\app\vendor\staff\page.tsx:101  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\staff\page.tsx:103  const [me, setMe] = useState<any>(null);
src\app\vendor\staff\page.tsx:104  const [staff, setStaff] = useState<any[]>([]);
src\app\vendor\staff\page.tsx:105  const [invites, setInvites] = useState<any[]>([]);
src\app\vendor\staff\page.tsx:106  const [seats, setSeats] = useState<any>(null);
src\app\vendor\staff\page.tsx:108  const [staffNudgesEnabled, setStaffNudgesEnabled] = useState(false);
src\app\vendor\staff\page.tsx:109  const [staffPushEnabled, setStaffPushEnabled] = useState(false);
src\app\vendor\staff\page.tsx:110  const [notifBusy, setNotifBusy] = useState(false);
src\app\vendor\staff\page.tsx:112  const [name, setName] = useState("");
src\app\vendor\staff\page.tsx:113  const [jobTitle, setJobTitle] = useState("");
src\app\vendor\staff\page.tsx:114  const [email, setEmail] = useState("");
src\app\vendor\staff\page.tsx:115  const [perms, setPerms] = useState<Perms>(DEFAULT_PERMS);
src\app\vendor\staff\page.tsx:116  const [creating, setCreating] = useState(false);
src\app\vendor\staff\page.tsx:118  const [revokingId, setRevokingId] = useState<string>("");
src\app\vendor\staff\page.tsx:119  const [removingId, setRemovingId] = useState<string>("");
src\app\vendor\staff\page.tsx:126  const planKey = String(seats?.planKey || "").toUpperCase();
src\app\vendor\staff\page.tsx:129  const showBuySeatAddon = isOwner && planKey === "LAUNCH" && seatLimit > 0 && remainingSeats <= 0;
src\app\vendor\staff\page.tsx:336  Plan: <b className="text-biz-ink">{planKey || "ó"}</b> ï Used:{" "}
src\app\vendor\staff\page.tsx:345  <Button variant="secondary" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\staff\page.tsx:457  ? planKey === "LAUNCH"
src\app\vendor\staff\page.tsx:463  {!canInvite && remainingSeats <= 0 && planKey === "LAUNCH" ? (
src\app\vendor\staff\page.tsx:499  const link = `${window.location.origin}/staff/register?code=${encodeURIComponent(inv.id)}`;
src\app\vendor\store\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\vendor\store\page.tsx:14  const [loading, setLoading] = useState(true);
src\app\vendor\store\page.tsx:15  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\store\page.tsx:16  const [saving, setSaving] = useState(false);
src\app\vendor\store\page.tsx:18  const [name, setName] = useState("");
src\app\vendor\store\page.tsx:19  const [description, setDescription] = useState("");
src\app\vendor\store\page.tsx:20  const [stateNg, setStateNg] = useState("");
src\app\vendor\store\page.tsx:21  const [city, setCity] = useState("");
src\app\vendor\store\page.tsx:22  const [whatsapp, setWhatsapp] = useState("");
src\app\vendor\store\page.tsx:23  const [instagram, setInstagram] = useState("");
src\app\vendor\store\page.tsx:25  const [logoUrl, setLogoUrl] = useState("");
src\app\vendor\store\page.tsx:26  const [bannerUrl, setBannerUrl] = useState("");
src\app\vendor\store\page.tsx:28  const [continueInChatEnabled, setContinueInChatEnabled] = useState(false);
src\app\vendor\store\page.tsx:30  const [hasActiveSubscription, setHasActiveSubscription] = useState(false);
src\app\vendor\store\page.tsx:31  const [planKey, setPlanKey] = useState<string>("FREE");
src\app\vendor\store\page.tsx:32  const [features, setFeatures] = useState<any>(null);
src\app\vendor\store\page.tsx:35  const [searchTagsCsv, setSearchTagsCsv] = useState("");
src\app\vendor\store\page.tsx:63  setStateNg(String(b?.state || ""));
src\app\vendor\store\page.tsx:64  setCity(String(b?.city || ""));
src\app\vendor\store\page.tsx:72  setHasActiveSubscription(!!accessData?.hasActiveSubscription);
src\app\vendor\store\page.tsx:73  setPlanKey(String(accessData?.planKey || "FREE"));
src\app\vendor\store\page.tsx:91  const canEnableChat = useMemo(() => hasActiveSubscription && !!features?.continueInChat, [hasActiveSubscription, features]);
src\app\vendor\store\page.tsx:104  state: stateNg,
src\app\vendor\store\page.tsx:105  city,
src\app\vendor\store\page.tsx:136  {planKey === "FREE" ? (
src\app\vendor\store\page.tsx:143  <Button onClick={() => (window.location.href = "/vendor/subscription")}>Upgrade</Button>
src\app\vendor\store\page.tsx:148  <SectionCard title="Brand" subtitle="What customers see on your storefront">
src\app\vendor\store\page.tsx:152  <textarea
src\app\vendor\store\page.tsx:172  <SectionCard title="Location (Nigeria)" subtitle="Improves trust and discovery">
src\app\vendor\store\page.tsx:174  <Input placeholder="State (e.g. Lagos)" value={stateNg} onChange={(e) => setStateNg(e.target.value)} />
src\app\vendor\store\page.tsx:175  <Input placeholder="City (e.g. Lekki)" value={city} onChange={(e) => setCity(e.target.value)} />
src\app\vendor\store\page.tsx:183  <Input placeholder="Instagram handle (e.g. mybrand)" value={instagram} onChange={(e) => setInstagram(e.target.value)} />
src\app\vendor\subscription\summary\page-client.tsx:1  // FILE: src/app/vendor/subscription/summary/page-client.tsx
src\app\vendor\subscription\summary\page-client.tsx:4  import { useEffect, useMemo, useRef, useState } from "react";
src\app\vendor\subscription\summary\page-client.tsx:14  type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\app\vendor\subscription\summary\page-client.tsx:40  function flattenGroups(groups: Record<string, string[]>) {
src\app\vendor\subscription\summary\page-client.tsx:75  BizhubPlanKey,
src\app\vendor\subscription\summary\page-client.tsx:77  key: BizhubPlanKey;
src\app\vendor\subscription\summary\page-client.tsx:94  export default function SubscriptionSummaryPageClient() {
src\app\vendor\subscription\summary\page-client.tsx:101  const planKey: BizhubPlanKey = (["FREE", "LAUNCH", "MOMENTUM", "APEX"] as BizhubPlanKey[]).includes(planFromUrl as any)
src\app\vendor\subscription\summary\page-client.tsx:102  ? (planFromUrl as BizhubPlanKey)
src\app\vendor\subscription\summary\page-client.tsx:111  const [tab, setTab] = useState<TabKey>("benefits");
src\app\vendor\subscription\summary\page-client.tsx:112  const [cycle, setCycle] = useState<BizhubBillingCycle>(initialCycle);
src\app\vendor\subscription\summary\page-client.tsx:114  const [loading, setLoading] = useState(true);
src\app\vendor\subscription\summary\page-client.tsx:115  const [paying, setPaying] = useState(false);
src\app\vendor\subscription\summary\page-client.tsx:116  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\subscription\summary\page-client.tsx:118  const [history, setHistory] = useState<any[]>([]);
src\app\vendor\subscription\summary\page-client.tsx:119  const [entitlement, setEntitlement] = useState<any>(null);
src\app\vendor\subscription\summary\page-client.tsx:120  const [plans, setPlans] = useState<PlansResponse["plans"] | null>(null);
src\app\vendor\subscription\summary\page-client.tsx:124  const plan = plans?.[planKey] || null;
src\app\vendor\subscription\summary\page-client.tsx:149  authedFetch("/api/subscriptions/my"),
src\app\vendor\subscription\summary\page-client.tsx:161  const m = niceError(e, "Could not load subscription details. Please try again.");
src\app\vendor\subscription\summary\page-client.tsx:176  const canPay = planKey !== "FREE" && price > 0;
src\app\vendor\subscription\summary\page-client.tsx:184  const data = await authedFetch("/api/subscriptions/initialize", {
src\app\vendor\subscription\summary\page-client.tsx:187  body: JSON.stringify({ planKey, cycle }),
src\app\vendor\subscription\summary\page-client.tsx:192  window.location.href = String(data.authorization_url);
src\app\vendor\subscription\summary\page-client.tsx:202  const entPlanKey = String(entitlement?.planKey || "FREE") as BizhubPlanKey;
src\app\vendor\subscription\summary\page-client.tsx:204  const entName = plans?.[entPlanKey]?.name || (entPlanKey === "FREE" ? "Free access" : entPlanKey);
src\app\vendor\subscription\summary\page-client.tsx:207  return planKey === "FREE" ? "Free access" : `${plan?.name || planKey}`;
src\app\vendor\subscription\summary\page-client.tsx:208  }, [planKey, plan?.name]);
src\app\vendor\subscription\summary\page-client.tsx:211  const flat = flattenGroups(plan?.benefits || {});
src\app\vendor\subscription\summary\page-client.tsx:212  return flat.slice(0, 4);
src\app\vendor\subscription\summary\page-client.tsx:219  subtitle="Review and pay"
src\app\vendor\subscription\summary\page-client.tsx:224  onClick={() => router.push("/vendor/subscription")}
src\app\vendor\subscription\summary\page-client.tsx:240  : entPlanKey === "FREE"
src\app\vendor\subscription\summary\page-client.tsx:249  <p className="text-xs opacity-95">Selected plan</p>
src\app\vendor\subscription\summary\page-client.tsx:251  <p className="text-[11px] opacity-95 mt-1">{plan?.tagline || ""}</p>
src\app\vendor\subscription\summary\page-client.tsx:253  <p className="text-[11px] opacity-95 mt-2">
src\app\vendor\subscription\summary\page-client.tsx:261  <p className="text-[11px] opacity-95 mt-1">{cycle}</p>
src\app\vendor\subscription\summary\page-client.tsx:269  <span className="opacity-95">{t}</span>
src\app\vendor\subscription\summary\page-client.tsx:340  <p className="text-xs text-biz-muted mt-1">Extra tools you can buy later</p>
src\app\vendor\subscription\summary\page-client.tsx:354  <p className="text-xs text-biz-muted mt-1">Your recent subscription payments</p>
src\app\vendor\subscription\summary\page-client.tsx:370  {String(h.planKey || EM_DASH)} {BULLET} {String(h.cycle || EM_DASH)}
src\app\vendor\subscription\summary\page-client.tsx:394  {planKey === "FREE" ? (
src\app\vendor\subscription\summary\page-client.tsx:395  <Button variant="secondary" onClick={() => router.push("/vendor/subscription")}>
src\app\vendor\subscription\page-client.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\subscription\page-client.tsx:12  type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\app\vendor\subscription\page-client.tsx:16  const SUMMARY_PATH = "/vendor/subscription/summary";
src\app\vendor\subscription\page-client.tsx:43  function flattenGroups(groups: Record<string, string[]>) {
src\app\vendor\subscription\page-client.tsx:71  props.disabled ? "opacity-60 cursor-not-allowed" : "",
src\app\vendor\subscription\page-client.tsx:100  BizhubPlanKey,
src\app\vendor\subscription\page-client.tsx:102  key: BizhubPlanKey;
src\app\vendor\subscription\page-client.tsx:115  export default function VendorSubscriptionPageClient() {
src\app\vendor\subscription\page-client.tsx:122  const initialPlan: BizhubPlanKey = (["LAUNCH", "MOMENTUM", "APEX"] as BizhubPlanKey[]).includes(planFromUrl as any)
src\app\vendor\subscription\page-client.tsx:123  ? (planFromUrl as BizhubPlanKey)
src\app\vendor\subscription\page-client.tsx:132  const [planKey, setPlanKey] = useState<BizhubPlanKey>(initialPlan);
src\app\vendor\subscription\page-client.tsx:133  const [cycle, setCycle] = useState<BizhubBillingCycle>(initialCycle);
src\app\vendor\subscription\page-client.tsx:134  const [tab, setTab] = useState<InfoTab>("benefits");
src\app\vendor\subscription\page-client.tsx:136  const [loading, setLoading] = useState(true);
src\app\vendor\subscription\page-client.tsx:137  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\subscription\page-client.tsx:139  const [plans, setPlans] = useState<PlansResponse["plans"] | null>(null);
src\app\vendor\subscription\page-client.tsx:140  const [entitlement, setEntitlement] = useState<any>(null);
src\app\vendor\subscription\page-client.tsx:141  const [showAll, setShowAll] = useState(false);
src\app\vendor\subscription\page-client.tsx:163  authedFetch("/api/subscriptions/my"),
src\app\vendor\subscription\page-client.tsx:185  const plan = plans?.[planKey] || null;
src\app\vendor\subscription\page-client.tsx:188  const entPlanKey = String(entitlement?.planKey || "FREE") as BizhubPlanKey;
src\app\vendor\subscription\page-client.tsx:192  plans?.[entPlanKey]?.name || (entPlanKey === "FREE" ? "Free access" : String(entPlanKey || "Free access"));
src\app\vendor\subscription\page-client.tsx:194  const benefitsFlat = useMemo(() => flattenGroups(plan?.benefits || {}), [plan]);
src\app\vendor\subscription\page-client.tsx:195  const purchasesFlat = useMemo(() => flattenGroups(plan?.purchases || {}), [plan]);
src\app\vendor\subscription\page-client.tsx:197  const activeList = tab === "benefits" ? benefitsFlat : purchasesFlat;
src\app\vendor\subscription\page-client.tsx:202  router.push(`${SUMMARY_PATH}?plan=${encodeURIComponent(planKey)}&cycle=${encodeURIComponent(cycle)}`);
src\app\vendor\subscription\page-client.tsx:207  <GradientHeader title="Subscription" subtitle="Pick a plan and continue" showBack={true} />
src\app\vendor\subscription\page-client.tsx:218  : entPlanKey === "FREE"
src\app\vendor\subscription\page-client.tsx:229  <SegmentedControl<BizhubPlanKey>
src\app\vendor\subscription\page-client.tsx:230  value={planKey}
src\app\vendor\subscription\page-client.tsx:232  setPlanKey(v);
src\app\vendor\subscription\page-client.tsx:242  <p className="text-[11px] text-biz-muted mt-2">Pay with Paystack. Instant activation after payment.</p>
src\app\vendor\verification\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\vendor\verification\page.tsx:35  const [loading, setLoading] = useState(true);
src\app\vendor\verification\page.tsx:36  const [saving, setSaving] = useState(false);
src\app\vendor\verification\page.tsx:37  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\verification\page.tsx:39  const [tier, setTier] = useState<number>(0);
src\app\vendor\verification\page.tsx:40  const [verification, setVerification] = useState<any>(null);
src\app\vendor\verification\page.tsx:41  const [trust, setTrust] = useState<any>(null);
src\app\vendor\verification\page.tsx:44  const [selfieUrls, setSelfieUrls] = useState<string[]>([]);
src\app\vendor\verification\page.tsx:47  const [idType, setIdType] = useState<IdType>("nin");
src\app\vendor\verification\page.tsx:48  const [idNumber, setIdNumber] = useState<string>("");
src\app\vendor\verification\page.tsx:51  const [proofUrls, setProofUrls] = useState<string[]>([]);
src\app\vendor\verification\page.tsx:66  setTier(Number(data.verificationTier || 0));
src\app\vendor\verification\page.tsx:125  setMsg("Tier 2 submitted. Admin review can take up to 8 hours.");
src\app\vendor\verification\page.tsx:143  setMsg("Tier 3 submitted. Admin review can take up to 8 hours.");
src\app\vendor\verification\page.tsx:167  <p className="text-xs opacity-95">Your verification</p>
src\app\vendor\verification\page.tsx:176  <p className="text-[11px] opacity-95 mt-3">{showVisibilityNote}</p>
src\app\vendor\wallet\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\wallet\page.tsx:21  const [loading, setLoading] = useState(true);
src\app\vendor\wallet\page.tsx:22  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\wallet\page.tsx:23  const [wallet, setWallet] = useState<any>(null);
src\app\vendor\wallet\page.tsx:71  {/* ? Minimal empty state */}
src\app\vendor\wallet\page.tsx:91  <p className="text-xs opacity-95">Available balance</p>
src\app\vendor\wallet\page.tsx:98  <Button variant="secondary" onClick={() => window.location.reload()}>
src\app\vendor\wallet\page.tsx:103  <p className="mt-3 text-[11px] opacity-90">
src\app\vendor\withdrawals\page.tsx:3  import { useEffect, useMemo, useState } from "react";
src\app\vendor\withdrawals\page.tsx:30  const [loading, setLoading] = useState(true);
src\app\vendor\withdrawals\page.tsx:31  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\withdrawals\page.tsx:33  const [wallet, setWallet] = useState<any>(null);
src\app\vendor\withdrawals\page.tsx:34  const [withdrawals, setWithdrawals] = useState<any[]>([]);
src\app\vendor\withdrawals\page.tsx:36  const [amountNgn, setAmountNgn] = useState<number>(1000);
src\app\vendor\withdrawals\page.tsx:37  const [sending, setSending] = useState(false);
src\app\vendor\withdrawals\page.tsx:101  <p className="text-xs opacity-95">Available</p>
src\app\vendor\withdrawals\page.tsx:103  <p className="text-[11px] opacity-95 mt-2">
src\app\vendor\page.tsx:4  import { useEffect, useMemo, useState } from "react";
src\app\vendor\page.tsx:65  const raw = localStorage.getItem(MOOD_KEY);
src\app\vendor\page.tsx:76  localStorage.setItem(MOOD_KEY, JSON.stringify(v));
src\app\vendor\page.tsx:82  const [range, setRange] = useState<Range>("week");
src\app\vendor\page.tsx:83  const [me, setMe] = useState<any>(null);
src\app\vendor\page.tsx:84  const [data, setData] = useState<any>(null);
src\app\vendor\page.tsx:85  const [access, setAccess] = useState<any>(null);
src\app\vendor\page.tsx:86  const [notice, setNotice] = useState<string | null>(null);
src\app\vendor\page.tsx:88  const [assistant, setAssistant] = useState<any>(null);
src\app\vendor\page.tsx:89  const [assistantMsg, setAssistantMsg] = useState<string | null>(null);
src\app\vendor\page.tsx:91  const [msg, setMsg] = useState<string | null>(null);
src\app\vendor\page.tsx:92  const [loading, setLoading] = useState(true);
src\app\vendor\page.tsx:94  const [moodState, setMoodState] = useState<any>(() => loadMood());
src\app\vendor\page.tsx:95  const [moodBusy, setMoodBusy] = useState(false);
src\app\vendor\page.tsx:97  // reset mood state if a new day
src\app\vendor\page.tsx:100  if (moodState?.dayKey && moodState.dayKey !== dk) {
src\app\vendor\page.tsx:101  setMoodState(null);
src\app\vendor\page.tsx:110  return `${window.location.origin}/b/${me.businessSlug}`;
src\app\vendor\page.tsx:213  setMoodState(next);
src\app\vendor\page.tsx:235  const accessPlanKey = String(access?.planKey || "FREE").toUpperCase();
src\app\vendor\page.tsx:236  const subscribed = accessSource === "subscription" && accessPlanKey !== "FREE";
src\app\vendor\page.tsx:245  const momentumPlan = accessPlanKey === "MOMENTUM";
src\app\vendor\page.tsx:258  onClick={() => router.push("/vendor/subscription")}
src\app\vendor\page.tsx:292  <p className="text-xs opacity-95">Total sales</p>
src\app\vendor\page.tsx:294  <p className="text-xs opacity-95 mt-1">
src\app\vendor\page.tsx:324  {!moodState ? (
src\app\vendor\page.tsx:332  className="rounded-2xl border border-biz-line bg-white py-3 text-sm font-bold text-biz-ink disabled:opacity-50"
src\app\vendor\page.tsx:340  className="rounded-2xl border border-biz-line bg-white py-3 text-sm font-bold text-biz-ink disabled:opacity-50"
src\app\vendor\page.tsx:348  className="rounded-2xl border border-biz-line bg-white py-3 text-sm font-bold text-biz-ink disabled:opacity-50"
src\app\vendor\page.tsx:357  Mood: <b className="text-biz-ink">{String(moodState.mood).toUpperCase()}</b>
src\app\vendor\page.tsx:359  {moodState.tip ? <p className="text-sm text-gray-800 mt-2">{moodState.tip}</p> : null}
src\app\vendor\page.tsx:361  {Array.isArray(moodState.actions) && moodState.actions.length ? (
src\app\vendor\page.tsx:363  {moodState.actions.slice(0, 2).map((a: any) => (
src\app\vendor\page.tsx:400  <p className="mt-2 text-[11px] text-biz-muted">Tip: update delivery progress and respond fast to prevent disputes.</p>
src\app\vendor\page.tsx:510  <TodoRow label="Out of stock products" value={todo.outOfStockCount || 0} onClick={() => router.push("/vendor/products")} />
src\app\vendor\page.tsx:511  <TodoRow label="Low stock products" value={todo.lowStockCount || 0} onClick={() => router.push("/vendor/products")} />
src\app\vendor\page.tsx:542  <SectionCard title="Recent orders" subtitle="Latest activity">
src\components\admin\AdminSecurityGate.tsx:4  import { useEffect, useState } from "react";
src\components\admin\AdminSecurityGate.tsx:10  type SessionRes = { ok: boolean; verified?: boolean; verifiedUntilMs?: number; error?: string };
src\components\admin\AdminSecurityGate.tsx:13  const [loading, setLoading] = useState(true);
src\components\admin\AdminSecurityGate.tsx:14  const [verified, setVerified] = useState(false);
src\components\admin\AdminSecurityGate.tsx:16  const [msg, setMsg] = useState<string | null>(null);
src\components\admin\AdminSecurityGate.tsx:17  const [code, setCode] = useState("");
src\components\admin\AdminSecurityGate.tsx:18  const [sending, setSending] = useState(false);
src\components\admin\AdminSecurityGate.tsx:19  const [verifying, setVerifying] = useState(false);
src\components\admin\AdminSecurityGate.tsx:21  const [devCode, setDevCode] = useState<string | null>(null);
src\components\admin\AdminSecurityGate.tsx:22  const [autoSent, setAutoSent] = useState(false);
src\components\admin\AdminSecurityGate.tsx:46  setVerified(false);
src\components\admin\AdminSecurityGate.tsx:52  const isOk = !!data.verified;
src\components\admin\AdminSecurityGate.tsx:53  setVerified(isOk);
src\components\admin\AdminSecurityGate.tsx:56  // Auto-send code once per page load if not verified (matches your ìstrictî requirement)
src\components\admin\AdminSecurityGate.tsx:62  setVerified(false);
src\components\admin\AdminSecurityGate.tsx:99  setVerified(true);
src\components\admin\AdminSecurityGate.tsx:100  setMsg("Verified.");
src\components\admin\AdminSecurityGate.tsx:103  setVerified(false);
src\components\admin\AdminSecurityGate.tsx:122  if (!verified) {
src\components\ui\AppHeader.tsx:30  <div className="mt-4 relative">
src\components\ui\AppHeader.tsx:31  <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500" />
src\components\ui\BannerCarousel.tsx:4  import { useMemo, useState } from "react";
src\components\ui\BannerCarousel.tsx:15  const [i, setI] = useState(0);
src\components\ui\BannerCarousel.tsx:28  <p className="text-xs opacity-90 mt-1">{banners[i].subtitle}</p>
src\components\ui\Button.tsx:17  }: React.ButtonHTMLAttributes<HTMLButtonElement> & {
src\components\ui\Button.tsx:24  "inline-flex w-full items-center justify-center gap-2 font-bold transition active:scale-[0.99] disabled:opacity-50 disabled:active:scale-100";
src\components\ui\Button.tsx:26  const sizes =
src\components\ui\Button.tsx:47  className={cn(base, sizes, styles, className)}
src\components\ui\Chip.tsx:7  }: React.ButtonHTMLAttributes<HTMLButtonElement> & { active?: boolean }) {
src\components\ui\EmptyState.tsx:5  export function EmptyState({
src\components\ui\IconButton.tsx:7  }: React.ButtonHTMLAttributes<HTMLButtonElement> & {
src\components\ui\IconButton.tsx:11  "h-10 w-10 rounded-2xl inline-flex items-center justify-center transition active:scale-[0.99] disabled:opacity-50";
src\components\ui\Input.tsx:6  }: React.InputHTMLAttributes<HTMLInputElement>) {
src\components\ui\SegmentedControl.tsx:20  style={{ gridTemplateColumns: `repeat(${options.length}, minmax(0, 1fr))` }}
src\components\ui\SegmentedControl.tsx:36  disabled ? "opacity-40 cursor-not-allowed" : ""
src\components\ui\Toaster.tsx:4  import { useEffect, useRef, useState } from "react";
src\components\ui\Toaster.tsx:26  const [items, setItems] = useState<ToastItem[]>([]);
src\components\vendor\ImageUploader.tsx:4  import { useEffect, useMemo, useRef, useState } from "react";
src\components\vendor\ImageUploader.tsx:30  previewUrl: string;
src\components\vendor\ImageUploader.tsx:303  // fixed icon area, ratio displayed inside
src\components\vendor\ImageUploader.tsx:351  const [drafts, setDrafts] = useState<DraftItem[]>([]);
src\components\vendor\ImageUploader.tsx:357  const [err, setErr] = useState<string | null>(null);
src\components\vendor\ImageUploader.tsx:359  // crop modal state
src\components\vendor\ImageUploader.tsx:360  const [cropOpen, setCropOpen] = useState(false);
src\components\vendor\ImageUploader.tsx:361  const [cropId, setCropId] = useState<string | null>(null);
src\components\vendor\ImageUploader.tsx:363  const [aspect, setAspect] = useState<AspectChoice>(() => normalizeCoverAspect(aspectKey) || "1:1");
src\components\vendor\ImageUploader.tsx:369  const [applyToAll, setApplyToAll] = useState(false);
src\components\vendor\ImageUploader.tsx:370  const [hasCroppedOnce, setHasCroppedOnce] = useState(false); // ? show "apply to all" only after first crop
src\components\vendor\ImageUploader.tsx:371  const [croppingBusy, setCroppingBusy] = useState(false);
src\components\vendor\ImageUploader.tsx:373  const [zoom, setZoom] = useState(1);
src\components\vendor\ImageUploader.tsx:395  URL.revokeObjectURL(d.previewUrl);
src\components\vendor\ImageUploader.tsx:456  previewUrl: URL.createObjectURL(file),
src\components\vendor\ImageUploader.tsx:498  URL.revokeObjectURL(d.previewUrl);
src\components\vendor\ImageUploader.tsx:549  const nextPreview = URL.createObjectURL(nextFile);
src\components\vendor\ImageUploader.tsx:555  URL.revokeObjectURL(x.previewUrl);
src\components\vendor\ImageUploader.tsx:557  return { ...x, file: nextFile, previewUrl: nextPreview, status: "ready", progress: 0, error: undefined };
src\components\vendor\ImageUploader.tsx:597  // ? now we can show the ìapply to allî choice in later crops
src\components\vendor\ImageUploader.tsx:783  <img src={d.previewUrl} alt="Selected" className="h-24 w-full object-cover" />
src\components\vendor\ImageUploader.tsx:788  className="text-[11px] font-bold text-biz-accent disabled:opacity-50"
src\components\vendor\ImageUploader.tsx:797  className="text-[11px] font-bold text-gray-700 disabled:opacity-50"
src\components\vendor\ImageUploader.tsx:808  className="w-full py-2 rounded-xl text-[11px] font-extrabold bg-biz-cream text-biz-ink disabled:opacity-50"
src\components\vendor\ImageUploader.tsx:863  src={cropDraft.previewUrl}
src\components\vendor\ImageUploader.tsx:873  autoCropArea={1}
src\components\vendor\VariationBuilder.tsx:3  import { useMemo, useState } from "react";
src\components\vendor\VariationBuilder.tsx:14  "Brand",
src\components\vendor\VariationBuilder.tsx:15  "Condition",
src\components\vendor\VariationBuilder.tsx:29  const [newName, setNewName] = useState("");
src\components\vendor\VariationBuilder.tsx:81  Customers can choose options, but price/stock stays the same.
src\components\vendor\VariationBuilder.tsx:92  className="px-4 py-2 rounded-full text-xs font-extrabold text-white bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-40"
src\components\vendor\VariationBuilder.tsx:109  className="px-4 rounded-2xl text-sm font-extrabold text-white bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-40"
src\components\vendor\VariationBuilder.tsx:154  const [val, setVal] = useState("");
src\components\vendor\VariationBuilder.tsx:166  className="px-4 rounded-2xl text-sm font-extrabold text-white bg-gradient-to-br from-[#FF6A00] to-[#FF8A00] disabled:opacity-40"
src\components\vendor\VendorAccessGate.tsx:6  * - No more hard redirect/lock to subscription screen.
src\components\vendor\VendorShell.tsx:9  // When locked, user will be on /vendor/subscription (or summary).
src\components\vendor\VendorShell.tsx:10  // Hide the vendor bottom nav there so the screen is ìsubscription-onlyî.
src\components\vendor\VendorShell.tsx:11  const hideNav = pathname.startsWith("/vendor/subscription");
src\components\AppShell.tsx:17  pathname.startsWith("/payment/subscription/callback") ||
src\components\AuthGate.tsx:3  import { useEffect, useState } from "react";
src\components\AuthGate.tsx:5  import { onAuthStateChanged } from "firebase/auth";
src\components\AuthGate.tsx:23  const [loading, setLoading] = useState(true);
src\components\AuthGate.tsx:24  const [error, setError] = useState<string | null>(null);
src\components\AuthGate.tsx:27  const unsub = onAuthStateChanged(auth, async (u) => {
src\components\AuthGate.tsx:45  const emailVerified = !!data?.me?.emailVerified;
src\components\AuthGate.tsx:47  if (!emailVerified) {
src\components\BottomNav.tsx:44  <div className="relative">
src\components\CloudImage.tsx:28  sizes?: string;
src\components\CloudImage.tsx:44  sizes={props.sizes || "100vw"}
src\components\GradientHeader.tsx:22  <div className={cn("relative", className)}>
src\components\GradientHeader.tsx:23  {/* Brand strip */}
src\components\PageHelpFloating.tsx:3  import { useEffect, useMemo, useState } from "react";
src\components\PageHelpFloating.tsx:30  const raw = localStorage.getItem(INSTALL_KEY);
src\components\PageHelpFloating.tsx:34  localStorage.setItem(INSTALL_KEY, String(t));
src\components\PageHelpFloating.tsx:41  const raw = localStorage.getItem(CACHE_KEY);
src\components\PageHelpFloating.tsx:52  localStorage.setItem(CACHE_KEY, JSON.stringify(v));
src\components\PageHelpFloating.tsx:59  const [open, setOpen] = useState(false);
src\components\PageHelpFloating.tsx:60  const [installTs, setInstallTs] = useState<number>(() => loadInstallTs());
src\components\PageHelpFloating.tsx:62  const [q, setQ] = useState("");
src\components\PageHelpFloating.tsx:63  const [busy, setBusy] = useState(false);
src\components\PageHelpFloating.tsx:64  const [res, setRes] = useState<HelpRes | null>(null);
src\components\PageHelpFloating.tsx:76  "/vendor/store": { title: "Store settings", hint: "Brand info and WhatsApp settings." },
src\components\PageHelpFloating.tsx:207  className="rounded-2xl border border-biz-line bg-white px-3 py-3 text-sm font-bold text-biz-ink disabled:opacity-50 inline-flex items-center gap-2"
src\components\PageHelpFloating.tsx:220  className="text-[11px] font-bold text-gray-600 underline underline-offset-2 disabled:opacity-50"
src\components\ProductCard.tsx:4  import { useEffect, useState } from "react";
src\components\ProductCard.tsx:15  if (p?.saleActive !== true) return false;
src\components\ProductCard.tsx:23  const t = String(p?.saleType || "");
src\components\ProductCard.tsx:32  const t = String(p?.saleType || "");
src\components\ProductCard.tsx:34  const off = Number(p?.saleAmountOffNgn || 0);
src\components\ProductCard.tsx:38  const pct = Math.max(0, Math.min(90, Number(p?.salePercent || 0)));
src\components\ProductCard.tsx:44  const t = String(p?.saleType || "");
src\components\ProductCard.tsx:46  const off = Number(p?.saleAmountOffNgn || 0);
src\components\ProductCard.tsx:49  const pct = Number(p?.salePercent || 0);
src\components\ProductCard.tsx:77  if (t?.apexBadgeActive === true) return "earned_apex";
src\components\ProductCard.tsx:78  if (t?.temporaryApexBadgeActive === true) return "temporary_apex";
src\components\ProductCard.tsx:98  const [trust, setTrust] = useState<any>(null);
src\components\ProductCard.tsx:143  <div className={`${aspectClass} w-full rounded-2xl bg-[#F3F4F6] overflow-hidden relative`}>
src\components\ProductCard.tsx:160  title="Verified Apex badge (earned + maintained)"
src\components\ProductCard.tsx:162  Verified Apex
src\components\PushBellFloating.tsx:3  import { useEffect, useMemo, useState } from "react";
src\components\PushBellFloating.tsx:29  const v = Number(localStorage.getItem(key) || 0);
src\components\PushBellFloating.tsx:35  localStorage.setItem(key, String(v));
src\components\PushBellFloating.tsx:38  function snoozeLater() {
src\components\PushBellFloating.tsx:48  const [perm, setPerm] = useState<NotificationPermission | "unsupported">("unsupported");
src\components\PushBellFloating.tsx:49  const [busy, setBusy] = useState(false);
src\components\PushBellFloating.tsx:50  const [open, setOpen] = useState(false);
src\components\PushBellFloating.tsx:51  const [info, setInfo] = useState<string | null>(null);
src\components\PushBellFloating.tsx:53  const [tokenLocal, setTokenLocal] = useState<string | null>(() => {
src\components\PushBellFloating.tsx:55  return localStorage.getItem(PUSH_TOKEN_KEY);
src\components\PushBellFloating.tsx:71  if (p === "granted" && localStorage.getItem(PUSH_TOKEN_KEY)) return;
src\components\PushBellFloating.tsx:93  if (p === "granted" && localStorage.getItem(PUSH_TOKEN_KEY)) return;
src\components\PushBellFloating.tsx:117  snoozeLater();
src\components\PushBellFloating.tsx:126  snoozeLater();
src\components\PushBellFloating.tsx:133  snoozeLater();
src\components\PushBellFloating.tsx:140  snoozeLater();
src\components\PushBellFloating.tsx:156  setInfo("Could not enable on this device. Try again later.");
src\components\PushBellFloating.tsx:157  snoozeLater();
src\components\PushBellFloating.tsx:173  localStorage.setItem(PUSH_TOKEN_KEY, fcmToken);
src\components\PushBellFloating.tsx:182  snoozeLater();
src\components\PushBellFloating.tsx:205  snoozeLater();
src\components\PushBellFloating.tsx:221  className="w-full rounded-2xl bg-black text-white py-3 text-sm font-extrabold disabled:opacity-50"
src\components\PushBellFloating.tsx:230  snoozeLater();
src\lib\admin\securityServer.ts:84  const verifiedUntilMs = Number(d?.verifiedUntilMs || 0);
src\lib\admin\securityServer.ts:85  const verified = !!(verifiedUntilMs && verifiedUntilMs > Date.now());
src\lib\admin\securityServer.ts:87  return { verified, verifiedUntilMs: verifiedUntilMs || 0, raw: d };
src\lib\admin\securityServer.ts:90  export async function requireAdminSessionVerified(req: Request) {
src\lib\admin\securityServer.ts:94  if (!s.verified) {
src\lib\admin\securityServer.ts:95  const err: any = new Error("Admin session not verified");
src\lib\admin\securityServer.ts:96  err.code = "ADMIN_SESSION_NOT_VERIFIED";
src\lib\admin\securityServer.ts:103  export async function markAdminSessionVerified(params: { uid: string; email: string }) {
src\lib\admin\securityServer.ts:105  const verifiedUntilMs = nowMs + sessionTtlMs();
src\lib\admin\securityServer.ts:111  verifiedAtMs: nowMs,
src\lib\admin\securityServer.ts:112  verifiedUntilMs,
src\lib\admin\securityServer.ts:129  return { verifiedUntilMs };
src\lib\admin\withdrawPinServer.ts:20  export async function getAdminWithdrawPinState(uid: string) {
src\lib\buyers\freezeServer.ts:6  export type BuyerFreezeState = {
src\lib\buyers\freezeServer.ts:12  export async function getBuyerFreezeState(input: BuyerKeyInput): Promise<BuyerFreezeState> {
src\lib\buyers\freezeServer.ts:25  const st = await getBuyerFreezeState(input);
src\lib\cart\CartContext.tsx:3  import { createContext, useContext, useEffect, useMemo, useState } from "react";
src\lib\cart\CartContext.tsx:4  import type { CartLine, CartState } from "@/lib/cart/store";
src\lib\cart\CartContext.tsx:8  cart: CartState;
src\lib\cart\CartContext.tsx:25  const [cart, setCart] = useState<CartState>({ storeSlug: null, items: [] });
src\lib\cart\CartContext.tsx:39  const base: CartState =
src\lib\cart\store.ts:14  export type CartState = {
src\lib\cart\store.ts:21  export function loadCart(): CartState {
src\lib\cart\store.ts:24  const raw = localStorage.getItem(KEY);
src\lib\cart\store.ts:36  export function saveCart(cart: CartState) {
src\lib\cart\store.ts:38  localStorage.setItem(KEY, JSON.stringify(cart));
src\lib\checkin\buildBusinessDailySnapshot.ts:112  // Products (stock signals)
src\lib\checkin\buildBusinessDailySnapshot.ts:117  const outOfStockCount = products.filter((p) => Number(p.stock ?? 0) <= 0).length;
src\lib\checkin\buildBusinessDailySnapshot.ts:118  const lowStockCount = products.filter((p) => {
src\lib\checkin\buildBusinessDailySnapshot.ts:119  const s = Number(p.stock ?? 0);
src\lib\checkin\buildBusinessDailySnapshot.ts:170  outOfStockCount,
src\lib\checkin\buildBusinessDailySnapshot.ts:171  lowStockCount,
src\lib\checkout\coupon.ts:38  return safeParse(window.localStorage.getItem(KEY));
src\lib\checkout\coupon.ts:43  window.localStorage.setItem(KEY, JSON.stringify(c));
src\lib\checkout\coupon.ts:48  window.localStorage.removeItem(KEY);
src\lib\checkout\pricingServer.ts:41  if (p?.saleActive !== true) return false;
src\lib\checkout\pricingServer.ts:49  const t = String(p?.saleType || "");
src\lib\checkout\pricingServer.ts:59  const t = String(product?.saleType || "");
src\lib\checkout\pricingServer.ts:61  const off = Number(product?.saleAmountOffNgn || 0);
src\lib\checkout\pricingServer.ts:65  const pct = Math.max(0, Math.min(90, Number(product?.salePercent || 0)));
src\lib\checkout\pricingServer.ts:167  // Stock enforcement (soft): if stock is tracked and <=0, block checkout
src\lib\checkout\pricingServer.ts:169  const stock = Number(p.stock ?? 0);
src\lib\checkout\pricingServer.ts:170  if (Number.isFinite(stock) && stock <= 0) {
src\lib\checkout\pricingServer.ts:171  throw new Error(`Out of stock: ${p.name || p.id}`);
src\lib\checkout\pricingServer.ts:196  saleType: p.saleType ?? null,
src\lib\checkout\pricingServer.ts:197  salePercent: p.salePercent ?? null,
src\lib\checkout\pricingServer.ts:198  saleAmountOffNgn: p.saleAmountOffNgn ?? null,
src\lib\checkout\profile.ts:28  const v = safeParse(localStorage.getItem(KEY));
src\lib\checkout\profile.ts:34  localStorage.setItem(
src\lib\checkout\shipping.ts:4  type: "pickup" | "delivery";
src\lib\checkout\shipping.ts:20  const type = String(v.type || "delivery") === "pickup" ? "pickup" : "delivery";
src\lib\checkout\shipping.ts:21  const name = String(v.name || "").slice(0, 60) || (type === "pickup" ? "Pickup" : "Delivery");
src\lib\checkout\shipping.ts:36  return safeParse(window.localStorage.getItem(KEY));
src\lib\checkout\shipping.ts:41  window.localStorage.setItem(KEY, JSON.stringify(s));
src\lib\checkout\shipping.ts:46  window.localStorage.removeItem(KEY);
src\lib\entitlements\server.ts:13  subscription: business?.subscription ?? null,
src\lib\firebase\client.ts:4  import { getStorage } from "firebase/storage";
src\lib\firebase\client.ts:10  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET!,
src\lib\firebase\client.ts:19  export const storage = getStorage(app);
src\lib\firebase\market.ts:11  // Simple: just grab first products. Later weíll do analytics-based trending.
src\lib\firebase\uploads.ts:1  import { storage } from "@/lib/firebase/client";
src\lib\firebase\uploads.ts:2  import { ref, uploadBytes, getDownloadURL } from "firebase/storage";
src\lib\firebase\uploads.ts:16  const r = ref(storage, path);
src\lib\marketing\optOut.ts:31  return safeParse(localStorage.getItem(KEY)) || { globalOptOut: false, storeOptOutSlugs: [], updatedAtMs: 0 };
src\lib\marketing\optOut.ts:36  localStorage.setItem(KEY, JSON.stringify(p));
src\lib\metrics\daily.ts:62  export async function fetchPlatformDailyMetrics(dayKeys: string[]) {
src\lib\metrics\daily.ts:65  const refs = dayKeys.map((dk) => adminDb.collection("platformMetricsDaily").doc(dk));
src\lib\moderation\simpleTextGuard.ts:4  * Later, can be replaced with a paid moderation API, but this is immediate + local.
src\lib\net\useNetworkProfile.ts:3  import { useEffect, useState } from "react";
src\lib\net\useNetworkProfile.ts:8  const [saveData, setSaveData] = useState(false);
src\lib\net\useNetworkProfile.ts:9  const [effectiveType, setEffectiveType] = useState<EffectiveType>("unknown");
src\lib\orders\recent.ts:16  return safeParse(window.localStorage.getItem(KEY));
src\lib\orders\recent.ts:23  window.localStorage.setItem(KEY, JSON.stringify(next));
src\lib\orders\recent.ts:30  window.localStorage.setItem(KEY, JSON.stringify(next));
src\lib\orders\recent.ts:35  window.localStorage.removeItem(KEY);
src\lib\payments\flutterwaveServer.ts:4  amount: number; // major unit (e.g. 5000 for NGN, 20 for USD)
src\lib\payments\flutterwaveServer.ts:5  currency: "NGN" | "USD";
src\lib\payments\flutterwaveServer.ts:19  export type FlwVerifiedTx = {
src\lib\payments\flutterwaveServer.ts:24  currency: string; // "NGN" | "USD"
src\lib\payments\flutterwaveServer.ts:110  export async function flwVerifyTransaction(transactionId: string | number): Promise<FlwVerifiedTx> {
src\lib\payments\flutterwaveServer.ts:124  return j.data as FlwVerifiedTx;
src\lib\payments\provider.ts:2  export type PaymentsProvider = "flutterwave" | "paystack";
src\lib\payments\provider.ts:7  * - Set PAYMENTS_PROVIDER=paystack to switch back later
src\lib\payments\provider.ts:11  return v === "paystack" ? "paystack" : "flutterwave";
src\lib\push\sendBusinessPush.ts:43  // Firebase multicast limit is 500, but keep it small & fast
src\lib\reports\platformDaily.ts:33  export async function buildDailyPlatformReport(params?: { date?: Date }) {
src\lib\reports\platformDaily.ts:43  adminDb.collection("platformMetricsDaily").doc(dkToday).get(),
src\lib\reports\platformDaily.ts:44  adminDb.collection("platformMetricsDaily").doc(dkYesterday).get(),
src\lib\search\keywords.ts:51  colors?: string[];
src\lib\search\keywords.ts:52  sizes?: string[];
src\lib\search\keywords.ts:71  for (const c of (args.colors || []).map((x) => normText(x)).filter(Boolean)) out.add(c);
src\lib\search\keywords.ts:72  for (const s of (args.sizes || []).map((x) => normText(x)).filter(Boolean)) out.add(s);
src\lib\search\keywords.ts:81  state?: string;
src\lib\search\keywords.ts:82  city?: string;
src\lib\search\keywords.ts:92  args.state,
src\lib\search\keywords.ts:93  args.city,
src\lib\search\marketTaxonomy.ts:39  "beauty","hair","wig","wigs","attachment","braids","braid","weavon","weave","shampoo","conditioner",
src\lib\search\marketTaxonomy.ts:48  "home","kitchen","decor","decoration","plate","plates","pot","pots","pan","pans","spoon","cup","mug","bowl",
src\lib\search\marketTaxonomy.ts:62  synonyms: ["service","services","repair","repairs","installation","install","barbing","barber","hairdresser","makeupartist","massage","cleaning"],
src\lib\vendor\addons\catalog.ts:2  export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\vendor\addons\catalog.ts:6  plan: BizhubPlanKey; // which plan can buy it
src\lib\vendor\addons\catalog.ts:17  sku: "addon_installments_basic",
src\lib\vendor\addons\catalog.ts:20  title: "Installment plans (basic)",
src\lib\vendor\addons\catalog.ts:25  sku: "addon_deadstock_40_15",
src\lib\vendor\addons\catalog.ts:28  title: "Dead stock (40 rows, 15 days)",
src\lib\vendor\addons\catalog.ts:29  description: "Momentum-lite dead stock view.",
src\lib\vendor\addons\catalog.ts:45  description: "Increase follow-up capacity.",
src\lib\vendor\addons\catalog.ts:69  description: "Installments (basic) + Follow-ups boost + Best sellers expansion",
src\lib\vendor\addons\catalog.ts:70  includesSkus: ["addon_installments_basic", "addon_followups_boost_20", "addon_bestsellers_10_14"],
src\lib\vendor\addons\catalog.ts:84  sku: "addon_installments_advanced",
src\lib\vendor\addons\catalog.ts:87  title: "Installment plans (advanced rules)",
src\lib\vendor\addons\catalog.ts:100  sku: "addon_priority_dispute_review",
src\lib\vendor\addons\catalog.ts:103  title: "Priority dispute review (queue boost only)",
src\lib\vendor\addons\catalog.ts:111  title: "Verified Apex badge (temporary / probation)",
src\lib\vendor\addons\catalog.ts:120  description: "Increase follow-up capacity.",
src\lib\vendor\addons\catalog.ts:124  sku: "addon_deadstock_150_60",
src\lib\vendor\addons\catalog.ts:127  title: "Dead stock expansion (150 rows, 60 days)",
src\lib\vendor\addons\catalog.ts:128  description: "Bigger dead stock view.",
src\lib\vendor\addons\catalog.ts:153  description: "Risk Shield + Priority dispute review + Temporary Apex badge",
src\lib\vendor\addons\catalog.ts:154  includesSkus: ["addon_risk_shield_quiet", "addon_priority_dispute_review", "addon_probation_apex_badge"],
src\lib\vendor\addons\catalog.ts:180  description: "AI recovers failed payments, abandoned checkouts, unpaid installments.",
src\lib\vendor\addons\catalog.ts:220  description: "System flags growth risks + human review priority.",
src\lib\vendor\addons\catalog.ts:243  export function addonsForPlan(planKey: BizhubPlanKey) {
src\lib\vendor\addons\catalog.ts:244  return ADDONS.filter((a) => a.plan === planKey);
src\lib\vendor\reengagement\compose.ts:11  export type PlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\vendor\reengagement\compose.ts:82  [/\breorder\b/gi, ["reorder", "order again", "restock"]],
src\lib\vendor\reengagement\compose.ts:104  planKey: PlanKey;
src\lib\vendor\reengagement\compose.ts:117  const planKey = (String(args.planKey || "FREE").toUpperCase() as PlanKey) || "FREE";
src\lib\vendor\reengagement\compose.ts:120  const aiRemix = planKey === "APEX" && !!args.features?.reengagementAiRemix;
src\lib\vendor\reengagement\compose.ts:131  const seed = ["reengage", planKey, String(args.businessSlug || ""), String(args.person.key || ""), seg, rot].join("|");
src\lib\vendor\reengagement\compose.ts:150  "If you want to restock, I can help you reorder fast.",
src\lib\vendor\reengagement\compose.ts:153  "Just checking in ó do you need to restock?",
src\lib\vendor\access.ts:5  * - Free is unlimited time, but restricted via planConfig.
src\lib\vendor\access.ts:10  export type VendorAccessState = {
src\lib\vendor\access.ts:12  reason: "active_subscription" | "free";
src\lib\vendor\access.ts:15  subscriptionExpiresAtMs: number | null;
src\lib\vendor\access.ts:16  hasActiveSubscription: boolean;
src\lib\vendor\access.ts:20  export function computeVendorAccessState(biz: any | null): VendorAccessState {
src\lib\vendor\access.ts:23  const subscriptionExpiresAtMs = Number(biz?.subscription?.expiresAtMs || 0) || null;
src\lib\vendor\access.ts:24  const hasActiveSubscription = !!(biz?.subscription?.planKey && subscriptionExpiresAtMs && subscriptionExpiresAtMs > now);
src\lib\vendor\access.ts:28  reason: hasActiveSubscription ? "active_subscription" : "free",
src\lib\vendor\access.ts:35  subscriptionExpiresAtMs,
src\lib\vendor\access.ts:36  hasActiveSubscription,
src\lib\vendor\assistantLimitsServer.ts:4  export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\vendor\assistantLimitsServer.ts:9  canUseShareTemplates: boolean;
src\lib\vendor\assistantLimitsServer.ts:12  function hasActiveSubscription(biz: any) {
src\lib\vendor\assistantLimitsServer.ts:13  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\lib\vendor\assistantLimitsServer.ts:14  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\lib\vendor\assistantLimitsServer.ts:17  function resolvePlanKey(biz: any): BizhubPlanKey {
src\lib\vendor\assistantLimitsServer.ts:18  if (!hasActiveSubscription(biz)) return "FREE";
src\lib\vendor\assistantLimitsServer.ts:19  const k = String(biz?.subscription?.planKey || "").toUpperCase();
src\lib\vendor\assistantLimitsServer.ts:29  canUseShareTemplates: !!obj.canUseShareTemplates,
src\lib\vendor\assistantLimitsServer.ts:34  const snap = await adminDb.collection("platform").doc("assistantLimits").get();
src\lib\vendor\assistantLimitsServer.ts:49  const hasSub = hasActiveSubscription(biz);
src\lib\vendor\assistantLimitsServer.ts:50  const planKey = resolvePlanKey(biz);
src\lib\vendor\assistantLimitsServer.ts:55  const fallback: Record<BizhubPlanKey, AssistantLimits> = {
src\lib\vendor\assistantLimitsServer.ts:56  FREE: { canUseAssistant: false, canSendWhatsappSummary: false, canUseShareTemplates: false },
src\lib\vendor\assistantLimitsServer.ts:57  LAUNCH: { canUseAssistant: true, canSendWhatsappSummary: true, canUseShareTemplates: true },
src\lib\vendor\assistantLimitsServer.ts:58  MOMENTUM: { canUseAssistant: true, canSendWhatsappSummary: true, canUseShareTemplates: true },
src\lib\vendor\assistantLimitsServer.ts:59  APEX: { canUseAssistant: true, canSendWhatsappSummary: true, canUseShareTemplates: true },
src\lib\vendor\assistantLimitsServer.ts:62  const resolved = plans?.[planKey] ?? fallback[planKey];
src\lib\vendor\assistantLimitsServer.ts:65  planKey,
src\lib\vendor\assistantLimitsServer.ts:66  hasActiveSubscription: hasSub,
src\lib\vendor\choices.ts:8  "Brand",
src\lib\vendor\choices.ts:9  "Condition",
src\lib\vendor\choices.ts:22  "Plate",
src\lib\vendor\limitsServer.ts:4  export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\vendor\limitsServer.ts:18  deadStock: boolean;
src\lib\vendor\limitsServer.ts:22  installmentPlans: boolean;
src\lib\vendor\limitsServer.ts:25  usdCheckout: boolean;
src\lib\vendor\limitsServer.ts:44  deadStockMaxRows: number;
src\lib\vendor\limitsServer.ts:45  deadStockMaxDays: number;
src\lib\vendor\limitsServer.ts:46  deadStockIgnoreNewerThanDays: number;
src\lib\vendor\limitsServer.ts:53  planKey: BizhubPlanKey;
src\lib\vendor\limitsServer.ts:54  hasActiveSubscription: boolean;
src\lib\vendor\limitsServer.ts:59  function cleanPlanKey(v: any): BizhubPlanKey {
src\lib\vendor\limitsServer.ts:68  const planKey = cleanPlanKey(resolved.planKey);
src\lib\vendor\limitsServer.ts:69  const hasActiveSubscription = !!resolved.hasActiveSubscription;
src\lib\vendor\limitsServer.ts:86  deadStock: !!f.deadStock,
src\lib\vendor\limitsServer.ts:90  installmentPlans: !!f.installmentPlans,
src\lib\vendor\limitsServer.ts:92  usdCheckout: !!f.usdCheckout,
src\lib\vendor\limitsServer.ts:111  deadStockMaxRows: Number(l.deadStockMaxRows || 0),
src\lib\vendor\limitsServer.ts:112  deadStockMaxDays: Number(l.deadStockMaxDays || 0),
src\lib\vendor\limitsServer.ts:113  deadStockIgnoreNewerThanDays: Number(l.deadStockIgnoreNewerThanDays || 0),
src\lib\vendor\limitsServer.ts:115  canUpdateStatus: planKey !== "FREE" && hasActiveSubscription,
src\lib\vendor\limitsServer.ts:119  return { planKey, hasActiveSubscription, features, limits };
src\lib\vendor\lockServer.ts:3  import { computeVendorAccessState } from "@/lib/vendor/access";
src\lib\vendor\lockServer.ts:26  const state = computeVendorAccessState(business);
src\lib\vendor\lockServer.ts:32  reason: state.reason,
src\lib\vendor\planConfigServer.ts:4  export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\vendor\planConfigServer.ts:18  apexVerifiedBadge: boolean;
src\lib\vendor\planConfigServer.ts:27  deadStock: boolean;
src\lib\vendor\planConfigServer.ts:31  installmentPlans: boolean;
src\lib\vendor\planConfigServer.ts:33  /** ? NEW: allow customers pay in USD at checkout (only used on MOMENTUM/APEX) */
src\lib\vendor\planConfigServer.ts:34  usdCheckout: boolean;
src\lib\vendor\planConfigServer.ts:53  deadStockMaxRows: number;
src\lib\vendor\planConfigServer.ts:54  deadStockMaxDays: number;
src\lib\vendor\planConfigServer.ts:55  deadStockIgnoreNewerThanDays: number;
src\lib\vendor\planConfigServer.ts:59  plans: Record<BizhubPlanKey, { features: PlanFeatures; limits: PlanLimits }>;
src\lib\vendor\planConfigServer.ts:62  function hasActiveSubscription(biz: any) {
src\lib\vendor\planConfigServer.ts:63  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\lib\vendor\planConfigServer.ts:64  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\lib\vendor\planConfigServer.ts:67  function resolvePlanKey(biz: any): BizhubPlanKey {
src\lib\vendor\planConfigServer.ts:68  if (!hasActiveSubscription(biz)) return "FREE";
src\lib\vendor\planConfigServer.ts:69  const k = String(biz?.subscription?.planKey || "").toUpperCase();
src\lib\vendor\planConfigServer.ts:99  apexVerifiedBadge: typeof o.apexVerifiedBadge === "boolean" ? o.apexVerifiedBadge : fallback.apexVerifiedBadge,
src\lib\vendor\planConfigServer.ts:112  deadStock: typeof o.deadStock === "boolean" ? o.deadStock : fallback.deadStock,
src\lib\vendor\planConfigServer.ts:116  installmentPlans: typeof o.installmentPlans === "boolean" ? o.installmentPlans : fallback.installmentPlans,
src\lib\vendor\planConfigServer.ts:118  usdCheckout: typeof o.usdCheckout === "boolean" ? o.usdCheckout : fallback.usdCheckout,
src\lib\vendor\planConfigServer.ts:140  deadStockMaxRows: pickInt(o.deadStockMaxRows, fallback.deadStockMaxRows, 0, 2000),
src\lib\vendor\planConfigServer.ts:141  deadStockMaxDays: pickInt(o.deadStockMaxDays, fallback.deadStockMaxDays, 0, 365),
src\lib\vendor\planConfigServer.ts:142  deadStockIgnoreNewerThanDays: pickInt(o.deadStockIgnoreNewerThanDays, fallback.deadStockIgnoreNewerThanDays, 0, 60),
src\lib\vendor\planConfigServer.ts:162  apexVerifiedBadge: false,
src\lib\vendor\planConfigServer.ts:171  deadStock: false,
src\lib\vendor\planConfigServer.ts:175  installmentPlans: false,
src\lib\vendor\planConfigServer.ts:177  usdCheckout: false,
src\lib\vendor\planConfigServer.ts:195  deadStockMaxRows: 0,
src\lib\vendor\planConfigServer.ts:196  deadStockMaxDays: 0,
src\lib\vendor\planConfigServer.ts:197  deadStockIgnoreNewerThanDays: 7,
src\lib\vendor\planConfigServer.ts:214  apexVerifiedBadge: false,
src\lib\vendor\planConfigServer.ts:223  deadStock: false,
src\lib\vendor\planConfigServer.ts:227  installmentPlans: false,
src\lib\vendor\planConfigServer.ts:229  usdCheckout: false,
src\lib\vendor\planConfigServer.ts:247  deadStockMaxRows: 0,
src\lib\vendor\planConfigServer.ts:248  deadStockMaxDays: 0,
src\lib\vendor\planConfigServer.ts:249  deadStockIgnoreNewerThanDays: 7,
src\lib\vendor\planConfigServer.ts:266  apexVerifiedBadge: false,
src\lib\vendor\planConfigServer.ts:275  deadStock: true,
src\lib\vendor\planConfigServer.ts:279  installmentPlans: false,
src\lib\vendor\planConfigServer.ts:281  usdCheckout: true, // ? default ON
src\lib\vendor\planConfigServer.ts:299  deadStockMaxRows: 80,
src\lib\vendor\planConfigServer.ts:300  deadStockMaxDays: 30,
src\lib\vendor\planConfigServer.ts:301  deadStockIgnoreNewerThanDays: 7,
src\lib\vendor\planConfigServer.ts:318  apexVerifiedBadge: true,
src\lib\vendor\planConfigServer.ts:327  deadStock: true,
src\lib\vendor\planConfigServer.ts:331  installmentPlans: true,
src\lib\vendor\planConfigServer.ts:333  usdCheckout: true, // ? default ON
src\lib\vendor\planConfigServer.ts:351  deadStockMaxRows: 200,
src\lib\vendor\planConfigServer.ts:352  deadStockMaxDays: 90,
src\lib\vendor\planConfigServer.ts:353  deadStockIgnoreNewerThanDays: 7,
src\lib\vendor\planConfigServer.ts:361  const snap = await adminDb.collection("platform").doc("planConfig").get();
src\lib\vendor\planConfigServer.ts:371  (["FREE", "LAUNCH", "MOMENTUM", "APEX"] as BizhubPlanKey[]).forEach((k) => {
src\lib\vendor\planConfigServer.ts:396  function syncAddonEntitlementsCompute(entMap: any, subscriptionActive: boolean, nowMs: number) {
src\lib\vendor\planConfigServer.ts:406  if (!subscriptionActive) {
src\lib\vendor\planConfigServer.ts:445  async function syncAddonEntitlementsIfNeeded(businessId: string, biz: any, subscriptionActive: boolean) {
src\lib\vendor\planConfigServer.ts:451  const lastState = !!sync.lastKnownSubActive;
src\lib\vendor\planConfigServer.ts:458  if (lastState !== subscriptionActive) mustSync = true;
src\lib\vendor\planConfigServer.ts:467  if (subscriptionActive) {
src\lib\vendor\planConfigServer.ts:485  if (!mustSync && lastState === subscriptionActive && nowMs - lastMs < 10 * 60 * 1000) {
src\lib\vendor\planConfigServer.ts:489  const computed = syncAddonEntitlementsCompute(entMap, subscriptionActive, nowMs);
src\lib\vendor\planConfigServer.ts:495  if (lastState !== subscriptionActive || nowMs - lastMs >= 10 * 60 * 1000) {
src\lib\vendor\planConfigServer.ts:496  await ref.set({ addonSync: { lastKnownSubActive: subscriptionActive, lastSyncMs: nowMs } }, { merge: true });
src\lib\vendor\planConfigServer.ts:504  addonSync: { lastKnownSubActive: subscriptionActive, lastSyncMs: nowMs },
src\lib\vendor\planConfigServer.ts:510  return { ...biz, addonEntitlements: nextEnt, addonSync: { lastKnownSubActive: subscriptionActive, lastSyncMs: nowMs } };
src\lib\vendor\planConfigServer.ts:521  planKey: BizhubPlanKey;
src\lib\vendor\planConfigServer.ts:522  hasActiveSubscription: boolean;
src\lib\vendor\planConfigServer.ts:527  const { planKey, hasActiveSubscription, business } = args;
src\lib\vendor\planConfigServer.ts:530  if (!hasActiveSubscription || planKey === "FREE") {
src\lib\vendor\planConfigServer.ts:537  const basicInstallments = addonIsActive(entMap["addon_installments_basic"], nowMs);
src\lib\vendor\planConfigServer.ts:538  const advancedInstallments = addonIsActive(entMap["addon_installments_advanced"], nowMs);
src\lib\vendor\planConfigServer.ts:540  const launchDeadStock = addonIsActive(entMap["addon_deadstock_40_15"], nowMs);
src\lib\vendor\planConfigServer.ts:541  const momentumDeadStockExpansion = addonIsActive(entMap["addon_deadstock_150_60"], nowMs);
src\lib\vendor\planConfigServer.ts:558  if (planKey === "LAUNCH" || planKey === "MOMENTUM") {
src\lib\vendor\planConfigServer.ts:562  if (planKey === "LAUNCH" && basicInstallments) {
src\lib\vendor\planConfigServer.ts:563  nextFeatures.installmentPlans = true;
src\lib\vendor\planConfigServer.ts:564  addons.installmentPlansTier = "basic";
src\lib\vendor\planConfigServer.ts:565  addons.installmentPlansSku = "addon_installments_basic";
src\lib\vendor\planConfigServer.ts:568  if (planKey === "MOMENTUM" && advancedInstallments) {
src\lib\vendor\planConfigServer.ts:569  nextFeatures.installmentPlans = true;
src\lib\vendor\planConfigServer.ts:570  addons.installmentPlansTier = "advanced";
src\lib\vendor\planConfigServer.ts:571  addons.installmentPlansSku = "addon_installments_advanced";
src\lib\vendor\planConfigServer.ts:574  if (planKey === "LAUNCH" && launchDeadStock) {
src\lib\vendor\planConfigServer.ts:575  nextFeatures.deadStock = true;
src\lib\vendor\planConfigServer.ts:576  nextLimits.deadStockMaxRows = Math.max(Number(nextLimits.deadStockMaxRows || 0), 40);
src\lib\vendor\planConfigServer.ts:577  nextLimits.deadStockMaxDays = Math.max(Number(nextLimits.deadStockMaxDays || 0), 15);
src\lib\vendor\planConfigServer.ts:578  addons.deadStockTier = "40_15";
src\lib\vendor\planConfigServer.ts:579  addons.deadStockSku = "addon_deadstock_40_15";
src\lib\vendor\planConfigServer.ts:582  if (planKey === "MOMENTUM" && momentumDeadStockExpansion) {
src\lib\vendor\planConfigServer.ts:583  nextFeatures.deadStock = true;
src\lib\vendor\planConfigServer.ts:584  nextLimits.deadStockMaxRows = Math.max(Number(nextLimits.deadStockMaxRows || 0), 150);
src\lib\vendor\planConfigServer.ts:585  nextLimits.deadStockMaxDays = Math.max(Number(nextLimits.deadStockMaxDays || 0), 60);
src\lib\vendor\planConfigServer.ts:586  addons.deadStockTier = "150_60";
src\lib\vendor\planConfigServer.ts:587  addons.deadStockSku = "addon_deadstock_150_60";
src\lib\vendor\planConfigServer.ts:590  if (planKey === "LAUNCH" && launchFollowUpsBoost) {
src\lib\vendor\planConfigServer.ts:596  if (planKey === "MOMENTUM" && momentumFollowUpsBoost) {
src\lib\vendor\planConfigServer.ts:602  if (planKey === "LAUNCH" && launchStaffPlus1) {
src\lib\vendor\planConfigServer.ts:608  if (planKey === "LAUNCH" && launchBestSellersExpansion) {
src\lib\vendor\planConfigServer.ts:615  if (planKey === "MOMENTUM" && momentumBestSellersExpansion) {
src\lib\vendor\planConfigServer.ts:622  if (planKey === "LAUNCH" && launchAiRemix) {
src\lib\vendor\planConfigServer.ts:629  if (planKey === "MOMENTUM" && momentumAiRemix) {
src\lib\vendor\planConfigServer.ts:644  const hasSub = hasActiveSubscription(biz);
src\lib\vendor\planConfigServer.ts:645  const planKey = resolvePlanKey(biz);
src\lib\vendor\planConfigServer.ts:650  const basePlan = cfg.plans[planKey] ?? fallbackPlanConfig().plans[planKey];
src\lib\vendor\planConfigServer.ts:653  planKey,
src\lib\vendor\planConfigServer.ts:654  hasActiveSubscription: hasSub,
src\lib\vendor\planConfigServer.ts:661  planKey,
src\lib\vendor\planConfigServer.ts:662  hasActiveSubscription: hasSub,
src\lib\vendor\staffSeatsServer.ts:5  export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\vendor\staffSeatsServer.ts:7  function cleanPlanKey(v: any): BizhubPlanKey {
src\lib\vendor\staffSeatsServer.ts:13  function hasActiveSubscription(biz: any) {
src\lib\vendor\staffSeatsServer.ts:14  const exp = Number(biz?.subscription?.expiresAtMs || 0);
src\lib\vendor\staffSeatsServer.ts:15  return !!(biz?.subscription?.planKey && exp && exp > Date.now());
src\lib\vendor\staffSeatsServer.ts:28  if (status === "paused") return remainingMs > 0; // effective resume when subscription is active
src\lib\vendor\staffSeatsServer.ts:32  export function staffSeatLimitFor(planKey: BizhubPlanKey | string) {
src\lib\vendor\staffSeatsServer.ts:33  const k = cleanPlanKey(planKey);
src\lib\vendor\staffSeatsServer.ts:40  export async function getStaffSeatState(businessId: string) {
src\lib\vendor\staffSeatsServer.ts:45  const subActive = hasActiveSubscription(biz);
src\lib\vendor\staffSeatsServer.ts:49  subscription: biz?.subscription ?? null,
src\lib\vendor\staffSeatsServer.ts:52  const planKey = cleanPlanKey(entitlement?.planKey || "FREE");
src\lib\vendor\staffSeatsServer.ts:54  let seatLimit = staffSeatLimitFor(planKey);
src\lib\vendor\staffSeatsServer.ts:57  if (subActive && planKey === "LAUNCH" && addonSeatPlus1ActiveEffective(biz, nowMs)) {
src\lib\vendor\staffSeatsServer.ts:83  planKey,
src\lib\vendor\staffSeatsServer.ts:84  hasActiveSubscription: subActive,
src\lib\vendor\staffSeatsServer.ts:90  staffPlus1Effective: subActive && planKey === "LAUNCH" && addonSeatPlus1ActiveEffective(biz, nowMs),
src\lib\vendor\syncBusinessSignals.ts:7  export type VerificationTier = 0 | 1 | 2 | 3;
src\lib\vendor\syncBusinessSignals.ts:9  function computeTierFromVerification(v: any): VerificationTier {
src\lib\vendor\syncBusinessSignals.ts:10  const tier1 = String(v?.tier1?.status || "").toLowerCase() === "verified";
src\lib\vendor\syncBusinessSignals.ts:11  const tier2 = String(v?.tier2?.status || "").toLowerCase() === "verified";
src\lib\vendor\syncBusinessSignals.ts:12  const tier3 = String(v?.tier3?.status || "").toLowerCase() === "verified";
src\lib\vendor\syncBusinessSignals.ts:46  const subscribed = !!plan.hasActiveSubscription;
src\lib\vendor\syncBusinessSignals.ts:50  verificationTier: tier,
src\lib\vendor\syncBusinessSignals.ts:67  const state = String(biz?.state || "").trim() || null;
src\lib\vendor\syncBusinessSignals.ts:68  const city = String(biz?.city || "").trim() || null;
src\lib\vendor\syncBusinessSignals.ts:71  businessState: state,
src\lib\vendor\syncBusinessSignals.ts:72  businessCity: city,
src\lib\vendor\syncBusinessSignals.ts:74  marketTier: tier,
src\lib\vendor\syncBusinessSignals.ts:79  businessHasActiveSubscription: subscribed,
src\lib\vendor\trustRulesServer.ts:18  // Stored in platform/trustRules (same collection used by platform/finance)
src\lib\vendor\trustRulesServer.ts:19  const snap = await adminDb.collection("platform").doc("trustRules").get();
src\lib\bizhubPlans.ts:3  export type BizhubPlanKey = "FREE" | "LAUNCH" | "MOMENTUM" | "APEX";
src\lib\bizhubPlans.ts:7  key: BizhubPlanKey;
src\lib\bizhubPlans.ts:18  /** Shown on pricing/subscription UI */
src\lib\bizhubPlans.ts:25  maxProducts: number | "unlimited";
src\lib\bizhubPlans.ts:40  export const BIZHUB_PLANS: Record<BizhubPlanKey, PlanCatalog> = {
src\lib\bizhubPlans.ts:68  "Basic stock count",
src\lib\bizhubPlans.ts:69  "Out-of-stock handling",
src\lib\bizhubPlans.ts:75  "Simple daily / weekly sales summary (limited)",
src\lib\bizhubPlans.ts:81  "Free business assistant (very limited)",
src\lib\bizhubPlans.ts:102  limits: { maxProducts: "unlimited" },
src\lib\bizhubPlans.ts:105  "Unlimited products",
src\lib\bizhubPlans.ts:107  "Stock signals",
src\lib\bizhubPlans.ts:118  "Unlimited product listing",
src\lib\bizhubPlans.ts:121  "Delivery notes per order (if enabled on your plan)",
src\lib\bizhubPlans.ts:128  "Pay-on-delivery support (coming soon)",
src\lib\bizhubPlans.ts:129  "Paystack escrow + bank transfer orders",
src\lib\bizhubPlans.ts:133  "Stock tracking",
src\lib\bizhubPlans.ts:134  "Low-stock alerts",
src\lib\bizhubPlans.ts:135  "Auto-hide out-of-stock items",
src\lib\bizhubPlans.ts:172  limits: { maxProducts: "unlimited" },
src\lib\bizhubPlans.ts:183  "Unlimited products",
src\lib\bizhubPlans.ts:185  "Stock tracking and alerts",
src\lib\bizhubPlans.ts:203  "Priority dispute review (coming soon)",
src\lib\bizhubPlans.ts:208  "Dead stock detection (coming soon)",
src\lib\bizhubPlans.ts:230  "Faster support response (coming soon)",
src\lib\bizhubPlans.ts:246  recommendedFor: "Big businesses and brands scaling with higher volume.",
src\lib\bizhubPlans.ts:248  limits: { maxProducts: "unlimited" },
src\lib\bizhubPlans.ts:254  "Unlimited sales products",
src\lib\bizhubPlans.ts:265  "Unlimited sales products",
src\lib\bizhubPlans.ts:277  "Delivery confirmation system (coming soon)",
src\lib\bizhubPlans.ts:279  "Faster dispute resolution (coming soon)",
src\lib\bizhubPlans.ts:283  "Smart restock prediction (coming soon)",
src\lib\bizhubPlans.ts:321  export function priceKoboFor(planKey: BizhubPlanKey, cycle: BizhubBillingCycle) {
src\lib\bizhubPlans.ts:322  const ngn = Number(BIZHUB_PLANS[planKey]?.priceNgn?.[cycle] ?? 0);
src\lib\bizhubPlans.ts:334  planKey: Exclude<BizhubPlanKey, "FREE">;
src\lib\bizhubPlans.ts:339  export type BusinessSubscription = {
src\lib\bizhubPlans.ts:340  planKey: Exclude<BizhubPlanKey, "FREE">;
src\lib\bizhubPlans.ts:349  planKey: BizhubPlanKey;
src\lib\bizhubPlans.ts:350  source: "trial" | "subscription" | "free";
src\lib\bizhubPlans.ts:357  export const DEFAULT_TRIAL_PLAN: Exclude<BizhubPlanKey, "FREE"> = "LAUNCH";
src\lib\bizhubPlans.ts:361  subscription?: Partial<BusinessSubscription> | null;
src\lib\bizhubPlans.ts:365  const s = params.subscription;
src\lib\bizhubPlans.ts:366  if (s?.planKey && Number(s.expiresAtMs || 0) > now) {
src\lib\bizhubPlans.ts:367  return { planKey: s.planKey as BizhubPlanKey, source: "subscription", expiresAtMs: Number(s.expiresAtMs) };
src\lib\bizhubPlans.ts:370  return { planKey: "FREE", source: "free" };
src\lib\bizhubPlans.ts:373  export function productLimitFor(planKey: BizhubPlanKey): number | "unlimited" {
src\lib\bizhubPlans.ts:374  return BIZHUB_PLANS[planKey]?.limits?.maxProducts ?? 20;
src\lib\plans.ts:1  export type PlanKey = "FREE" | "STARTER" | "PRO" | "GROWTH";
src\lib\plans.ts:4  export const PLANS: Record<PlanKey, any> = {
src\lib\plans.ts:16  customization: "limited",
src\lib\plans.ts:17  analytics: "limited",
src\lib\plans.ts:26  unlimitedProducts: true,
src\lib\plans.ts:28  unlimitedInvoicesReceipts: true,
src\lib\plans.ts:43  compareAnalytics: true,
src\lib\plans.ts:58  locations: 2,
src\lib\plans.ts:59  multiCurrency: true,
src\lib\types.ts:30  stock?: number; // optional stock per variant
src\lib\types.ts:46  stock?: number;
src\lib\types.ts:68  export type CartState = {
src\lib\types.ts:74  export type PaymentType = "paystack_escrow" | "direct_transfer";
src\lib\types.ts:108  provider?: "paystack";
